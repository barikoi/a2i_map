/**
 * dirPagination - AngularJS module for paginating (almost) anything.
 * Copyright 2014 Michael Bromley <michael@michaelbromley.co.uk>
 **/
!function(){var t,n="angularUtils.directives.dirPagination",p="__default";try{t=angular.module(n)}catch(e){t=angular.module(n,[])}t.directive("dirPaginate",["$compile","$parse","paginationService",function(c,u,l){return{terminal:!0,multiElement:!0,compile:function(e,t){var g=t.dirPaginate,n=g.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),a=/\|\s*itemsPerPage\s*:[^|]*/;if(null===n[2].match(a))throw"pagination directive: the 'itemsPerPage' filter must be set.";var i=n[2].replace(a,""),s=u(i);!function(e){angular.forEach(e,function(e){e.nodeType===Node.ELEMENT_NODE&&angular.element(e).attr("dir-paginate-no-compile",!0)})}(e);var r=t.paginationId||p;return l.registerInstance(r),function(e,t,n){var a=u(n.paginationId)(e)||n.paginationId||p;l.registerInstance(a);var i=function(e,t){var n,a=!!e.match(/(\|\s*itemsPerPage\s*:[^|]*:[^|]*)/);n=t===p||a?e:e.replace(/(\|\s*itemsPerPage\s*:[^|]*)/,"$1 : '"+t+"'");return n}(g,a);!function(e,t,n){e[0].hasAttribute("dir-paginate-start")||e[0].hasAttribute("data-dir-paginate-start")?(t.$set("ngRepeatStart",n),e.eq(e.length-1).attr("ng-repeat-end",!0)):t.$set("ngRepeat",n)}(t,n,i),function(e){angular.forEach(e,function(e){e.nodeType===Node.ELEMENT_NODE&&angular.element(e).removeAttr("dir-paginate-no-compile")}),e.eq(0).removeAttr("dir-paginate-start").removeAttr("dir-paginate").removeAttr("data-dir-paginate-start").removeAttr("data-dir-paginate"),e.eq(e.length-1).removeAttr("dir-paginate-end").removeAttr("data-dir-paginate-end")}(t);var r=c(t),o=function(e,t,n){var a;if(t.currentPage)a=u(t.currentPage);else{var i=n+"__currentPage";e[i]=1,a=u(i)}return a}(e,n,a);l.setCurrentPageParser(a,o,e),void 0!==n.totalItems?(l.setAsyncModeTrue(a),e.$watch(function(){return u(n.totalItems)(e)},function(e){0<=e&&l.setCollectionLength(a,e)})):e.$watchCollection(function(){return s(e)},function(e){e&&l.setCollectionLength(a,e.length)}),r(e)}}}}]).directive("dirPaginateNoCompile",function(){return{priority:5e3,terminal:!0}}).directive("dirPaginationControls",["paginationService","paginationTemplate",function(c,n){var u=/^\d+$/;return{restrict:"AE",templateUrl:function(e,t){return t.templateUrl||n.getPath()},scope:{maxSize:"=?",onPageChange:"&?",paginationId:"=?"},link:function(a,e,t){var n=t.paginationId||p,i=a.paginationId||t.paginationId||p;if(!c.isRegistered(i)&&!c.isRegistered(n)){throw"pagination directive: the pagination controls"+(i!==p?" (id: "+i+") ":" ")+"cannot be used without the corresponding pagination directive."}a.maxSize||(a.maxSize=9);a.directionLinks=!angular.isDefined(t.directionLinks)||a.$parent.$eval(t.directionLinks),a.boundaryLinks=!!angular.isDefined(t.boundaryLinks)&&a.$parent.$eval(t.boundaryLinks);var r=Math.max(a.maxSize,5);function o(e){s(e)&&(a.pages=l(e,c.getCollectionLength(i),c.getItemsPerPage(i),r),a.pagination.current=e,g(),a.onPageChange&&a.onPageChange({newPageNumber:e}))}function g(){var e=c.getCurrentPage(i),t=c.getItemsPerPage(i),n=c.getCollectionLength(i);a.range.lower=(e-1)*t+1,a.range.upper=Math.min(e*t,n),a.range.total=n}function s(e){return u.test(e)&&0<e&&e<=a.pagination.last}a.pages=[],a.pagination={last:1,current:1},a.range={lower:1,upper:1,total:1},a.$watch(function(){return(c.getCollectionLength(i)+1)*c.getItemsPerPage(i)},function(e){0<e&&function(){var e=parseInt(c.getCurrentPage(i))||1;a.pages=l(e,c.getCollectionLength(i),c.getItemsPerPage(i),r),a.pagination.current=e,a.pagination.last=a.pages[a.pages.length-1],a.pagination.last<a.pagination.current?a.setCurrent(a.pagination.last):g()}()}),a.$watch(function(){return c.getItemsPerPage(i)},function(e,t){e!=t&&void 0!==t&&o(a.pagination.current)}),a.$watch(function(){return c.getCurrentPage(i)},function(e,t){e!=t&&o(e)}),a.setCurrent=function(e){s(e)&&(e=parseInt(e,10),c.setCurrentPage(i,e))}}};function l(e,t,n,a){var i,r=[],o=Math.ceil(t/n),g=Math.ceil(a/2);i=e<=g?"start":o-g<e?"end":"middle";for(var s=a<o,c=1;c<=o&&c<=a;){var u=d(c,e,a,o);s&&(2===c&&("middle"===i||"end"===i)||c===a-1&&("middle"===i||"start"===i))?r.push("..."):r.push(u),c++}return r}function d(e,t,n,a){var i=Math.ceil(n/2);return e===n?a:1===e?e:n<a?a-i<t?a-n+e:i<t?t-i+e:e:e}}]).filter("itemsPerPage",["paginationService",function(r){return function(e,t,n){if(void 0===n&&(n=p),!r.isRegistered(n))throw"pagination directive: the itemsPerPage id argument (id: "+n+") does not match a registered pagination-id.";var a,i;return e instanceof Array?(t=parseInt(t)||9999999999,a=(i=r.isAsyncMode(n)?0:(r.getCurrentPage(n)-1)*t)+t,r.setItemsPerPage(n,t),e.slice(i,a)):e}}]).service("paginationService",function(){var t,a={};this.registerInstance=function(e){void 0===a[e]&&(a[e]={asyncMode:!1},t=e)},this.isRegistered=function(e){return void 0!==a[e]},this.getLastInstanceId=function(){return t},this.setCurrentPageParser=function(e,t,n){a[e].currentPageParser=t,a[e].context=n},this.setCurrentPage=function(e,t){a[e].currentPageParser.assign(a[e].context,t)},this.getCurrentPage=function(e){var t=a[e].currentPageParser;return t?t(a[e].context):1},this.setItemsPerPage=function(e,t){a[e].itemsPerPage=t},this.getItemsPerPage=function(e){return a[e].itemsPerPage},this.setCollectionLength=function(e,t){a[e].collectionLength=t},this.getCollectionLength=function(e){return a[e].collectionLength},this.setAsyncModeTrue=function(e){a[e].asyncMode=!0},this.isAsyncMode=function(e){return a[e].asyncMode}}).provider("paginationTemplate",function(){var t="angularUtils.directives.dirPagination.template";this.setPath=function(e){t=e},this.$get=function(){return{getPath:function(){return t}}}}).run(["$templateCache",function(e){e.put("angularUtils.directives.dirPagination.template",'<ul class="pagination" ng-if="1 < pages.length"><li ng-if="boundaryLinks" ng-class="{ disabled : pagination.current == 1 }"><a href="" ng-click="setCurrent(1)">&laquo;</a></li><li ng-if="directionLinks" ng-class="{ disabled : pagination.current == 1 }"><a href="" ng-click="setCurrent(pagination.current - 1)">&lsaquo;</a></li><li ng-repeat="pageNumber in pages track by $index" ng-class="{ active : pagination.current == pageNumber, disabled : pageNumber == \'...\' }"><a href="" ng-click="setCurrent(pageNumber)">{{ pageNumber }}</a></li><li ng-if="directionLinks" ng-class="{ disabled : pagination.current == pagination.last }"><a href="" ng-click="setCurrent(pagination.current + 1)">&rsaquo;</a></li><li ng-if="boundaryLinks"  ng-class="{ disabled : pagination.current == pagination.last }"><a href="" ng-click="setCurrent(pagination.last)">&raquo;</a></li></ul>')}])}();
