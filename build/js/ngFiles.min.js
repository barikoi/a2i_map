!function(){"use strict";function e(e,o,t,a,n,r,s,l){o.address={},o.block="",o.house="",o.road="",o.sector="",o.section="",o.subarea="",o.address.name="",o.center={},o.center.lat=23.757087,o.center.lng=90.39037,o.listone="";o.center.lat,o.center.lng;angular.extend(o,{center:{lat:23.757087,lng:90.39037,zoom:13},markers:{m1:{lat:23.757087,lng:90.39037,draggable:!0,icon:{}}},events:{map:{enable:["moveend","popupopen","dblclick"],logic:"emit"},markers:{enable:["dragend","moveend"],logic:"emit"}}}),o.$on("leafletDirectiveMarker.dragend",(function(e,t){o.markers.m1.lat=t.model.lat,o.markers.m1.lng=t.model.lng})),o.$on("leafletDirectiveMap.dblclick",(function(e,t){console.log(t);var a=t.leafletEvent;t.model.center.lat=a.latlng.lat,t.model.center.lng=a.latlng.lng,t.model.center.zoom=14,o.markers.m1.lat=a.latlng.lat,o.markers.m1.lng=a.latlng.lng})),o.subcategories=[{key:"1",name:"tut"}];e.navone=!0,console.log("log",r),o.markers.m1.lat=r.latlng.lat,o.center.lat=r.latlng.lat,o.markers.m1.lng=r.latlng.lng,o.center.lng=r.latlng.lng,t.get(n.GET_CATEGORY).success((function(e){o.categories=e})).error((function(e){console.log(e)})),o.getSubCategory=function(){var e=o.address.category.type.toString();t.get(n.GET_SUB_CATEGORY+e).success((function(e){o.subcategories=e})).error((function(e){console.log(e)}))},o.onRoadSelect=function(e){o.address.road_type=e},o.onSubTypeSelect=function(e){o.address.sub_type=e},o.add_place=function(){bsLoadingOverlayService.start({referenceId:referenceId});var e=/\w*[a-zA-Z0-9]\w*/g,t=new RegExp(/^\d{1,3}/),a=null!=o.subarea.toString().match(e)?o.subarea+", ":"",r=null!=o.block.toString().match(e)?"Block "+o.block+", ":"",i=null!=o.house.toString().match(e)?"House "+o.house+", ":"",c=null!=o.road.toString().match(e)?o.road+", ":"";c=t.test(o.road)&&o.road.length<=3?"Road "+c:c;var d=null!=o.sector.toString().match(e)?"Sector "+o.sector+", ":"",u=(null!=o.section.toString().match(e)&&o.section,null!=o.address.name.toString().match(e)?o.address.name+", "+i+c+r+d+a:i+c+r+d+a);u=u.replace(/,\s*$/,""),console.log(u),u=u.replace(/,\s*$/,""),console.log(u),u.replace(/(^\s*)|(\s*$)/gi,""),u=(u=(u=u.replace(/[ ]{2,}/gi," ")).replace(/[ ],/gi,",")).replace(/\n /,"\n"),console.log(u);var p="",g="";o.address.road_type&&(p=(p=o.address.road_type.reduce((function(e,o){return e+o.name+", "}),"")).replace(/,\s*$/,""));o.address.sub_type&&(g=(g=o.address.sub_type.reduce((function(e,o){return e+o.name+", "}),"")).replace(/,\s*$/,""));var m={latitude:o.markers.m1.lat,longitude:o.markers.m1.lng,Address:u,city:o.address.city,area:o.address.area,postCode:o.address.postCode,pType:o.address.category.type,subType:g,road_details:p,flag:1,tags:l.get_tag()};console.log(m),s.addaddress(n.NEW_ADDRESS,m,(function(e){$timeout((function(){bsLoadingOverlayService.stop({referenceId:"first"}),swal(error)}),600),swal("Done","Place Added"),o.address=null}),(function(){swal("Error"),$timeout((function(){bsLoadingOverlayService.stop({referenceId:"first"}),swal(error)}),1e3)}))},o.getdirection=function(){this.getPlace().geometry.location&&(o.center.lat=this.getPlace().geometry.location.lat(),o.center.lng=this.getPlace().geometry.location.lng(),o.markers.m1.lat=this.getPlace().geometry.location.lat(),o.markers.m1.lng=this.getPlace().geometry.location.lng())}}angular.module("barikoi").controller("AddPlaceModal",e),e.$inject=["$rootScope","$scope","$http","$location","urls","loc","Auth","DataTunnel"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l){o.init=function(){o.fileContent=[],o.newAddressLog=[],o.showLog=!1,o.resetUpload=!1},o.init(),o.uploadCsv=function(e){l.start({referenceId:e}),o.showLog=!0;var t=function(e,o){o=o||",";for(var t=new RegExp("(\\"+o+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+o+"\\r\\n]*))","gi"),a=[[]],n=null;n=t.exec(e);){var r,s=n[1];s.length&&s!==o&&a.push([]),r=n[2]?n[2].replace(new RegExp('""',"g"),'"'):n[3],a[a.length-1].push(r)}return a}(o.fileContent,",");t.shift(),t.pop();for(let e in t){let a={latitude:t[e][1],longitude:t[e][0],Address:t[e][2],city:t[e][3],area:t[e][4],postCode:t[e][5],pType:t[e][6],subType:t[e][7],contact_person_phone:t[e][8],email:t[e][9]};s.addaddress(n.DTOOL_ADD_PLACE,a,(function(n){let r=JSON.parse(n);console.log(r),r.uCode&&o.newAddressLog.push(a.Address),e==t.length-1&&(l.stop({referenceId:"first"}),o.resetUpload=!0)}),(function(e){console.log(e),swal("Error",e),o.fileContent=""}))}o.fileContent=""}}angular.module("barikoi").controller("CsvDataUploadController",e),e.$inject=["$rootScope","$scope","$http","$location","urls","$timeout","Auth","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l){o.fields={availableOptions:[{id:0,ts:"area"},{id:1,ts:"Address"}],selectedOption:{id:0,ts:"area"}},o.upfields={availableOptions:[{id:0,ts:"ward"},{id:1,ts:"zone"}],selectedOption:{id:0,ts:"ward"}},o.replace=function(e){l.start({referenceId:e}),s.replace(n.REPLACE+"?x="+o.x+"&y="+o.y,(function(e){r((function(){l.stop({referenceId:"first"}),swal("Success","Replaced")}),2e3)}),(function(e){r((function(){l.stop({referenceId:"first"}),swal("","Server Error")}),2e3)}))},o.replace_word=function(e){l.start({referenceId:e}),console.log(o.fields.selectedOption.ts),s.replace(n.REPLACE_WORD+"?data="+o.data+"&ward="+o.ward+"&param="+o.fields.selectedOption.ts+"&updateField="+o.upfields.selectedOption.ts,(function(e){r((function(){l.stop({referenceId:"first"}),swal("Success","Replaced")}),3e3)}),(function(e){r((function(){l.stop({referenceId:"first"}),swal("","Server Error")}),3e3)}))}}angular.module("barikoi").controller("DataFix",e),e.$inject=["$rootScope","$scope","$http","$location","urls","$timeout","Auth","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c){o.address={},o.center={},o.center.lat=23.757087,o.center.lng=90.39037,o.address.block="",o.address.house="",o.address.road="",o.address.sector="",o.address.subarea="",o.address.section="",o.address.name="",o.name="World",o.categories=[{id:1,name:"Home"},{id:2,name:"Food"}],o.address.category=[];var d=[];function u(e,a){o.markers.m1.lat=e,o.markers.m1.lng=a;let n={params:{latitude:e,longitude:a}};t.get("https://admin.barikoi.xyz/v1/reverse/without/auth",n).success((function(e){o.selected=e[0],o.address.area=e[0].area,o.address.city=e[0].city,o.address.postCode=e[0].postCode}))}o.address.road_type=[],o.listone="",o.$watch("address.category",(function(){var e;o.subcategories=(e=o.address.category,e.map((function(e){return d.filter((function(o){return o.type.toLowerCase().indexOf(e.type.toLowerCase())>-1}))}))).flat(),o.pType=o.address.category.reduce((function(e,o){return e+o.type+", "}),"")})),o.$watch("address.subcategory",(function(){o.subType=o.address.subcategory.reduce((function(e,o){return e+o.subtype+", "}),"")})),o.$watch("address.road_type",(function(){o.roadType=o.address.road_type.reduce((function(e,o){return e+o.name+", "}),"")})),angular.extend(o,{center:{lat:23.757087,lng:90.39037,zoom:13},markers:{m1:{lat:23.757087,lng:90.39037,draggable:!0,icon:{}}},controls:{draw:{}},events:{map:{enable:["click","moveend","popupopen"],logic:"emit"},markers:{enable:["dragend","moveend"],logic:"emit"}},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),s.getMap().then((function(e){r((function(){e.invalidateSize()}),1e3)})),o.$on("leafletDirectiveMap.click",(function(e,t){o.markers.m1.lat=t.leafletEvent.latlng.lat,o.markers.m1.lng=t.leafletEvent.latlng.lng,u(t.leafletEvent.latlng.lat,t.leafletEvent.latlng.lng)})),o.$on("leafletDirectiveMarker.dragend",(function(e,t){o.markers.m1.lat=t.model.lat,o.markers.m1.lng=t.model.lng}));!function(){var e=i.get_data();try{o.center.lat=e.latlng.lat,o.center.lng=e.latlng.lng,o.center.zoom=14,o.markers.m1.lat=e.latlng.lat,o.markers.m1.lng=e.latlng.lng}catch(e){o.center.lat=23.757087,o.center.lng=90.39037,o.markers.m1.lat=23.757087,o.markers.m1.lng=90.39037}t.get(n.GET_CATEGORY).success((function(e){o.categories=e,s.getMap().then((function(e){s.getLayers().then((function(t){var a=t.overlays.draw;e.on("draw:created",(function(e){var t=e.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),o.bounds=n.reduce((e,o)=>e.concat(o),[])}))}))}))})).error((function(e){console.log(e),s.getMap().then((function(e){s.getLayers().then((function(t){var a=t.overlays.draw;e.on("draw:created",(function(e){var t=e.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),o.bounds=n.reduce((e,o)=>e.concat(o),[])}))}))}))}))}(),o.subcategories=[{key:"1",name:"tut"}],l.getlocations(n.GET_SUBTYPES,(function(e){o.subcategories=e,d=o.subcategories}),(function(){})),s.getMap().then((function(e){s.getLayers().then((function(t){var a=t.overlays.draw;e.on("draw:created",(function(e){var t=e.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),o.bounds=n.reduce((e,o)=>e.concat(o),[])})),e.on("draw:deleted",(function(e){e.layers.eachLayer((function(e){for(var t=0;t<o.savedItems.length;t++)o.savedItems[t].id==e._leaflet_id&&o.savedItems.splice(t,1)}))}))}))})),o.onSelected=function(e,t){o.address[e]=t},o.$on("leafletDirectiveMarker.dragend",(function(e,t){o.markers.m1.lat=t.model.lat,o.markers.m1.lng=t.model.lng})),o.add_place=function(t){var a=/\w*[a-zA-Z0-9]\w*/g,s=new RegExp(/^\d{1,3}/),u=null!=o.address.subarea.toString().match(a)?o.address.subarea+", ":"",p=null!=o.address.subarea.toString().match(a)?o.address.subarea.toString().trim():"";console.log("subarea "+u);var g=null!=o.address.block.toString().match(a)?"Block "+o.address.block+", ":"",m=null!=o.address.block.toString().match(a)?"Block "+o.address.block.toString().trim():"";console.log("block "+g);var y=null!=o.address.house.toString().match(a)?"House "+o.address.house+", ":"";null!=o.address.house.toString().match(a)&&o.address.house.toString().trim();console.log("house "+y);var f=null!=o.address.road.toString().match(a)?o.address.road+", ":"";null!=o.address.road.toString().match(a)&&o.address.road.toString().trim();f=s.test(o.address.road)&&o.address.road.length<=3?"Road "+f:f,console.log("road "+f);var h=null!=o.address.sector.toString().match(a)?"Sector "+o.address.sector+", ":"",b=null!=o.address.sector.toString().match(a)?"Sector "+o.address.sector.toString().trim():"";console.log("sector "+h);var _=null!=o.address.section.toString().match(a)?"Section "+o.address.section+", ":"",v=null!=o.address.section.toString().match(a)?"Section "+o.address.section.toString().trim():"";console.log("section "+_);var w,k,S=null!=o.address.name.toString().match(a)?o.address.name+", "+y+f+g+h+_+u:y+f+g+h+_+u;S=S.replace(/,\s*$/,""),console.log(S),S.replace(/(^\s*)|(\s*$)/gi,""),S=(S=(S=S.replace(/[ ]{2,}/gi," ")).replace(/[ ],/gi,",")).replace(/\n /,"\n"),console.log(S),""==b&&""==v?(w=p,k=m):(w=b+v,k=g+p);var x={latitude:o.markers.m1.lat,longitude:o.markers.m1.lng,holding_no:o.address.house,road_name_number:o.address.road,name:o.address.name,Address:S,city:o.address.city,area:o.address.area,sub_area:w,super_sub_area:k,postCode:o.address.postCode,pType:o.pType.replace(/,\s*$/,""),subType:o.subType.replace(/,\s*$/,""),number_of_floors:o.address.number_of_floors,email:"",contact_person_name:o.address.contact_person_name,contact_person_phone:o.address.contact_person_phone,tags:i.get_tag()};try{x.images=o.imageSrc.compressed.dataURL.slice(o.imageSrc.compressed.dataURL.indexOf(",")+1)}catch(e){console.log(x)}try{x.bounds=o.bounds.toString()}catch(e){console.log(x)}l.addaddress(n.DTOOL_ADD_PLACE,x,(function(t){e.$broadcast("mk-new",x),r((function(){c.stop({referenceId:"first"})}),600),o.house="",o.address.name="",o.imageSrc=null,o.subcategories=d,o.bounds=null,swal("Success","New Address Create")}),(function(e){r((function(){c.stop({referenceId:"first"}),swal(e)}),1e3)}))},o.showOverlay=function(e){c.start({referenceId:e});var t=function(e,o){o=o||",";var t=new RegExp("(\\"+o+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+o+"\\r\\n]*))","gi"),a=[[]],n=null;for(;n=t.exec(e);){var r,s=n[1];s.length&&s!==o&&a.push([]),r=n[2]?n[2].replace(new RegExp('""',"g"),'"'):n[3],a[a.length-1].push(r)}return a}(o.fileContent,",");for(var a in t){var s={latitude:t[a][1],longitude:t[a][0],Address:t[a][2],city:t[a][3],area:t[a][4],postCode:t[a][5],pType:t[a][6],subType:t[a][7]};console.log(s),l.addaddress(n.DTOOL_ADD_PLACE,s,(function(e){a==t.length-1&&r((function(){c.stop({referenceId:"first"}),swal("Success","Places Added ")}),2e3)}),(function(){console.log("erro")}))}},o.getdirection=function(){this.getPlace().geometry.location&&(o.center.lat=this.getPlace().geometry.location.lat(),o.center.lng=this.getPlace().geometry.location.lng(),o.markers.m1.lat=this.getPlace().geometry.location.lat(),o.markers.m1.lng=this.getPlace().geometry.location.lng())},o.onSelect=function(e){o.selected=e,o.markers.m1.lat=parseFloat(o.selected.latitude),o.markers.m1.lng=parseFloat(o.selected.longitude),o.center.lat=parseFloat(o.selected.latitude),o.center.lng=parseFloat(o.selected.longitude),o.address.city=e.city,o.address.area=e.area,o.address.postCode=e.postCode,i.address_split(o.address,e.Address)},o.users=function(t){return t.length<1?[]:(o.loading=!0,l.getUsers(t).then((function(e){return o.loading=!1,e.places}),(function(t){o.loading=!1,r((function(){c.stop({referenceId:"first"}),swal(e.error),o.markers.m1={}}),2e3)})))},o.set_marker_position=function(e){var t=e.split(",")[0],a=e.split(",")[1];o.center.lat=parseFloat(t),o.center.lng=parseFloat(a),u(o.center.lat,o.center.lng)}}angular.module("barikoi").controller("DtollPlaceAdd",e).directive("fileReader",(function(){return{scope:{fileReader:"="},link:function(e,o){$(o).on("change",(function(o){var t=o.target.files;if(t.length){var a=new FileReader;a.onload=function(o){var t=o.target.result;e.$apply((function(){e.fileReader=t}))},a.readAsText(t[0])}}))}}})),e.$inject=["$rootScope","$scope","$http","$location","urls","$timeout","leafletData","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u,p){console.log("mapper retool");o.imageSrc={},o.imageSrc.compressed={},o.address={},o.center={},o.center.lat=23.757087,o.center.lng=90.39037,o.address.block="",o.address.house="",o.address.road="",o.address.sector="",o.address.sub_area="",o.address.super_sub_area="",o.address.section="",o.address.name="",o.name="World",o.categories=[{id:1,name:"Home"},{id:2,name:"Food"}],o.address.category=[];var g=[];o.address.road_type=[],o.listone="";function m(e,a){o.markers.m1.lat=e,o.markers.m1.lng=a;let n={params:{latitude:e,longitude:a}};t.get("https://admin.barikoi.xyz/v1/reverse/without/auth",n).success((function(e){o.selected=e[0],o.address.Address=e[0].Address,o.address.area=e[0].area,o.address.city=e[0].city,o.address.postCode=e[0].postCode,o.bounds=JSON.parse(e[0]["ST_AsGeoJSON(bounds)"]),console.log(o.bounds),angular.extend(o,{geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:o.bounds.coordinates}}]},style:{weight:2,opacity:1,color:"red",dashArray:"3",fillOpacity:0}}})}))}angular.extend(o,{center:{lat:23.757087,lng:90.39037,zoom:15},controls:{draw:{}},markers:{m1:{lat:23.757087,lng:90.39037,draggable:!0,icon:{iconUrl:"https://cdn.jsdelivr.net/npm/leaflet@1.4.0/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}}},events:{map:{enable:["click","dblclick","moveend","popupopen"],logic:"emit"},markers:{enable:["dragend","moveend"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),o.$watch("address.category",(function(){var e;o.subcategories=(e=o.address.category,e.map((function(e){return g.filter((function(o){return o.type.toLowerCase().indexOf(e.type.toLowerCase())>-1}))}))).flat(),console.log(o.subcategories),o.pType=o.address.category.reduce((function(e,o){return e+o.type+", "}),"")})),o.$watch("address.subcategory",(function(){o.subType=o.address.subcategory.reduce((function(e,o){return e+o.subtype+", "}),"")})),l.getMap().then((function(e){r((function(){e.invalidateSize()}),700)})),o.$on("leafletDirectiveMarker.dragend",(function(e,t){o.markers.m1.lat=t.model.lat,o.markers.m1.lng=t.model.lng,o.address.latitude=t.model.lat,o.address.longitude=t.model.lng})),o.$on("leafletDirectiveMap.dblclick",(function(e,o){m(o.leafletEvent.latlng.lat,o.leafletEvent.latlng.lng)}));!function(){if(l.getMap().then((function(e){l.getLayers().then((function(t){var a=t.overlays.draw;e.on("draw:created",(function(e){var t=e.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),o.bounds=n.reduce((e,o)=>e.concat(o),[])}))}))})),null!=d.get_data())if(null!=d.get_data().uCode)t.get(i.SEARCH_CODE+d.get_data().uCode).success((function(e){console.log(e),o.markers.m1.lat=parseFloat(e.latitude),o.markers.m1.lng=parseFloat(e.longitude),o.center.lat=parseFloat(e.latitude),o.center.lng=parseFloat(e.longitude),o.address=e,o.pview=e.pType,o.sub_view=e.subType,o.road_view=e.road_details,o.pType=e.pType,o.subType=e.subType,o.roadType=e.road_details;var t={pType:e.pType,subType:e.subType};d.address_split(o.address,e.Address,t);try{o.imageSrc.compressed.dataUrl=e.images[0].imageLink}catch(e){}var a=JSON.parse(e["ST_AsGeoJSON(bounds)"]);console.log(a),angular.extend(o,{geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:a.coordinates}}]},style:{weight:2,opacity:1,color:"red",dashArray:"3",fillOpacity:0}}})})).error((function(e){console.log(e)}));else{var e=d.get_data();try{o.center.lat=e.latlng.lat,o.center.lng=e.latlng.lng,o.center.zoom=14,o.markers.m1.lat=e.latlng.lat,o.markers.m1.lng=e.latlng.lng,m(o.markers.m1.lat,o.markers.m1.lng)}catch(e){o.center.lat=23.757087,o.center.lng=90.39037,o.markers.m1.lat=23.757087,o.markers.m1.lng=90.39037}}t.get(i.GET_CATEGORY).success((function(e){o.categories=e,l.getMap().then((function(e){l.getLayers().then((function(t){var a=t.overlays.draw;e.on("draw:created",(function(e){var t=e.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),o.bounds=n.reduce((e,o)=>e.concat(o),[])}))}))}))})).error((function(e){console.log(e),l.getMap().then((function(e){l.getLayers().then((function(t){var a=t.overlays.draw;e.on("draw:created",(function(e){var t=e.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),o.bounds=n.reduce((e,o)=>e.concat(o),[])}))}))}))}))}(),o.subcategories=[{key:"1",name:"tut"}],c.getlocations(i.GET_SUBTYPES,(function(e){o.subcategories=e,g=o.subcategories}),(function(){})),o.getSubCategory=function(){var e=o.address.category.type.toString();t.get(i.GET_SUB_CATEGORY+e).success((function(e){o.subcategories=[],e.map((function(e){o.subcategories.push({key:e.id,name:e.subtype})}))})).error((function(e){console.log(e)}))},c.getlocations(i.TOTAL_USER,(function(e){o.userlist=e.data.list_users}),(function(){e.error="Failed to fetch details"})),o.set_consumer=function(e){console.log(e.device_ID)},o.onSelected=function(e,t){o.address[e]=t,console.log(o.address[e])},o.add_place=function(t){u.start({referenceId:t});var a,n,s,l,p,m,y=/\w*[a-zA-Z0-9]\w*/g,f=new RegExp(/^\d{1,3}/);try{a=null!=o.address.sub_area.match(y)?o.address.sub_area+", ":""}catch{a=""}console.log("subarea "+a);try{n=null!=o.address.super_sub_area.match(y)?o.address.super_sub_area+", ":""}catch(e){n=""}console.log("suparea "+n);try{s=null!=o.address.house.match(y)?"House "+o.address.house+", ":""}catch(e){s=""}console.log("house "+s);try{l=null!=o.address.floor.match(y)?o.address.floor:"",null!==o.address.floor.match(y)?l+=", ":o.address.floor=""}catch(e){l=""}try{p=null!=o.address.section.match(y)?o.address.section+", ":""}catch(e){p=""}console.log("house "+p);try{var h=null!=o.address.road.match(y)?o.address.road+", ":"";f.test(o.address.road)&&o.address.road.length<=3&&(h="Road "+h,o.address.road="Road "+o.address.road),/^\d+$/.test(o.address.road)?(h="Road "+h,o.address.road="Road "+o.address.road):h=h}catch(e){h=""}console.log("road "+h);try{m=null!=o.address.name.match(y)?o.address.name+", "+l+p+s+h+n+a:p+l+s+h+n+a}catch(e){m=p+l+s+h+n+a}m=m.replace(/,\s*$/,""),console.log(m),m.replace(/(^\s*)|(\s*$)/gi,""),m=(m=(m=m.replace(/[ ]{2,}/gi," ")).replace(/[ ],/gi,",")).replace(/\n /,"\n"),console.log(m),o.address.Address=m;var b={latitude:o.markers.m1.lat,longitude:o.markers.m1.lng,Address:o.address.Address,city:o.address.city,holding_no:o.address.house,road_name_number:o.address.road,business_name:o.address.name,name:o.address.section,sub_area:o.address.sub_area,super_sub_area:o.address.super_sub_area,area:o.address.area,postCode:o.address.postCode,pType:o.pType.replace(/,\s*$/,""),subType:o.subType.replace(/,\s*$/,""),floor:o.address.floor,number_of_floors:o.address.number_of_floors,email:o.address.email,flag:1,contact_person_name:o.address.contact_person_name,contact_person_phone:o.address.contact_person_phone,route_description:o.address.route_description,tags:d.get_tag()};try{b.images=o.imageSrc.compressed.dataURL.slice(o.imageSrc.compressed.dataURL.indexOf(",")+1)}catch(e){console.log(b)}try{b.bounds=o.bounds.toString()}catch(e){console.log(b)}console.log(b),c.addaddress(i.DTOOL_ADD_PLACE,b,(function(t){e.$broadcast("mk-new",b),r((function(){u.stop({referenceId:"first"}),swal(error)}),600),o.house="",o.address.name="",o.bounds=null,o.imageSrc=null,o.subcategories=g,swal("Success","New Address Create")}),(function(e){r((function(){u.stop({referenceId:"first"}),swal(e)}),1e3)}))},o.vault_place=function(t){console.log("vault function"),u.start({referenceId:t});var a,n,s,l,i,m,y=/\w*[a-zA-Z0-9]\w*/g,f=new RegExp(/^\d{1,3}/),h=/^\d+$/;try{a=null!=o.address.sub_area.match(y)?o.address.sub_area+", ":""}catch{a=""}console.log("subarea "+a);try{n=null!=o.address.super_sub_area.match(y)?o.address.super_sub_area+", ":""}catch(e){n=""}console.log("suparea "+n);try{s=null!=o.address.house.match(y)?"House "+o.address.house+", ":""}catch(e){s=""}console.log("house "+s);try{l=null!=o.address.floor.match(y)?o.address.floor:"",o.address.floor.toLowerCase().includes("floor")?l+=", ":h.test(o.address.floor)?(l="Floor "+l+", ",o.address.floor="Floor "+o.address.floor):(l+=" Floor, ",o.address.floor=o.address.floor+" Floor")}catch(e){l=""}try{i=null!=o.address.section.match(y)?o.address.section+", ":""}catch(e){i=""}console.log("house "+i);try{var b=null!=o.address.road.match(y)?o.address.road+", ":"";f.test(o.address.road)&&o.address.road.length<=3&&(b="Road "+b,o.address.road="Road "+o.address.road),h.test(o.address.road)?(b="Road "+b,o.address.road="Road "+o.address.road):b=b}catch(e){b=""}console.log("road "+b);try{m=null!=o.address.name.match(y)?o.address.name+", "+l+i+s+b+n+a:l+i+s+b+n+a}catch(e){m=i+l+s+b+n+a}m=m.replace(/,\s*$/,""),console.log(m),m.replace(/(^\s*)|(\s*$)/gi,""),m=(m=(m=m.replace(/[ ]{2,}/gi," ")).replace(/[ ],/gi,",")).replace(/\n /,"\n"),console.log(m),o.address.Address=m;var _={latitude:o.markers.m1.lat,longitude:o.markers.m1.lng,Address:o.address.Address,city:o.address.city,holding_no:o.address.house,road_name_number:o.address.road,business_name:o.address.name,name:o.address.section,sub_area:o.address.sub_area,super_sub_area:o.address.super_sub_area,area:o.address.area,postCode:o.address.postCode,pType:o.pType.replace(/,\s*$/,""),subType:o.subType.replace(/,\s*$/,""),floor:o.address.floor,email:o.address.email,flag:1,contact_person_name:o.address.contact_person_name,contact_person_phone:o.address.contact_person_phone,route_description:o.address.route_description,tags:d.get_tag(),task_id:p.task_id};try{_.images=o.imageSrc.compressed.dataURL.slice(o.imageSrc.compressed.dataURL.indexOf(",")+1)}catch(e){console.log(_)}try{_.bounds=o.bounds.toString()}catch(e){console.log(_)}console.log(_),c.addaddress("https://admin.barikoi.xyz/v1/auth/place/newplace/mapper/vault",_,(function(t){e.$broadcast("mk-new",_),r((function(){u.stop({referenceId:"first"}),swal(error)}),600),o.house="",o.address.name="",o.bounds=null,o.imageSrc=null,o.subcategories=g,swal("Success","New Vault Address Created")}),(function(e){r((function(){u.stop({referenceId:"first"}),swal(e)}),1e3)}))},o.showOverlay=function(e){u.start({referenceId:e});var t=function(e,o){o=o||",";var t=new RegExp("(\\"+o+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+o+"\\r\\n]*))","gi"),a=[[]],n=null;for(;n=t.exec(e);){var r,s=n[1];s.length&&s!==o&&a.push([]),r=n[2]?n[2].replace(new RegExp('""',"g"),'"'):n[3],a[a.length-1].push(r)}return a}(o.fileContent,",");for(var a in t){var n={latitude:t[a][1],longitude:t[a][0],Address:t[a][2],city:t[a][3],area:t[a][4],postCode:t[a][5],pType:t[a][6],subType:t[a][7]};console.log(n),c.addaddress(i.DTOOL_ADD_PLACE,n,(function(e){a==t.length-1&&r((function(){u.stop({referenceId:"first"}),swal("Success","Places Added ")}),2e3)}),(function(){console.log("erro")}))}},o.getdirection=function(){this.getPlace().geometry.location&&(o.center.lat=this.getPlace().geometry.location.lat(),o.center.lng=this.getPlace().geometry.location.lng(),o.markers.m1.lat=this.getPlace().geometry.location.lat(),o.markers.m1.lng=this.getPlace().geometry.location.lng())},o.onSelect=function(e){o.selected=e,console.log("usr",e);var a={pType:e.pType,subType:e.subType};!function(e,t){for(;e.length;)o.address[e.pop()]=t}(["city","area","postCode","name","house","road","sub_area","super_sub_area","Address"],""),o.markers.m1.lat=parseFloat(o.selected.latitude),o.markers.m1.lng=parseFloat(o.selected.longitude),o.center.lat=parseFloat(o.selected.latitude),o.center.lng=parseFloat(o.selected.longitude),o.address.city=e.city,o.address.area=e.area,o.address.postCode=e.postCode,o.address.Address=e.Address,o.address.latitude=e.latitude,o.address.longitude=e.longitude,o.address.number_of_floors=e.number_of_floors,o.pview=e.pType,o.sub_view=e.subType,o.pType=e.pType,o.subType=e.subType,d.address_split(o.address,e.Address,a),o.address.road_details=e.road_details,t.get(i.SEARCH_CODE+e.uCode).success((function(e){o.bounds=JSON.parse(e["ST_AsGeoJSON(bounds)"]),console.log(o.bounds),angular.extend(o,{geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:o.bounds.coordinates}}]},style:{weight:2,opacity:1,color:"red",dashArray:"3",fillOpacity:0}}})}))},o.users=function(t){return t.length<1?[]:(o.loading=!0,c.getUsers(t).then((function(e){return o.loading=!1,e.places}),(function(t){o.loading=!1,r((function(){u.stop({referenceId:"first"}),swal(e.error),o.markers.m1={}}),2e3)})))},o.set_marker_position=function(e){var t=e.split(",")[0],a=e.split(",")[1];o.center.lat=parseFloat(t),o.center.lng=parseFloat(a),m(o.center.lat,o.center.lng)},o.ok=function(){s.close()}}angular.module("barikoi").controller("Retool",e).directive("numbersOnly",(function(){return{require:"ngModel",link:function(e,o,t,a){a.$parsers.push((function(e){if(e){var o=e.replace(/[^0-9]/g,"");return o!==e&&(a.$setViewValue(o),a.$render()),o}}))}}})),e.$inject=["$rootScope","$scope","$http","$location","$stateParams","$timeout","$modalInstance","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService","$localStorage"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){o.imageSrc={},o.imageSrc.compressed={},o.address={},o.tagsArray=[];var p=parseFloat(c.lat),g=parseFloat(c.lngt),m=[];angular.extend(o,{center:{lat:p,lng:g,zoom:15},controls:{draw:{}},markers:{m1:{lat:p,lng:g,draggable:!0,icon:{iconUrl:"https://cdn.jsdelivr.net/npm/leaflet@1.4.0/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}}},events:{map:{enable:["moveend","popupopen","dblclick","click"],logic:"emit"},markers:{enable:["dragend","moveend","click"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}});var y=[];o.listone="";t.get(l.GET_CATEGORY).success((function(e){o.categories=e})).error((function(e){console.log(e)})),o.subcategories=[{key:"1",name:"tut"}],i.getlocations(l.GET_SUBTYPES,(function(e){o.subcategories=e,y=o.subcategories}),(function(){})),s.getMap().then((function(e){n((function(){e.invalidateSize(),console.log("loaded"),s.getMap().then((function(e){s.getLayers().then((function(t){var a=t.overlays.draw;e.on("draw:created",(function(e){console.log(e+"drawed");var t=e.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),o.bounds=n.reduce((e,o)=>e.concat(o),[])}))}))}))}),500)})),o.categories=[{id:1,name:"Home"},{id:2,name:"Food"}],o.address.category=[];y=[];function f(e,a){o.markers.m1.lat=e,o.markers.m1.lng=a;let n={params:{latitude:e,longitude:a}};t.get("https://admin.barikoi.xyz/v1/reverse/without/auth",n).success((function(e){o.selected=e[0],o.address.Address=e[0].Address,o.address.area=e[0].area,o.address.city=e[0].city,o.address.postCode=e[0].postCode,o.bounds=JSON.parse(e[0]["ST_AsGeoJSON(bounds)"]),console.log(o.bounds),angular.extend(o,{geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:o.bounds.coordinates}}]},style:{weight:2,opacity:1,color:"red",dashArray:"3",fillOpacity:0}}})}))}o.address.road_type=[],o.$watch("address.category",(function(){var e;console.log(o.address.category),o.subcategories=y,o.address.category!=[]&&(o.subcategories=(e=o.address.category,e.map((function(e){return""==e?y:y.filter((function(o){return o.type.toLowerCase().indexOf(e.type.toLowerCase())>-1}))}))).flat()),console.log(o.subcategories),o.pType=o.address.category.reduce((function(e,o){return e+o.type+", "}),"").replace(/,\s*$/,""),o.pview=o.pType,0==o.address.category.length&&(o.pType=o.address.pType,o.pview=o.address.pType)})),o.$watch("address.subcategory",(function(){o.subType=o.address.subcategory.reduce((function(e,o){return e+o.subtype+", "}),"").replace(/,\s*$/,""),o.sub_view=o.subType,0==o.address.subcategory.length&&(o.subType=o.address.subType,o.sub_view=o.address.subType)})),o.address={},o.$on("leafletDirectiveMarker.dragend",(function(e,t){o.markers.m1.lat=t.model.lat,o.markers.m1.lng=t.model.lng,o.address.latitude=t.model.lat,o.address.longitude=t.model.lng})),o.$on("leafletDirectiveMap.dblclick",(function(e,o){f(o.leafletEvent.latlng.lat,o.leafletEvent.latlng.lng)})),o.$on("leafletDirectiveMap.click",(function(e,o){})),o.subcategories=[{key:"1",name:"tut"}];t.get(l.SEARCH_CODE+c.uCode).success((function(e){console.log(e),o.address=e,o.pview=e.pType,o.sub_view=e.subType,o.road_view=e.road_details,o.pType=e.pType,o.subType=e.subType,o.roadType=e.road_details,o.markers.m1.lat=parseFloat(e.latitude),o.markers.m1.lng=parseFloat(e.longitude),o.center.lat=parseFloat(e.latitude),o.center.lng=parseFloat(e.longitude);let t=e.tags;null!==t&&(o.tagsArray=t.split(","),m=o.tagsArray);var a={pType:e.pType,subType:e.subType};u.address_split(o.address,e.Address,a),o.bounds=JSON.parse(e["ST_AsGeoJSON(bounds)"]),console.log(o.bounds);var n=[];o.bounds.coordinates[0].map((function(e){n.push(e.join(" "))})),o.bounds=n.reduce((e,o)=>e.concat(o),[]),s.getMap().then((function(e){console.log("draw mmap"),s.getLayers().then((function(t){var a=t.overlays.draw;e.on("draw:created",(function(e){var t=e.layer;a.addLayer(t),console.log(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),o.bounds=n.reduce((e,o)=>e.concat(o),[]),console.log(o.bounds)}))}))}));try{o.imageSrc.compressed.dataUrl=e.images[0].imageLink}catch(e){}var r=JSON.parse(e["ST_AsGeoJSON(bounds)"]);console.log(r),angular.extend(o,{geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:r.coordinates}}]},style:{weight:2,opacity:1,color:"red",dashArray:"3",fillOpacity:0}}})})).error((function(e){console.log(e)})),o.removeTags=function(e){console.clear(),m=o.tagsArray.slice(e+1,o.tagsArray.length),o.tagsArray=m},o.getSubCategory=function(){var e=o.address.category.type.toString();t.get(l.GET_SUB_CATEGORY+e).success((function(e){o.subcategories=[],e.map((function(e){o.subcategories.push({key:e.id,name:e.subtype})}))})).error((function(e){console.log(e)}))},o.add_place=function(t){console.log("tags: ",m),d.start({referenceId:t});var a,r,s,p=/\w*[a-zA-Z0-9]\w*/g,g=new RegExp(/^\d{1,3}/);try{a=null!=o.address.sub_area.match(p)?o.address.sub_area+", ":""}catch{a=""}try{r=null!=o.address.super_sub_area.match(p)?o.address.super_sub_area+", ":""}catch(e){r=""}try{s=null!=o.address.house.match(p)?"House "+o.address.house+", ":""}catch(e){s=""}var y,f,h=null;try{h=null!=o.address.floor.match(p)?o.address.floor:"",null!==o.address.floor.match(p)?h+=", ":o.address.floor=""}catch(e){h=""}try{y=null!=o.address.section.match(p)?o.address.section+", ":""}catch(e){y=""}console.log("house "+y);try{var b=null!=o.address.road.match(p)?o.address.road+", ":"";g.test(o.address.road)&&o.address.road.length<=5&&(b="Road "+b,o.address.road="Road "+o.address.road),/^\d+$/.test(o.address.road)?(b="Road "+b,o.address.road="Road "+o.address.road):b=b}catch(e){b=""}try{f=null!=o.address.name.match(p)?o.address.name+", "+h+y+s+b+r+a:y+h+s+b+r+a}catch(e){f=y+h+s+b+r+a}(f=f.replace(/,\s*$/,"")).replace(/(^\s*)|(\s*$)/gi,""),f=(f=(f=f.replace(/[ ]{2,}/gi," ")).replace(/[ ],/gi,",")).replace(/\n /,"\n"),o.address.Address=f;var _={latitude:o.markers.m1.lat,longitude:o.markers.m1.lng,Address:o.address.Address,city:o.address.city,holding_no:o.address.house,road_name_number:o.address.road,business_name:o.address.name,name:o.address.section,sub_area:o.address.sub_area,super_sub_area:o.address.super_sub_area,area:o.address.area,postCode:o.address.postCode,pType:o.pType.replace(/,\s*$/,""),subType:o.subType.replace(/,\s*$/,""),floor:o.address.floor,number_of_floors:o.address.number_of_floors,email:o.address.email,flag:1,contact_person_name:o.address.contact_person_name,contact_person_phone:o.address.contact_person_phone,route_description:o.address.route_description,tags:function(){console.clear();try{if(console.log("tunnel tag  ",u.get_tag()),console.log("supparray length",m.length),m.length>0&&void 0!==u.get_tag()){return console.log("suppport + tunnel"),u.get_tag().split(",").forEach(e=>{m.push(e)}),m.toString()}return void 0===u.get_tag()&&0===m.length?(console.log("all none - 0"),null):m.length>=1?m.toString():u.get_tag()}catch(e){console.log(e)}}()};try{_.images=o.imageSrc.compressed.dataURL.slice(o.imageSrc.compressed.dataURL.indexOf(",")+1)}catch(e){console.log(_)}try{_.bounds=o.bounds.toString()}catch(e){console.log(_)}i.addaddress(l.UPDATE_PLACE+o.address.id,_,(function(t){try{c.lat=o.markers.m1.lat,c.lng=o.markers.m1.lng,e.$broadcast("mk-upd",c),o.tagArray=[]}catch(e){console.clear()}n((function(){d.stop({referenceId:"first"})}),1e3),o.bounds=null,swal("Success",t)}),(function(e){n((function(){d.stop({referenceId:"first"}),swal(e)}),1e3)}))},o.onSelect=function(e){o.selected=e,function(e,t){for(;e.length;)o.address[e.pop()]=t}(["city","area","postCode","name","house","road","sub_area","super_sub_area","Address"],""),o.markers.m1.lat=parseFloat(o.selected.latitude),o.markers.m1.lng=parseFloat(o.selected.longitude),o.center.lat=parseFloat(o.selected.latitude),o.center.lng=parseFloat(o.selected.longitude),u.set_form_data(e),o.address.id=e.id,o.address.Address=e.Address,o.address.city=e.city,o.address.area=e.area,o.address.postCode=e.postCode,o.pview=e.pType,o.sub_view=e.subType,o.pType=e.pType,o.subType=e.subType;var a={pType:e.pType,subType:e.subType};u.address_split(o.address,e.Address,a),console.log("tags",o.address.tags),t.get(l.SEARCH_CODE+e.uCode).success((function(e){console.log(e["ST_AsGeoJSON(bounds)"]),o.bounds=JSON.parse(e["ST_AsGeoJSON(bounds)"]);var t=JSON.parse(e["ST_AsGeoJSON(bounds)"]),a=[];o.bounds.coordinates[0].map((function(e){a.push(e.join(" "))})),o.bounds=a.reduce((e,o)=>e.concat(o),[]),angular.extend(o,{geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:t.coordinates}}]},style:{weight:2,opacity:1,color:"red",dashArray:"3",fillOpacity:0}}})}))},o.users=function(t){return t.length<1?[]:(o.loading=!0,i.getUsers(t).then((function(e){return o.loading=!1,console.log(e.places),e.places}),(function(t){o.loading=!1,n((function(){d.stop({referenceId:"first"}),swal(e.error),o.markers.m1={}}),2e3)})))},o.auto_fill_form=function(){var e=u.get_form_data();console.log(e),o.address.city=e.city,o.address.area=e.area,o.address.postCode=e.postCode,o.address.Address=e.Address,o.address.latitude=e.latitude,o.address.longitude=e.longitude,o.address.number_of_floors=e.number_of_floors,o.address.road_details=e.road_details},o.set_marker_position=function(e){var t=e.split(",")[0],a=e.split(",")[1];o.center.lat=parseFloat(t),o.center.lng=parseFloat(a),f(o.center.lat,o.center.lng)},console.clear(),console.log(c),o.ok=function(){r.close()}}angular.module("barikoi").controller("UpdatePlaceModal",e),e.$inject=["$rootScope","$scope","$http","$location","$timeout","$modalInstance","leafletData","urls","Auth","loc","bsLoadingOverlayService","DataTunnel"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l){e.navone=!1,o.userType={availableOptions:[{id:1,url:n.AUTH_URI,name:"Admin"},{id:2,url:n.AUTH_LOGI,name:"User"},{id:3,url:n.AUTH_BUS,name:"Business"},{id:4,url:n.AUTH_BUS,name:"Logistics"},{id:5,url:n.AUTH_BUS,name:"Delivery Man"}],selectedOption:{id:1,url:n.AUTH_URI,name:"Admin"}},o.$storage=r.$default({code:[]}),o.signin=function(){var e={email:o.email,password:o.password,userType:1};l.signin(e,(function(e){0==e.type?alert(e.data):(r.token=e.data.token,swal("Success","You Are Logged In :)"),s.go("main.dashboard"))}),(function(){swal("Sorry","Error Occured")}))},o.signup=function(){var t={name:o.name,email:o.email,phone:o.phone,password:o.password,userType:o.userType.selectedOption.id};l.signup(t,(function(e){e.type,swal(e.data)}),(function(){e.error="Failed to signup"}))},o.logout=function(){l.logout((function(){swal("Log out","you are signing off"),window.location="#/signin"}),(function(){swal("Failed to logout!")}))},o.token=r.token}angular.module("barikoi").controller("MainController",e),e.$inject=["$rootScope","$scope","$http","$location","urls","$localStorage","$state","Auth"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d){function u(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function p(e,o){o.bindTooltip(e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function g(e){return{fillColor:u(),opacity:1,color:u(),dashArray:"3",fillOpacity:.4}}e.areas=[{key:1,name:"Mirpur"}],i.getlocations(l.POLYGON_AREA,(function(o){e.selectedItems=[],e.areas=[],e.areas.push({key:-1,name:"clear",pgon:"nai",selected:!1}),o.map((function(o){var t=o["ST_AsGeoJSON(area_area)"];e.areas.push({key:o.id,name:o.area_name,pgon:t,selected:!1})}))}),(function(){})),e.toggleList=function(){angular.element(document.querySelector(".dropdown-content")).toggleClass("show-dropdown-content")},e.selectOption=function(o,t){if(!0===t.selected&&-1===e.selectedItems.indexOf(t))e.selectedItems.push(t),console.log(e.selectedItems);else if(!1===t.selected&&(e.selectedItems=e.selectedItems.filter(e=>e.key!==t.key),console.log(e.selectedItems),0===e.selectedItems.length))return void angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}});if(console.log(e.selectedItems),console.log(o),-1===t.key)return e.selectedItems.reverse().map((function(e){e.selected=!1})),angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}}),void(e.selectedItems=[]);e.Feature=[];var a,n=[];e.id=e.selectedItems[e.selectedItems.length-1].key,e.selectedItems.reverse().map((function(o,t){var a=JSON.parse(o.pgon);e.Feature.push({type:"Feature",properties:{name:o.name,key:o.key},geometry:{type:"Polygon",coordinates:a.coordinates}}),n.push(a.coordinates)})),a=n,e.selectedItems.length>0?angular.extend(e,{center:{lat:a[0][0][0][1],lng:a[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:g,onEachFeature:p}}):angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}})},e.definedLayers={bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/klokantech-basic/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},mapbox_street:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}}},angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},events:{map:{enable:["moveend","popupopen"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/klokantech-basic/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},mapbox_street:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),o.get("http://map.barikoi.xyz:8080").success((function(){})).error((function(){var o=e.layers.baselayers;o.hasOwnProperty("bkoi")&&delete o.bkoi})),s.getMap().then((function(o){s.getLayers().then((function(t){var a=t.overlays.draw;o.on("draw:created",(function(o){var t=o.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))}));var r=n.reduce((e,o)=>e.concat(o),[]);swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update Area Poligon!",closeOnConfirm:!1},(function(){var o={area_area:r.toString()};i.updateSomething(l.POLYGON_AREA+"/"+e.id,o,(function(e){swal("Done","Polygon updated")}),(function(){swal("Error")}))}))}))}))})),s.getMap().then((function(e){r((function(){e.invalidateSize()}),500)})),e.set_area=function(o){e.id=o.id;var t,a=[],n=JSON.parse(o["ST_AsGeoJSON(area_area)"]);a.push(n.coordinates),t=a,console.log(t),angular.extend(e,{center:{lat:t[0][0][0][1],lng:t[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:t}}]},style:g}})},e.openSlide=function(){e.toggle=!e.toggle},e.changeCenter=function(o){e.center.lat=o.lat,e.center.lng=o.lng}}angular.module("barikoi").controller("LocalPolygonArea",e),e.$inject=["$scope","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r){e.city_corps=[{cc_name:"DNCC"},{cc_name:"DSCC"}],e.set_area=function(o){a.getlocations(n.SUBAREA_BY_AREA+o.id+"?",(function(o){e.subareas=o}),(function(e){}))},e.road_number=r.get_data().name,e.ok=function(){t.close()},e.create_zone_polygon=function(e,o){var s={zone_area:r.get_data().toString(),city_corp:e.cc_name,zone_number:o};console.log(s),a.setcategory(n.POLYGON_ZONE+"?",s,(function(e){console.log(e),swal("Nice!","Zone Polygon Inserted ","success"),t.close()}),(function(){swal("Error")}))},e.create_area_polygon=function(e,o){var s={area_area:r.get_data().toString(),area_name:e};try{s.ward_id=o.id}catch(e){console.log(s)}a.setcategory(n.POLYGON_AREA+"?",s,(function(e){console.log(e),swal("Nice!","Area Polygon Inserted ","success"),t.close()}),(function(){swal("Error")}))},e.create_suparea_polygon=function(e,o){var s={supersubarea_area:r.get_data().toString(),subarea_id:e.id,super_subarea_name:o};console.log(s),a.setcategory(n.POLYGON_SUPAREA+"?",s,(function(e){console.log(e),swal("Nice!","Super SubArea Polygon Inserted ","success"),t.close()}),(function(){swal("Error")}))},e.create_subarea_polygon=function(e,o){var s={subarea_area:r.get_data().toString(),area_id:e.id,subarea_name:o};console.log(s),a.setcategory(n.POLYGON_SUBAREA+"?",s,(function(e){console.log(e),swal("Nice!","SubArea Polygon Inserted ","success"),t.close()}),(function(){swal("Error")}))},e.create_thana_polygon=function(e){var o={geom:r.get_data().toString(),thana:e};console.log(o),a.setcategory(n.POLYGON_THANA+"?",o,(function(e){console.log(e),swal("Nice!","Thana Polygon Inserted ","success"),t.close()}),(function(){swal("Error")}))},e.create_ward_polygon=function(e,o){var s={ward_area:r.get_data().toString(),ward_number:o,zone_id:e.id};console.log(s),a.setcategory(n.POLYGON_WARD+"?",s,(function(e){console.log(e),swal("Nice!","Ward Polygon Inserted ","success"),t.close()}),(function(){swal("Error")}))},e.create_road_polyline=function(o,s,l,i,c){var d={road_geometry:r.get_data().toString(),road_name_number:l,area_id:o.id,road_condition:e.road_type.reduce((function(e,o){return e+o.name+", "}),"").replace(/,\s*$/,""),number_of_lanes:i,avg_speed:c};try{d.subarea_id=s.id}catch(e){console.log(d)}a.setcategory(n.POLYLINE_ROAD+"?",d,(function(e){console.log(e),swal("Nice!","Road Polyline Inserted ","success"),t.close()}),(function(){swal("Error")}))},e.update_road_polyline=function(o,t,s){console.log(r.get_data());var l=r.get_data().id,i={road_geometry:r.get_data().poly.toString(),road_name_number:o,road_condition:e.road_type.reduce((function(e,o){return e+o.name+", "}),"").replace(/,\s*$/,""),number_of_lanes:t,avg_speed:s};console.log(i),a.updateSomething(n.POLYLINE_ROAD+"/"+l,i,(function(e){swal("Done","Polyline updated")}),(function(){swal("Error")}))},e.update_name_polyline=function(e,o,t){console.log(r.get_data());var s=r.get_data().id,l={road_name_number:e};console.log(l),a.updateSomething(n.POLYLINE_ROAD+"/"+s,l,(function(e){swal("Done","Polyline updated")}),(function(){swal("Error")}))}}angular.module("barikoi").controller("LocalPolygonModal",e),e.$inject=["$scope","$http","$modalInstance","Auth","urls","DataTunnel"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){c.getlocations(i.POLYGON,(function(o){e.areas=o.area;var t,a=[];e.areas.map((function(e){var o=JSON.parse(e["ST_AsGeoJSON(area)"]);a.push(o.coordinates[0])})),t=a,console.log(t),e.areas.push({id:-1,name:"all","ST_AsGeoJSON(area)":JSON.stringify({type:"Polygon",coordinates:t})})}),(function(){})),c.getlocations(i.GET_SUBTYPES,(function(o){e.subcategories=o,e.subcategories.push({subtype:"all"})}),(function(){}));var p=function(e){return e.map((function(e){return(isNaN(e.latitude)||isNaN(e.longitude))&&(console.log(e.latitude,e.longitude),e.latitude=23.2433323,e.longitude=90.02433323),"<div><p>Address: "+e.Address+"<br></p><p>Subtype: "+e.subType+"<br></p><p>Code: "+e.uCode+"</p></div>",{id:e.id,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),focus:!1,Address:e.Address,subtype:e.subType,uCode:e.uCode,userID:e.user_id,updated_at:e.updated_at,message:"<div ng-include src=\"'views/marker-popup.html'\"></div>",draggable:!0,icon:{iconUrl:"./assets/img/"+e.pType+".png",iconSize:[20,20]}}}))};angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},events:{map:{enable:["moveend","popupopen"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},layers:{baselayers:{mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",attribution:"barikoi",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),l.getMap().then((function(o){l.getLayers().then((function(t){var a=t.overlays.draw;o.on("draw:created",(function(o){var t=o.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))}));var r=n.reduce((e,o)=>e.concat(o),[]);console.log(r.toString()),c.get_with_params(i.POLYGON_CUSTOM+"area="+r.toString(),(function(o){e.total=o.Total,e.markers=p(o.places)}),(function(){swal("Error")}))}))}))})),e.set_area=function(o){console.log(o);var t=JSON.parse(o["ST_AsGeoJSON(area)"]);console.log(t),e.id=JSON.parse(o.id),angular.extend(e,{center:{lat:t.coordinates[0][0][1],lng:t.coordinates[0][0][0],zoom:13},controls:{draw:{}},layers:{baselayers:{mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}},geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:t.coordinates}}]},style:{weight:2,opacity:1,color:"red",dashArray:"3",fillOpacity:0}}}),e.markers={}},e.set_subType=function(o,t){u.start({referenceId:"first"}),null==o&&(o=""),c.get_with_params(i.PLACE_BY_AREA+"area="+o+"&subType="+t,(function(o){u.stop({referenceId:"first"}),e.total=o.Total,e.markers=p(o.places)}),(function(){u.stop({referenceId:"first"})}))},e.$on("leafletDirectiveMarker.click",(function(e,o){d.set_data(o.model)})),e.openSlide=function(){e.toggle=!e.toggle},e.$watch("mapView",(function(o){console.log(e.mapView),!0===o&&l.getMap().then((function(o){$timeout((function(){o.invalidateSize(),l.getMap().then((function(o){e.mapBounds.length<1&&e.mapBounds.push([e.location.coords.longitude,e.location.coords.latitude]);var t=L.latLngBounds(e.mapBounds);e.maxBounds.southWest=t.getSouthWest(),e.maxBounds.northEast=t.getNorthEast(),o.fitBounds(t)}))}),300)}))})),e.$on("leafletDirectiveMarker.dragend",(function(e,o){o.model.lat,o.model.lng;swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update marker position!",closeOnConfirm:!1},(function(){c.updateSomething2(i.DROP_MARKER+o.model.id+"?longitude="+o.model.lng+"&latitude="+o.model.lat,(function(e){swal("Done","marker position has been updated")}),(function(){swal("Error")}))}))})),e.changeCenter=function(o){e.center.lat=o.lat,e.center.lng=o.lng,d.set_data(o),o.focus=!0}}angular.module("barikoi").controller("LocalPolygonSearch",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$anchorScroll","$location","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c){i.getlocations(l.POLYGON,(function(o){e.areas=o.area}),(function(){})),i.getlocations(l.GET_SUBTYPES,(function(o){e.subcategories=o,e.subcategories.push({subtype:"all"})}),(function(){}));angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/klokantech-basic/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),s.getMap().then((function(e){s.getLayers().then((function(o){var t=o.overlays.draw;e.on("draw:created",(function(e){var o=e.layer;t.addLayer(o);var a=[];o.toGeoJSON().geometry.coordinates[0].map((function(e){a.push(e.join(" "))}));var n=a.reduce((e,o)=>e.concat(o),[]);swal({title:"Polygon Name?",type:"input",showCancelButton:!0,closeOnConfirm:!1,inputPlaceholder:"Ex: Mirpur-2, Banani etc"},(function(e){if(!1===e)return!1;if(""===e)return swal.showInputError("Only tagging is real!"),!1;var o={area:n.toString(),name:e};i.post_anything(l.POLYGON_CREATE,o,(function(e){console.log(e),swal("Nice!","New Polygon Inserted ","success")}),(function(){}))}))}))}))})),e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng}}angular.module("barikoi").controller("LocalPolygonStudio",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$location","leafletData","urls","Auth","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d){e.selectedItems=[],e.subareas=[{key:1,name:"Mirpur 2"}];function u(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function p(e,o){o.bindTooltip(e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function g(e){return{fillColor:u(),opacity:1,color:u(),dashArray:"3",fillOpacity:.4}}i.getlocations(l.POLYGON_AREA,(function(o){e.areas=o}),(function(){})),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},events:{map:{enable:["moveend","popupopen"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/klokantech-basic/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),s.getMap().then((function(o){s.getLayers().then((function(t){var a=t.overlays.draw;o.on("draw:created",(function(o){var t=o.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))}));var r=n.reduce((e,o)=>e.concat(o),[]);swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update Subrea Poligon!",closeOnConfirm:!1},(function(){var o={area:r.toString()};i.updateSomething(l.POLYGON_SUBAREA+"/"+e.id,o,(function(e){swal("Done","Polygon updated")}),(function(){swal("Error")}))}))}))}))})),s.getMap().then((function(e){r((function(){e.invalidateSize()}),500)})),e.set_area=function(o){e.id=o.id,i.getlocations(l.SUBAREA_BY_AREA+e.id+"?",(function(o){e.subareas=[],e.subareas.push({key:-1,name:"clear",pgon:"nai",selected:!1}),o.map((function(o){var t=o["ST_AsGeoJSON(subarea_area)"];e.subareas.push({key:o.id,name:o.subarea_name,pgon:t,selected:!1})}))}),(function(){}))},e.toggleList=function(){angular.element(document.querySelector(".dropdown-content")).toggleClass("show-dropdown-content")},e.selectOption=function(o,t){if(!0===t.selected&&-1===e.selectedItems.indexOf(t))e.selectedItems.push(t),console.log(e.selectedItems);else if(!1===t.selected&&(e.selectedItems=e.selectedItems.filter(e=>e.key!==t.key),console.log(e.selectedItems),0===e.selectedItems.length))return void angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}});if(console.log(e.selectedItems),console.log(o),-1===t.key)return e.selectedItems.reverse().map((function(e){e.selected=!1})),angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}}),void(e.selectedItems=[]);e.Feature=[];var a,n=[];e.id=e.selectedItems[e.selectedItems.length-1].key,e.selectedItems.reverse().map((function(o,t){var a=JSON.parse(o.pgon);e.Feature.push({type:"Feature",properties:{name:o.name,key:o.key},geometry:{type:"Polygon",coordinates:a.coordinates}}),n.push(a.coordinates)})),a=n,e.selectedItems.length>0?angular.extend(e,{center:{lat:a[0][0][0][1],lng:a[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:g,onEachFeature:p}}):angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}})},e.openSlide=function(){e.toggle=!e.toggle},e.changeCenter=function(o){e.center.lat=o.lat,e.center.lng=o.lng}}angular.module("barikoi").controller("LocalPolygonSubArea",e),e.$inject=["$scope","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d){e.selectedItems=[],e.supareas=[{key:1,name:"Mirpur 2"}];function u(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function p(e,o){o.bindTooltip(e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function g(e){return{fillColor:u(),opacity:1,color:u(),dashArray:"3",fillOpacity:.4}}i.getlocations(l.POLYGON_AREA,(function(o){e.areas=o}),(function(){})),i.getlocations(l.POLYGON_SUPAREA+"?",(function(o){e.supareas=[],o.map((function(o){var t=o["ST_AsGeoJSON(supersubarea_area)"];e.supareas.push({key:o.id,name:o.super_subarea_name,pgon:t,selected:!1})}))}),(function(){})),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},events:{map:{enable:["moveend","popupopen"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/klokantech-basic/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),s.getMap().then((function(o){s.getLayers().then((function(t){var a=t.overlays.draw;o.on("draw:created",(function(o){var t=o.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))}));var r=n.reduce((e,o)=>e.concat(o),[]);swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update Subrea Poligon!",closeOnConfirm:!1},(function(){var o={area:r.toString()};i.updateSomething(l.POLYGON_SUPAREA+"/"+e.id,o,(function(e){swal("Done","Polygon updated")}),(function(){swal("Error")}))}))}))}))})),s.getMap().then((function(e){r((function(){e.invalidateSize()}),500)})),e.toggleList=function(){angular.element(document.querySelector(".dropdown-content")).toggleClass("show-dropdown-content")},e.selectOption=function(o,t){if(!0===t.selected&&-1===e.selectedItems.indexOf(t))e.selectedItems.push(t),console.log(e.selectedItems);else if(!1===t.selected&&(e.selectedItems=e.selectedItems.filter(e=>e.key!==t.key),console.log(e.selectedItems),0===e.selectedItems.length))return void angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}});if(console.log(e.selectedItems),console.log(o),-1===t.key)return e.selectedItems.reverse().map((function(e){e.selected=!1})),angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}}),void(e.selectedItems=[]);e.Feature=[];var a,n=[];e.id=e.selectedItems[e.selectedItems.length-1].key,e.selectedItems.reverse().map((function(o,t){var a=JSON.parse(o.pgon);e.Feature.push({type:"Feature",properties:{name:o.name,key:o.key},geometry:{type:"Polygon",coordinates:a.coordinates}}),n.push(a.coordinates)})),a=n,e.selectedItems.length>0?angular.extend(e,{center:{lat:a[0][0][0][1],lng:a[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:g,onEachFeature:p}}):angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}})},e.openSlide=function(){e.toggle=!e.toggle},e.changeCenter=function(o){e.center.lat=o.lat,e.center.lng=o.lng}}angular.module("barikoi").controller("LocalPolygonSupArea",e),e.$inject=["$scope","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d){e.selectedItems=[],e.wards=[{key:1,name:"1"}];function u(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function p(e,o){o.bindTooltip("Ward : "+e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function g(e){return{fillColor:u(),opacity:1,color:u(),dashArray:"3",fillOpacity:.4}}i.getlocations(l.POLYGON_ZONE+"?",(function(o){e.zones=o}),(function(){})),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},events:{map:{enable:["moveend","popupopen"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/klokantech-basic/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),s.getMap().then((function(e){r((function(){e.invalidateSize()}),500)})),s.getMap().then((function(o){s.getLayers().then((function(t){var a=t.overlays.draw;o.on("draw:created",(function(o){var t=o.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))}));var r=n.reduce((e,o)=>e.concat(o),[]);swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update Area Poligon!",closeOnConfirm:!1},(function(){var o={ward_area:r.toString()};i.updateSomething(l.POLYGON_WARD+"/"+e.id,o,(function(e){swal("Done","Polygon updated")}),(function(){swal("Error")}))}))}))}))})),e.set_zone=function(o){e.id=o.id,i.getlocations(l.WARDS_BY_ZONE+e.id+"?",(function(o){e.wards=[],e.wards.push({key:-1,name:"clear",pgon:"nai",selected:!1}),o.map((function(o){var t=o["ST_AsGeoJSON(ward_area)"];e.wards.push({key:o.id,name:o.ward_number,pgon:t,selected:!1})}))}),(function(){}))},e.toggleList=function(){angular.element(document.querySelector(".dropdown-content")).toggleClass("show-dropdown-content")},e.selectOption=function(o,t){if(!0===t.selected&&-1===e.selectedItems.indexOf(t))e.selectedItems.push(t),console.log(e.selectedItems);else if(!1===t.selected&&(e.selectedItems=e.selectedItems.filter(e=>e.key!==t.key),console.log(e.selectedItems),0===e.selectedItems.length))return void angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}});if(console.log(e.selectedItems),console.log(o),-1===t.key)return e.selectedItems.reverse().map((function(e){e.selected=!1})),angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}}),void(e.selectedItems=[]);e.Feature=[];var a,n=[];e.id=e.selectedItems[e.selectedItems.length-1].key,e.selectedItems.reverse().map((function(o,t){var a=JSON.parse(o.pgon);e.Feature.push({type:"Feature",properties:{name:o.name,key:o.key},geometry:{type:"Polygon",coordinates:a.coordinates}}),n.push(a.coordinates)})),a=n,e.selectedItems.length>0?angular.extend(e,{center:{lat:a[0][0][0][1],lng:a[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:g,onEachFeature:p}}):angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}})},e.openSlide=function(){e.toggle=!e.toggle},e.changeCenter=function(o){e.center.lat=o.lat,e.center.lng=o.lng}}angular.module("barikoi").controller("LocalPolygonWard",e),e.$inject=["$scope","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d){function u(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function p(e,o){o.bindTooltip("Zone : "+e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function g(e){return{fillColor:u(),opacity:1,color:u(),dashArray:"3",fillOpacity:.4}}console.log("base: id",e.id),e.zones=[{key:1,name:"1"}],i.getlocations(l.POLYGON_ZONE,(function(o){e.selectedItems=[],e.zones=o}),(function(){})),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},events:{map:{enable:["moveend","popupopen"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/klokantech-basic/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),s.getMap().then((function(o){s.getLayers().then((function(t){var a=t.overlays.draw;o.on("draw:created",(function(o){var t=o.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))}));var r=n.reduce((e,o)=>e.concat(o),[]);swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update Zone Poligon!",closeOnConfirm:!1},(function(){var o={zone_area:r.toString()};i.updateSomething(l.POLYGON_ZONE+"/"+e.id,o,(function(e){swal("Done","Polygon updated")}),(function(){swal("Error")}))}))}))}))})),s.getMap().then((function(e){r((function(){e.invalidateSize()}),500)})),e.toggleList=function(){angular.element(document.querySelector(".dropdown-content")).toggleClass("show-dropdown-content")},e.selectOption=function(o,t){if(console.log(t),!0===t.selected&&-1===e.selectedItems.indexOf(t))e.selectedItems.push(t),console.log(e.selectedItems);else if(!1===t.selected&&(e.selectedItems=e.selectedItems.filter(e=>e.key!==t.key),console.log(e.selectedItems),0===e.selectedItems.length))return void angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}});if(console.log(e.selectedItems),console.log(o),-1===t.key)return e.selectedItems.reverse().map((function(e){e.selected=!1})),angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}}),void(e.selectedItems=[]);e.Feature=[];var a,n=[];e.id=e.selectedItems[e.selectedItems.length-1].key,e.selectedItems.reverse().map((function(o,t){var a=JSON.parse(o.pgon);e.Feature.push({type:"Feature",properties:{name:o.name,key:o.key},geometry:{type:"Polygon",coordinates:a.coordinates}}),n.push(a.coordinates)})),a=n,e.selectedItems.length>0?angular.extend(e,{center:{lat:a[0][0][0][1],lng:a[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:g,onEachFeature:p}}):angular.extend(e,{geojson:{data:{type:"FeatureCollection",features:[]}}})},e.openSlide=function(){e.toggle=!e.toggle},e.changeCenter=function(o){e.center.lat=o.lat,e.center.lng=o.lng}}angular.module("barikoi").controller("LocalPolygonZone",e),e.$inject=["$scope","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){var p=new L.FeatureGroup,g=function(){c.getlocations(i.POLYGON_WARD+"?",(function(o){e.wards=o}),(function(){})),c.getlocations(i.POLYGON_AREA+"?",(function(o){e.areas=o}),(function(){}))};g(),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://geoserver.barikoi.com:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",attribution:"barikoi",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google",layerOptions:{attribution:"barikoi",maxZoom:23}}},overlays:{}}}),e.Feature=[];let m=!1;function y(e,o){o.bindTooltip(e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function f(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function h(e){return{fillColor:f(),opacity:1,color:f(),dashArray:"3",fillOpacity:.4}}l.getMap().then((function(t){e.map=t,s((function(){t.invalidateSize()}),500),t.addLayer(p),L.drawLocal.draw.toolbar.buttons.polygon="Draw a polygon!";var a=new L.Control.Draw({position:"topleft",draw:{polygon:{drawError:{color:"#b00b00",timeout:1e3},shapeOptions:{color:"#662d91"}},circle:{shapeOptions:{color:"#662d91"}},marker:!1},edit:{featureGroup:p,remove:!1}});t.addControl(a),t.on("draw:created",(function(t){t.layerType;var a=t.layer;console.log(a);a=t.layer;p.addLayer(a);var n=[];a.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),e.coordinates=n.reduce((e,o)=>e.concat(o),[]),d.set_data(e.coordinates);o.open({templateUrl:"/../../views/local-admin/polygon-area-mod.html",controller:"LocalPolygonModal",size:"lg",scope:e});p.addLayer(a)})),t.on("draw:edited",(function(o){var t=o.layers,a=[];console.log(t.toGeoJSON()),t.toGeoJSON().features[0].geometry.coordinates[0].map((function(e){a.push(e.join(" "))})),e.coordinates=a.reduce((e,o)=>e.concat(o),[]),console.log("UPDATING: ",e.zoneId),swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update Area Poligon!",closeOnConfirm:!1},(function(){var o={area_area:e.coordinates.toString()};c.updateSomething(i.POLYGON_AREA+"/"+e.zoneId,o,(function(e){swal("Done","Area Polygon updated"),g()}),(function(){swal("Error")}))}))}))})),e.set_ward=function(o){c.getlocations(i.AREA_BY_WARD+e.zoneId+"?",(function(o){e.roads=o;var t,a=[];e.Feature=[],e.roads.map((function(o,t){var n=JSON.parse(o["ST_AsGeoJSON(area_area)"]);e.Feature.push({type:"Feature",properties:{name:o.area_name,ward_id:o.ward_id},geometry:{type:"Polygon",coordinates:n.coordinates}}),a.push(n.coordinates)})),t=a,angular.extend(e,{center:{lat:t[0][0][0][1],lng:t[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:h}})}),(function(){}))},e.set_area=function(o){d.set_data(o);var t,a=[],n=JSON.parse(o["ST_AsGeoJSON(area_area)"]),r=JSON.parse(o["ST_AsGeoJSON(area_area)"]);if(a.push(r.coordinates),t=a,1==m){let a={ScopeId:e.zoneId,currentlyEdting:e.currentlyEdting,selectedPlace:`${o.id} (${o.area_name})`};console.table(a),e.Feature.push({type:"Feature",properties:{name:o.area_name},geometry:{type:"Polygon",coordinates:r.coordinates}}),angular.extend(e,{center:{lat:t[0][0][0][1],lng:t[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:h,onEachFeature:y}})}else if(0==m){e.zoneId=o.id,e.currentlyEdting=o.area_name;let t={ScopeId:e.zoneId,currentlyEdting:e.currentlyEdting,selectedPlace:`${o.id} (${o.area_name})`};console.table(t);for(var s=n.coordinates[0].length;s--;){a=n.coordinates[0][s][0];n.coordinates[0][s][0]=n.coordinates[0][s][1],n.coordinates[0][s][1]=a}var l=L.polygon(n.coordinates).bindPopup(o.id);p.addLayer(l),m=!0,angular.extend(e,{center:{lat:n.coordinates[0][0][0],lng:n.coordinates[0][0][1],zoom:14}})}},e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng},e.openSlide=function(){e.toggle=!e.toggle},e.clearEditable=()=>{l.getMap().then((function(o){p.clearLayers(),m=!1,e.currentlyEdting=null,g()}))}}angular.module("barikoi").controller("LocalPolygonStdArea",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){var p=new L.FeatureGroup,g=function(){c.getlocations(i.POLYGON_AREA,(function(o){e.areas=o}),(function(){})),c.getlocations(i.POLYGON_SUBAREA,(function(o){e.subareas=o}),(function(){}))};g(),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://geoserver.barikoi.com:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",attribution:"barikoi",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google",layerOptions:{attribution:"barikoi",maxZoom:23}}},overlays:{}}}),e.Feature=[];let m=!1;function y(e){return{opacity:2,color:"#D4A76A",dashArray:"3",fillOpacity:.7}}function f(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function h(e,o){o.bindTooltip(e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function y(e){return{fillColor:f(),opacity:1,color:f(),dashArray:"3",fillOpacity:.4}}l.getMap().then((function(t){s((function(){t.invalidateSize()}),500),t.addLayer(p),L.drawLocal.draw.toolbar.buttons.polygon="Draw a sexy polygon!";var a=new L.Control.Draw({position:"topleft",draw:{polygon:{drawError:{color:"#b00b00",timeout:1e3},shapeOptions:{color:"#662d91"}},circle:{shapeOptions:{color:"#662d91"}},marker:!1},edit:{featureGroup:p,remove:!1}});t.addControl(a),t.on("draw:created",(function(t){t.layerType;var a=t.layer;console.log(a);a=t.layer;p.addLayer(a);var n=[];a.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),e.coordinates=n.reduce((e,o)=>e.concat(o),[]),d.set_data(e.coordinates);o.open({templateUrl:"/../../views/local-admin/polygon-subarea-mod.html",controller:"LocalPolygonModal",size:"lg",scope:e,backdrop:"static"});p.addLayer(a)})),t.on("draw:edited",(function(o){console.log("updating ",e.subAreaId);var t=o.layers,a=[];console.log(t.toGeoJSON()),t.toGeoJSON().features[0].geometry.coordinates[0].map((function(e){a.push(e.join(" "))})),e.coordinates=a.reduce((e,o)=>e.concat(o),[]),swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update SubArea Poligon!",closeOnConfirm:!1},(function(){var o={area:e.coordinates.toString()};c.updateSomething(i.POLYGON_SUBAREA+"/"+e.subAreaId,o,(function(e){swal("Done","SubArea Polygon updated")}),(function(){swal("Error")}))}))}))})),e.set_area=function(o){console.log("scopeid ",e.subAreaId),c.getlocations(i.SUBAREA_BY_AREA+o.id+"?",(function(o){e.roads=o;var t,a=[];e.Feature=[],e.roads.map((function(o,t){var n=JSON.parse(o["ST_AsGeoJSON(subarea_area)"]);e.Feature.push({type:"Feature",properties:{name:o.area_name},geometry:{type:"Polygon",coordinates:n.coordinates}}),a.push(n.coordinates)})),t=a,angular.extend(e,{center:{lat:t[0][0][0][1],lng:t[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:y,onEachFeature:h},selectedRoad:{},events:{geojson:{enable:["click","mouseover"]}}})}),(function(){}))},e.set_sub_area=function(o){d.set_data(o);var t,a=[],n=JSON.parse(o["ST_AsGeoJSON(subarea_area)"]),r=JSON.parse(o["ST_AsGeoJSON(subarea_area)"]);if(a.push(r.coordinates),t=a,1==m)console.log("scopeid ",e.subAreaId),e.Feature.push({type:"Feature",properties:{name:o.subarea_name},geometry:{type:"Polygon",coordinates:r.coordinates}}),angular.extend(e,{center:{lat:t[0][0][0][1],lng:t[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:y,onEachFeature:h}});else if(0==m){e.currentlyEdting=o.subarea_name,e.subAreaId=o.id,console.log("scopeid ",e.subAreaId);for(var s=n.coordinates[0].length;s--;){a=n.coordinates[0][s][0];n.coordinates[0][s][0]=n.coordinates[0][s][1],n.coordinates[0][s][1]=a}var l=L.polygon(n.coordinates).bindPopup(o.id);p.addLayer(l),m=!0,angular.extend(e,{center:{lat:n.coordinates[0][0][0],lng:n.coordinates[0][0][1],zoom:14}})}},e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng},e.openSlide=function(){e.toggle=!e.toggle},e.clearEditable=()=>{l.getMap().then((function(o){p.clearLayers(),m=!1,e.currentlyEdting=null,g()}))}}angular.module("barikoi").controller("LocalPolygonStdSubArea",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){var p=new L.FeatureGroup,g=function(){c.getlocations(i.POLYGON_SUBAREA,(function(o){e.subareas=o}),(function(){})),c.getlocations(i.POLYGON_SUPAREA,(function(o){e.supareas=o}),(function(){}))};g(),c.getlocations(i.POLYGON_AREA+"?",(function(o){e.areas=o}),(function(){})),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://geoserver.barikoi.com:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",attribution:"barikoi",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google",layerOptions:{attribution:"barikoi",maxZoom:23}}},overlays:{}}}),e.Feature=[];let m=!1;function y(e,o){o.bindTooltip(e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function f(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function h(e){return{fillColor:f(),opacity:1,color:f(),dashArray:"3",fillOpacity:.4}}l.getMap().then((function(t){s((function(){t.invalidateSize()}),500),t.addLayer(p),L.drawLocal.draw.toolbar.buttons.polygon="Draw a sexy polygon!";var a=new L.Control.Draw({position:"topleft",draw:{polygon:{drawError:{color:"#b00b00",timeout:1e3},shapeOptions:{color:"#bada55"}},circle:{shapeOptions:{color:"#662d91"}},marker:!1},edit:{featureGroup:p,remove:!1}});t.addControl(a),t.on("draw:created",(function(t){t.layerType;var a=t.layer;console.log(a);a=t.layer;p.addLayer(a);var n=[];a.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),e.coordinates=n.reduce((e,o)=>e.concat(o),[]),d.set_data(e.coordinates);o.open({templateUrl:"/../../views/local-admin/polygon-suparea-mod.html",controller:"LocalPolygonModal",size:"lg",scope:e,backdrop:"static"});p.addLayer(a)})),t.on("draw:edited",(function(o){var t=o.layers,a=[];console.log(t.toGeoJSON()),t.toGeoJSON().features[0].geometry.coordinates[0].map((function(e){a.push(e.join(" "))})),e.coordinates=a.reduce((e,o)=>e.concat(o),[]),swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update Super SubArea Poligon!",closeOnConfirm:!1},(function(){var o={area:e.coordinates.toString()};c.updateSomething(i.POLYGON_SUPAREA+"/"+e.superSubAreaId,o,(function(e){swal("Done","Super SubArea Polygon updated")}),(function(){swal("Error")}))}))}))})),e.set_subarea=function(o){var t,a=[];e.Feature=[];var n=JSON.parse(o["ST_AsGeoJSON(subarea_area)"]);e.Feature.push({type:"Feature",properties:{name:o.subarea_name},geometry:{type:"Polygon",coordinates:n.coordinates}}),a.push(n.coordinates),t=a,angular.extend(e,{center:{lat:t[0][0][0][1],lng:t[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:{weight:2,opacity:1,color:"red",dashArray:"3",fillOpacity:0}},selectedRoad:{},events:{geojson:{enable:["click","mouseover"]}}})},e.set_sup_area=function(o){d.set_data(o),console.log("supsubarea",o);var t,a=[],n=JSON.parse(o["ST_AsGeoJSON(supersubarea_area)"]),r=JSON.parse(o["ST_AsGeoJSON(supersubarea_area)"]);if(a.push(n.coordinates),t=a,console.log(n.coordinates),1==m)console.log("editing ",e.superSubAreaId),e.Feature.push({type:"Feature",properties:{name:o.super_subarea_name},geometry:{type:"Polygon",coordinates:n.coordinates}}),angular.extend(e,{center:{lat:t[0][0][0][1],lng:t[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:h,onEachFeature:y}});else if(0==m){e.currentlyEdting=o.super_subarea_name,e.superSubAreaId=o.id,console.log("editing ",e.superSubAreaId);for(var s=r.coordinates[0].length;s--;){a=r.coordinates[0][s][0];r.coordinates[0][s][0]=r.coordinates[0][s][1],r.coordinates[0][s][1]=a}var l=L.polygon(r.coordinates).bindPopup(o.id);p.addLayer(l),m=!0,angular.extend(e,{center:{lat:r.coordinates[0][0][0],lng:r.coordinates[0][0][1],zoom:14}})}},e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng},e.openSlide=function(){e.toggle=!e.toggle},e.clearEditable=()=>{l.getMap().then((function(o){p.clearLayers(),m=!1,e.currentlyEdting=null,g()}))}}angular.module("barikoi").controller("LocalPolygonStdSupArea",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){e.dynamicIconSize=[25,25];function p(e,o){o=o||",";for(var t=new RegExp("(\\"+o+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+o+"\\r\\n]*))","gi"),a=[[]],n=null;n=t.exec(e);){var r,s=n[1];s.length&&s!==o&&a.push([]),n[2]?r=n[2].replace(new RegExp('""',"g"),'"'):(isNaN(parseFloat(n[3]))||(n[3]=parseFloat(n[3])),r=n[3]),a[a.length-1].push(r)}return a}function g(e,o){return(e=e.slice(0)).splice(o-1,1),e}e.division_logistics_data={company_data:[{company_title:"Biddyut Limited ",contact_no:"016XXXXXXXX",email:"logistics@Biddyut",company_type:"general"},{company_title:"PROKRITI INC",contact_no:"017XXXXXXXX",email:"logistics@prokriti",company_type:"general"},{company_title:"Mingle Limited ",contact_no:"018XXXXXXXX",email:"logistics@Mingle ",company_type:"general"},{company_title:"ekshop.gov.bd",contact_no:"015XXXXXXXX",email:"logistics@ekshop.com",company_type:"general"},{company_title:"eCourier Ltd",contact_no:"017XXXXXXXX",email:"logistics@eCourier.com",company_type:"general"},{company_title:"Truck Lagbe Ltd",contact_no:"019XXXXXXXX",email:"logistics@Trucklagbe.com",company_type:"general"},{company_title:"Trendy Tracker",contact_no:"017XXXXXXXX",email:"logistics@Trendytracker.com",company_type:"general"},{company_title:"Amar Bazar",contact_no:"013XXXXXXXX",email:"logistics@Amar Bazar",company_type:"general"},{company_title:"Pathao Next-Day",contact_no:"016XXXXXXXX",email:"logistics@pathao.com",company_type:"general"},{company_title:"RedX",contact_no:"017XXXXXXXX",email:"logistics@RedX.com",company_type:"general"},{company_title:"Daraz",contact_no:"016XXXXXXXX",email:"logistics@Daraz.com",company_type:"general"},{company_title:"Paperfly",contact_no:"017XXXXXXXX",email:"logistics@ppfly.com",company_type:"general"}],district_cover:["all"]},e.dhaka_logistics_data={company_data:[{company_title:"Chaldal.com ",contact_no:"016XXXXXXXX",email:"logistics@Chaldal.com",company_type:"general"},{company_title:"sindabad.com",contact_no:"017XXXXXXXX",email:"logistics@sindabad.com",company_type:"general"},{company_title:"Cookups Technologies Ltd.  ",contact_no:"018XXXXXXXX",email:"logistics@Cookups.com",company_type:"general"},{company_title:"PoshaPrani.com",contact_no:"015XXXXXXXX",email:"logistics@PoshaPrani.com",company_type:"general"},{company_title:"Pickaboo",contact_no:"017XXXXXXXX",email:"logistics@Pickaboo.com",company_type:"general"},{company_title:"Truck Lagbe Ltd",contact_no:"019XXXXXXXX",email:"logistics@Trucklagbe.com",company_type:"general"},{company_title:"petbangla.com",contact_no:"017XXXXXXXX",email:"logistics@petbangla.commands",company_type:"general"},{company_title:"PriyoShop Ltd",contact_no:"013XXXXXXXX",email:"logistics@PriyoShop.com",company_type:"general"},{company_title:"The Mall Ltd",contact_no:"016XXXXXXXX",email:"logistics@Mall.com",company_type:"general"}],district_cover:["Dhaka"]},e.district_wise_data=[{company_title:"Pathao Inc.",contact_no:"016XXXXXXXX",email:"logistics@pathao",company_type:"general",district_cover:["Ruma, Bandarban","Rangunia, Chittagong","Bagha, Rajshahi"]},{company_title:"Paper Fly.",contact_no:"017XXXXXXXX",email:"logistics@ppfly",company_type:"general",district_cover:["Bhairab, Kishoreganj","Chhatak, Sunamganj","Hatiya, Noakhali"]}];c.getlocations("./data/subdistricts_new.csv",(function(o){e.district_list=p(o,","),e.district_list=g(e.district_list,1),e.district_list=g(e.district_list,e.district_list.length)}),(function(){})),c.getlocations("./data/division_new.csv",(function(o){e.division_list=p(o,","),e.division_list=g(e.division_list,1),e.division_list=g(e.division_list,e.division_list.length)}),(function(){})),c.getlocations("./data/only_dhaka.csv",(function(o){e.dhaka_list=p(o,","),e.dhaka_list=g(e.dhaka_list,1),e.dhaka_list=g(e.dhaka_list,e.dhaka_list.length)}),(function(){})),c.getlocations("./data/udc.csv",(function(o){e.udc_points=p(o,","),e.udc_points=g(e.udc_points,1),e.udc_points=g(e.udc_points,e.udc_points.length),e.markers=e.udc_points.map((function(o,t){return{layer:"udc",id:t,div:o[0],dis:o[1],subdis:o[2],uni:o[3],lat:parseFloat(o[5]),lng:parseFloat(o[6]),focus:!0,message:"<div ng-include src=\"'views/marker-popup.html'\"></div>",icon:{iconUrl:"./assets/img/dot.png",iconSize:e.dynamicIconSize,iconAnchor:[12,41],popupAnchor:[1,-34]}}}))}),(function(){})),c.getlocations("./data/provider.csv",(function(o){var t=p(o,",");t=g(t,1),t=g(t,t.length),e.item_provider_grouped_obj=h(t,1),console.clear();for(const o in e.item_provider_grouped_obj)e.item_provider_grouped_obj[o].map((function(e){console.log(e[3])}))}),(function(){})),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},layers:{baselayers:{osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{udc:{name:"udc",type:"group",visible:!1}}}}),e.Feature=[];function m(e,o){o.bindTooltip(e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function y(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function f(e){return{fillColor:y(),opacity:1,color:y(),dashArray:"3",fillOpacity:.4}}l.getMap().then((function(e){s((function(){e.invalidateSize()}),500)})),e.$on("leafletDirectiveMarker.click",(function(e,o){d.set_data(o.model)})),e.set_thana=function(o){c.getlocations(i.POLYGON_THANA+"/"+o.id,(function(o){let t=o[0];d.set_data(t);var a,n=[],r=JSON.parse(t["ST_AsGeoJSON(geom)"]);console.log(r);var s=JSON.parse(t["ST_AsGeoJSON(geom)"]);n.push(s.coordinates),a=n;let l={ScopeId:e.zoneId,currentlyEdting:e.currentlyEdting,selectedPlace:`${t.id} (${t.thana})`};console.log("in to the True"),console.table(l),e.Feature.push({type:"Feature",properties:{name:t.thana},geometry:{type:"MultiPolygon",coordinates:s.coordinates}}),angular.extend(e,{center:{lat:a[0][0][0][0][1],lng:a[0][0][0][0][0],zoom:11},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:f,onEachFeature:m}})}),(function(){}))},e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng},e.openSlide=function(){e.toggle=!e.toggle};var h=function(e,o){return e.reduce((function(e,t){return 1==t[o].split(",").length?(e[t[o.toString().trim()]]=e[t[o.toString().trim()]]||[]).push(t):t[o].split(",").map((function(o){(e[o.toString().trim()]=e[o.toString().trim()]||[]).push(t)})),e}),{})};e.$watch("center.zoom",(function(o){e.dynamicIconSize=o>12?[25,25]:[15,15]})),e.select_admin_level=function(){switch(console.log(e.admin_level),e.admin_level){case"0":console.log("Hey Its Division"),e.geojson_division=[],e.geojson_district=null,e.geojson_dhaka=null,e.division_list.map((function(o){let t={type:"Feature",geometry:{type:"MultiPolygon",coordinates:JSON.parse(o[1])},properties:{name:o[0].trim()}};console.log("GeoJson To Sring"),e.geojson_division.push(t)}));var o=[],t=[];e.Feature=[],e.geojson_division.map((function(o,a){console.log("print all geo arrray");var n=o.geometry;e.Feature.push(o),t.push(n.coordinates)})),o=t,angular.extend(e,{center:{lat:o[2][0][0][0][1],lng:o[2][0][0][0][0],zoom:9},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:f,onEachFeature:m}});break;case"1":let a=[];console.log("Hey Its Districts"),e.district_wise_data.map((function(e){a.push(e.district_cover)})),e.geojson_district=[],e.geojson_division=null,e.geojson_dhaka=null,a.flat().map((function(o){e.district_list.find((function(t){if(t[0].trim().toLowerCase()==o.split(",")[0].trim().toLowerCase()&&t[1].trim().toLowerCase()==o.split(",")[1].trim().toLowerCase()){console.log("the geo string test"),console.log(t[2].toString());let o={type:"Feature",geometry:{type:"MultiPolygon",coordinates:JSON.parse(t[2])},properties:{name:t[0].trim()}};console.log("GeoJson To Sring"),e.geojson_district.push(o)}}))}));o=[],t=[];e.Feature=[],e.geojson_district.map((function(o,a){console.log("print all geo arrray");var n=o.geometry;e.Feature.push(o),t.push(n.coordinates)})),o=t,angular.extend(e,{center:{lat:o[0][0][0][0][1],lng:o[0][0][0][0][0],zoom:11},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:f,onEachFeature:m}});break;case"2":console.log("Hey Its Dhaka"),e.geojson_division=null,e.geojson_district=null,e.geojson_dhaka=[],e.dhaka_list.map((function(o){let t={type:"Feature",geometry:{type:"MultiPolygon",coordinates:JSON.parse(o[1])},properties:{name:o[0].trim()}};console.log("GeoJson To Sring"),e.geojson_dhaka.push(t)}));o=[],t=[];e.Feature=[],e.geojson_dhaka.map((function(o,a){console.log("print all geo arrray");var n=o.geometry;console.log(n),e.Feature.push(o),t.push(n.coordinates)})),o=t,angular.extend(e,{center:{lat:o[0][0][0][0][1],lng:o[0][0][0][0][0],zoom:11},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:f,onEachFeature:m}});break;default:console.log("Nothing will Happen")}}}angular.module("barikoi").controller("LocalPolygonStdThana",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){var p=new L.FeatureGroup,g=function(){c.getlocations(i.POLYGON_ZONE+"?",(function(o){e.zones=o}),(function(){})),c.getlocations(i.POLYGON_WARD+"?",(function(o){e.wards=o}),(function(){}))};g(),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://geoserver.barikoi.com:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",attribution:"barikoi",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google",layerOptions:{attribution:"barikoi",maxZoom:23}}},overlays:{}}}),e.Feature=[];let m=!1;function y(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function f(e,o){o.bindTooltip("Ward : "+e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function h(e){return{fillColor:y(),opacity:1,color:y(),dashArray:"3",fillOpacity:.4}}l.getMap().then((function(t){s((function(){t.invalidateSize()}),500),t.addLayer(p),L.drawLocal.draw.toolbar.buttons.polygon="Draw a polygon!";var a=new L.Control.Draw({position:"topleft",draw:{polygon:{drawError:{color:"#bada55",timeout:1e3},shapeOptions:{color:"#662d91"}},circle:{shapeOptions:{color:"#662d91"}},marker:!1},edit:{featureGroup:p,remove:!1}});t.addControl(a),t.on("draw:created",(function(t){t.layerType;var a=t.layer;console.log(a);a=t.layer;p.addLayer(a);var n=[];a.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),e.coordinates=n.reduce((e,o)=>e.concat(o),[]),d.set_data(e.coordinates);o.open({templateUrl:"/../../views/local-admin/polygon-ward-mod.html",controller:"LocalPolygonModal",size:"lg",scope:e,backdrop:"static"});p.addLayer(a)})),t.on("draw:edited",(function(o){console.log("updating: ",e.wardId);var t=o.layers,a=[];console.log(t.toGeoJSON()),t.toGeoJSON().features[0].geometry.coordinates[0].map((function(e){a.push(e.join(" "))})),e.coordinates=a.reduce((e,o)=>e.concat(o),[]),swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update Ward Poligon!",closeOnConfirm:!1},(function(){var o={ward_area:e.coordinates.toString()};c.updateSomething(i.POLYGON_WARD+"/"+e.wardId,o,(function(e){swal("Done","Ward Polygon updated")}),(function(){swal("Error")}))}))}))})),e.set_zone=function(o){e.Feature=[],c.getlocations(i.WARDS_BY_ZONE+o.id,(function(o){e.roads=o;var t,a=[];e.roads.map((function(o,t){var n=JSON.parse(o["ST_AsGeoJSON(ward_area)"]);e.Feature.push({type:"Feature",properties:{name:o.ward_number},geometry:{type:"Polygon",coordinates:n.coordinates}}),a.push(n.coordinates)})),t=a,angular.extend(e,{center:{lat:t[0][0][0][1],lng:t[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:h,onEachFeature:f}})}),(function(){}))},e.set_ward=function(o){d.set_data(o);var t,a=[],n=JSON.parse(o["ST_AsGeoJSON(ward_area)"]),r=JSON.parse(o["ST_AsGeoJSON(ward_area)"]);if(a.push(r.coordinates),t=a,1==m)console.log("editing: ",e.wardId),e.Feature.push({type:"Feature",properties:{name:o.ward_number},geometry:{type:"Polygon",coordinates:r.coordinates}}),angular.extend(e,{center:{lat:t[0][0][0][1],lng:t[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:h,onEachFeature:f}});else if(0==m){e.currentlyEdting=o.ward_number,e.wardId=o.id,console.log("editing: ",e.wardId);for(var s=n.coordinates[0].length;s--;){a=n.coordinates[0][s][0];n.coordinates[0][s][0]=n.coordinates[0][s][1],n.coordinates[0][s][1]=a}var l=L.polygon(n.coordinates).bindPopup(o.id);p.addLayer(l),m=!0,angular.extend(e,{center:{lat:n.coordinates[0][0][0],lng:n.coordinates[0][0][1],zoom:14}})}},e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng},e.openSlide=function(){e.toggle=!e.toggle},e.clearEditable=()=>{l.getMap().then((function(o){p.clearLayers(),m=!1,e.currentlyEdting=null,g()}))},e.clearDrawing=()=>{e.Feature=[],e.clearEditable()}}angular.module("barikoi").controller("LocalPolygonStdWard",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){var p=new L.FeatureGroup,g=function(){c.getlocations(i.POLYGON_ZONE+"?",(function(o){e.zones=o}),(function(){}))};g(),l.getMap().then((function(t){s((function(){t.invalidateSize()}),500),t.addLayer(p),L.drawLocal.draw.toolbar.buttons.polygon="Draw a polygon!";var a=new L.Control.Draw({position:"topleft",draw:{polygon:{drawError:{color:"#bada55",timeout:1e3},shapeOptions:{color:"#662d91"}},circle:{shapeOptions:{color:"#662d91"}},marker:!1},edit:{featureGroup:p,remove:!1}});t.addControl(a),t.on("draw:created",(function(t){t.layerType;var a=t.layer;console.log(a);a=t.layer;p.addLayer(a);var n=[];a.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))})),e.coordinates=n.reduce((e,o)=>e.concat(o),[]),d.set_data(e.coordinates);o.open({templateUrl:"/../../views/local-admin/polygon-zone-mod.html",controller:"LocalPolygonModal",size:"lg",scope:e,backdrop:"static"});p.addLayer(a)})),t.on("draw:edited",(function(o){console.log("updating ",e.zoneId);var t=o.layers,a=[];console.log(t.toGeoJSON()),t.toGeoJSON().features[0].geometry.coordinates[0].map((function(e){a.push(e.join(" "))})),e.coordinates=a.reduce((e,o)=>e.concat(o),[]),swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update Zone Poligon!",closeOnConfirm:!1},(function(){var o={zone_area:e.coordinates.toString()};c.updateSomething(i.POLYGON_ZONE+"/"+e.zoneId,o,(function(e){swal("Done","Polygon updated")}),(function(){swal("Error")}))}))}))}));angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://geoserver.barikoi.com:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",attribution:"barikoi",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google",layerOptions:{attribution:"barikoi",maxZoom:23}}},overlays:{}}}),e.Feature=[];let m=!1;function y(){var e=Math.round,o=Math.random;return"rgb("+e(255*o())+","+e(255*o())+","+e(255*o())+")"}function f(e,o){o.bindTooltip("Zone : "+e.properties.name,{permanent:!0,direction:"center",className:"countryLabel"})}function h(e){return{fillColor:y(),opacity:1,color:y(),dashArray:"3",fillOpacity:.4}}e.set_zone=function(o){d.set_data(o);var t,a=[],n=JSON.parse(o["ST_AsGeoJSON(zone_area)"]),r=JSON.parse(o["ST_AsGeoJSON(zone_area)"]);if(a.push(r.coordinates),t=a,1==m)console.log("editing ",e.zoneId),e.Feature.push({type:"Feature",properties:{name:o.zone_number},geometry:{type:"Polygon",coordinates:r.coordinates}}),angular.extend(e,{center:{lat:t[0][0][0][1],lng:t[0][0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:h,onEachFeature:f}});else if(0==m){e.currentlyEdting=o.zone_number,e.zoneId=o.id,console.log("editing ",e.zoneId);for(var s=n.coordinates[0].length;s--;){a=n.coordinates[0][s][0];n.coordinates[0][s][0]=n.coordinates[0][s][1],n.coordinates[0][s][1]=a}var l=L.polygon(n.coordinates).bindPopup(o.id);p.addLayer(l),m=!0,angular.extend(e,{center:{lat:n.coordinates[0][0][0],lng:n.coordinates[0][0][1],zoom:14}})}},e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng},e.openSlide=function(){e.toggle=!e.toggle},e.clearEditable=()=>{l.getMap().then((function(o){p.clearLayers(),m=!1,e.currentlyEdting=null,g()}))}}angular.module("barikoi").controller("LocalPolygonStdZone",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){var p=new L.FeatureGroup;e.roadtypes=[{key:"8",name:"Asphalt"},{key:"9",name:"Concrete"},{key:"10",name:"Unpaved"},{key:"11",name:"Good"},{key:"12",name:"Bad"},{key:"13",name:"Disaster"}],e.set_area=function(o){c.getlocations(i.ROAD_BY_AREA+o.id+"?",(function(o){e.roads=o}),(function(e){}))},c.getlocations(i.POLYGON_AREA,(function(o){e.areas=o}),(function(){})),e.onRoadSelect=function(o){e.road_type=o},angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/klokantech-basic/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{}}}),l.getMap().then((function(o){r((function(){o.invalidateSize()}),500),e.mapobj=o,o.addLayer(p),L.drawLocal.draw.toolbar.buttons.polygon="Draw a sexy polygon!";var t=new L.Control.Draw({position:"topleft",draw:{polyline:{metric:!0},polygon:{allowIntersection:!1,showArea:!0,drawError:{color:"#b00b00",timeout:1e3},shapeOptions:{color:"#662d91"}},circle:{shapeOptions:{color:"#662d91"}},marker:!1},edit:{featureGroup:p,remove:!1}});o.addControl(t),o.on("draw:created",(function(e){var o=e.layerType,t=e.layer;console.log(t),"marker"===o&&t.bindPopup("A popup!"),p.addLayer(t)})),o.on("draw:edited",(function(o){var t=o.layers,a=[];t.toGeoJSON().features[0].geometry.coordinates.map((function(e){a.push(e.join(" "))}));var n=a.reduce((e,o)=>e.concat(o),[]);console.log(n);var r={id:d.get_data().id,poly:n};d.set_data(r),s.open({templateUrl:"/../../views/local-admin/polyline-road-up-mod.html",controller:"LocalPolygonModal",size:"lg",scope:e,backdrop:"static"})}))})),e.set_road=function(o){d.set_data(o),console.log(o),e.id=o.id,e.Feature=[];var t,a=[],n=JSON.parse(o["ST_AsGeoJSON(road_geometry)"]);a.push(n.coordinates),t=a,console.log(n.coordinates);for(var r=n.coordinates.length;r--;){a=n.coordinates[r][0];n.coordinates[r][0]=n.coordinates[r][1],n.coordinates[r][1]=a}var s=L.polyline(n.coordinates).bindPopup(o.road_name_number);p.addLayer(s),e.areas.push({id:-1,name:"all","ST_AsGeoJSON(area)":JSON.stringify({type:"Polygon",coordinates:t})}),angular.extend(e,{center:{lat:n.coordinates[0][0],lng:n.coordinates[0][1],zoom:14}})},e.openSlide=function(){e.toggle=!e.toggle},e.changeCenter=function(o){e.center.lat=o.lat,e.center.lng=o.lng}}angular.module("barikoi").controller("LocalPolylineRoad",e),e.$inject=["$scope","$http","$stateParams","$window","$location","$timeout","$modal","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){e.roadtypes=[{key:"8",name:"Asphalt"},{key:"9",name:"Concrete"},{key:"10",name:"Unpaved"},{key:"11",name:"Good"},{key:"12",name:"Bad"},{key:"13",name:"Disaster"}],c.getlocations(i.POLYGON_AREA+"?",(function(o){e.areas=o}),(function(){})),c.getlocations(i.POLYGON_SUBAREA+"?",(function(o){e.subareas=o}),(function(){}));function p(e){return e.properties.road_condition.includes("Good")?"#55AA55":e.properties.road_condition.includes("Bad")?"#D4A76A":e.properties.road_condition.includes("Disaster")?"#D46A6A":"#4F628E"}function g(e){return e.properties.number_of_lanes}function m(e){return{fillColor:(o=e,o.properties.road_condition.includes("Good")?"#55AA55":o.properties.road_condition.includes("Bad")?"#D4A76A":o.properties.road_condition.includes("Disaster")?"#D46A6A":"Polygon"==o.geometry.type?void 0:"#4F628E"),weight:g(e),opacity:2,color:p(e),dashArray:"",fillOpacity:.7};var o}c.getlocations(i.POLYLINE_ROAD+"?",(function(o){e.roads=o;var t,a=[];e.Feature=[],e.roads.map((function(o,t){var n=JSON.parse(o["ST_AsGeoJSON(road_geometry)"]);e.Feature.push({type:"Feature",properties:{name:o.road_name_number,number_of_lanes:o.number_of_lanes,road_condition:o.road_condition},geometry:{type:"LineString",coordinates:n.coordinates}}),a.push(n.coordinates)})),t=a,angular.extend(e,{center:{lat:t[0][0][1],lng:t[0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:m},selectedRoad:{},events:{geojson:{enable:["click","mouseover"]}}})}),(function(){})),e.$on("leafletDirectiveGeoJson.click",(function(e,o){var t;t=o.leafletObject,o.leafletEvent,t=t.feature,console.log(t.properties.name)})),e.$on("leafletDirectiveGeoJson.mouseover",(function(o,t){var a;a=t.leafletObject.feature,t.leafletEvent,e.selectedRoad=a.properties.name,console.log(a)})),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),l.getMap().then((function(e){s((function(){e.invalidateSize()}),500)})),l.getMap().then((function(t){l.getLayers().then((function(a){var n=a.overlays.draw;t.on("draw:created",(function(t){var a=t.layer;n.addLayer(a);var r=[];a.toGeoJSON().geometry.coordinates.map((function(e){r.push(e.join(" "))})),e.coordinates=r.reduce((e,o)=>e.concat(o),[]),d.set_data(e.coordinates),o.open({templateUrl:"/../../views/local-admin/polyline-road-mod.html",controller:"PolygonModal",size:"lg",scope:e,backdrop:"static"})}))}))})),e.onRoadSelect=function(o){e.road_type=o},e.set_area=function(o){e.id=o.id,c.getlocations(i.ROAD_BY_AREA+e.id+"?",(function(t){e.roads=t;var a,n=[];e.Feature=[],e.roads.map((function(o,t){var a=JSON.parse(o["ST_AsGeoJSON(road_geometry)"]);e.Feature.push({type:"Feature",properties:{name:o.road_name_number,number_of_lanes:o.number_of_lanes,road_condition:o.road_condition},geometry:{type:"LineString",coordinates:a.coordinates}}),n.push(a.coordinates)})),a=n,e.Feature.push({type:"Feature",properties:{name:"",number_of_lanes:"",road_condition:""},geometry:{type:"Polygon",coordinates:JSON.parse(o["ST_AsGeoJSON(area_area)"]).coordinates}}),angular.extend(e,{center:{lat:a[0][0][1],lng:a[0][0][0],zoom:14},geojson:{data:{type:"FeatureCollection",features:e.Feature},style:m},selectedRoad:{},events:{geojson:{enable:["click","mouseover"]}}})}),(function(){}))},e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng},e.openSlide=function(){e.toggle=!e.toggle},e.$on("leafletDirectiveGeoJson.myMap.mouseover",(function(e,o){console.log(o.leafletObject.feature)}))}angular.module("barikoi").controller("PolygonlineStdRoad",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r){o.data={availableOptions:[{id:"1",name:"bonus"},{id:"2",name:"regular"},{id:"3",name:"special"}],selectedType:{id:"1",name:"bonus"}},o.address={},o.add_reward=function(){var e={rewards_name:o.reward.name,required_points:o.reward.required_points,typeOfRewards:o.data.selectedType.name,isOneTime:o.reward.isOneTime};console.log(e),r.addaddress(n.REWARD_INFO,e,(function(e){swal("Done","New Reward Item Created")}),(function(){swal("Error")}))}}angular.module("barikoi").controller("RewardAddController",e),e.$inject=["$rootScope","$scope","$http","$location","urls","Auth"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u,p){i.getMap().then((function(e){s((function(){e.invalidateSize()}),500)}));o.loading=!1,o.toggle=!0,o.selected={},o.birdsEyeLeftFull=!0,o.birdsEyeLeftEight=!1,o.birdsEyeRight=!1,o.birdsEyeCollapse=function(){console.log("im, here"),o.birdsEyeLeftFull?(o.birdsEyeLeftFull=!1,o.birdsEyeLeftEight=!0,o.birdsEyeRight=!0):(o.birdsEyeLeftEight=!1,o.birdsEyeRight=!1,o.birdsEyeLeftFull=!0)};var g;d.getlocations(c.GET_SUBTYPES,(function(e){o.subcategories=e}),(function(){}));var m=function(o,t){return o.map((function(o,a){var n={shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]};"water atm"==o.subType.toLowerCase()?(n.iconUrl="./assets/img/type/water-atm.png",n.iconSize=[40,46],n.popupAnchor=[6,-32]):e.availableIcons.includes(o.pType.split(",")[0].toLowerCase())?n.iconUrl="./assets/img/type/"+o.pType.split(",")[0].toLowerCase()+".png":n.iconUrl="./assets/img/type/default.png",(isNaN(o.latitude)||isNaN(o.longitude))&&(console.log(o.latitude,o.longitude),o.latitude=23.2433323,o.longitude=90.02433323);try{g=o.images[0].imageLink}catch(e){g="image"}return{layer:t,id:o.id,idx:a,userID:o.user_id,lat:parseFloat(o.latitude),lng:parseFloat(o.longitude),area:o.area,Address:o.Address,title:o.Address,subtype:o.subType,ptype:o.pType,uCode:o.uCode,image:g,flag:!1,focus:!1,message:"<div ng-include src=\"'views/marker-popup.html'\"></div>",draggable:!0,icon:n}}))};angular.extend(o,{center:{lat:23.728783,lng:90.393791,zoom:12},defaults:{doubleClickZoom:!1,scrollWheelZoom:!0,map:{contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Add Place Here",callback:function(e,t){console.log(e),u.set_data(e);l.open({templateUrl:"../../views/dtool/retool-modal.html",controller:"Retool",size:"lg",resolve:{loc:function(){return o.place}},backdrop:"static"})}}]}},events:{map:{enable:["moveend","popupopen","contextmenu"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:22}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23}}},overlays:{new:{type:"group",name:"new",visible:!1},updated:{type:"group",name:"updated",visible:!1}}}}),t.get(c.MAP_CODE).success((function(e){var t=e["Added Today"];o.markers_add=m(t,"new");var a=e["Updated Today"];o.markers_update=m(a,"updated"),o.markers=o.markers_add.concat(o.markers_update),p.stop({referenceId:"first"})})).error((function(){p.stop({referenceId:"first"})})),o.set_subtype=function(e){p.start({referenceId:"first"}),console.log(e),d.get_with_params(c.PLACE_BY_TYPE+"subType="+e.subtype,(function(e){p.stop({referenceId:"first"}),o.total=e.Total,o.markers=m(e.Places,"new")}),(function(){p.stop({referenceId:"first"})}))},u.subscribe(o,(function(){o.notifications++})),o.onSelect=function(e){o.selected=e,console.log(e),o.markers.m1.lat=parseFloat(o.selected.latitude),o.markers.m1.lng=parseFloat(o.selected.longitude),o.center.lat=parseFloat(o.selected.latitude),o.center.lng=parseFloat(o.selected.longitude)},o.changeCenter=function(e){o.center.lat=e.lat,o.center.lng=e.lng,u.set_data(e),e.focus=!0},o.users=function(t){return t.length<1?[]:(o.loading=!0,d.getUsers(t).then((function(e){return o.loading=!1,o.markers=m(e.places,"new"),console.log(e.places),e.places}),(function(t){o.loading=!1,s((function(){p.stop({referenceId:"first"}),swal(e.error),o.markers=[]}),2e3)})))},o.openSlide=function(){o.toggle=!o.toggle},o.$on("leafletDirectiveMarker.click",(function(e,o){u.set_data(o.model)})),e.$on("mk-del",(function(e,t){console.log(o.markers[t.idx]),o.markers[t.idx].icon.iconUrl="./assets/img/marker-dlt.svg"})),e.$on("mk-upd",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-upd.svg"})),e.$on("mk-muv",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-muv.svg"})),e.$on("mk-new",(function(e,t){var a=[];a.push(t);var n=a.map((function(e,o){return(isNaN(e.latitude)||isNaN(e.longitude))&&(console.log(e.latitude,e.longitude),e.latitude=23.2433323,e.longitude=90.02433323),{id:e.id,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),Address:e.Address,icon:{iconUrl:"./assets/img/marker-add.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]}}}));console.log(n),o.markers.push(n[0])})),o.$on("leafletDirectiveMarker.dragend",(function(e,t){t.model.lat,t.model.lng;swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update marker position!",closeOnConfirm:!0},(function(e){e?d.updateSomething2(c.DROP_MARKER+t.model.id+"?longitude="+t.model.lng+"&latitude="+t.model.lat,(function(e){o.markers[t.model.idx].lat=t.model.lat,o.markers[t.model.idx].lng=t.model.lng,console.log("event handeled success")}),(function(){t.model.lat=o.markers[t.model.idx].lat,t.model.lng=o.markers[t.model.idx].lng})):o.$apply((function(){console.log(o.markers[t.model.idx]),o.markers[t.model.idx].flag=!o.markers[t.model.idx].flag}))}))})),o.edit_address=function(e,o,t){p.start({referenceId:e});var a={Address:o};console.log(o),console.log(t),d.updateSomething(c.UPDATE_ADDRESS+t,a,(function(e){p.stop({referenceId:"first"}),swal("Success",e)}),(function(e){p.stop({referenceId:"first"}),swal(e)}))},o.set_date_interval=function(){p.start({referenceId:"first"}),t({method:"GET",url:c.MAP_CODE+"?dateFrom="+moment(o.date2).format("YYYY-MM-DD")+"&dateTill="+moment(o.date1).format("YYYY-MM-DD"),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success((function(e){s((function(){console.log(o.bike),p.stop({referenceId:"first"})}),2e3),o.markers=m(e.Message,"new"),console.log(o.markers),o.total=o.markers.length,o.count_total=e["Total Added"]})).error((function(o){s((function(){p.stop({referenceId:"first"}),swal(e.error)}),2e3)}))}}angular.module("barikoi").controller("BirdsEye",e),e.$inject=["$rootScope","$scope","$http","$stateParams","$window","$location","$timeout","$modal","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u,p){var g;e.limit=10,e.coordinates,i.getMap().then((function(o){s((function(){o.invalidateSize(),e.map=o}),1e3)}));d.getlocations(c.POLYGON,(function(o){e.areas=o.area}),(function(){})),d.getlocations(c.GET_SUBTYPES,(function(o){e.subcategories=o,e.subcategories.push({subtype:"all"})}),(function(){})),angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),i.getMap().then((function(o){i.getLayers().then((function(t){var a=t.overlays.draw;o.on("draw:created",(function(t){var n=t.layer;a.addLayer(n);var r=[];n.toGeoJSON().geometry.coordinates[0].map((function(e){r.push(e.join(" "))}));var s=r.reduce((e,o)=>e.concat(o),[]);g=new L.canvasIconLayer({}),e.map.addLayer(g),e.map.addLayer(g);var i=new L.Control.Search({position:"topleft",layer:g,initial:!1,zoom:11,marker:!1,textPlaceholder:"search..."});o.addControl(i),i.on("search:collapsed",(function(e){o.setView([23.101516,90.313446],13)})),g.addOnClickListener((function(o,t){console.log(t);var a=e.$new();u.set_data(t[0].data.options);var n=l("<div popup></div>")(a);t[0].data.bindPopup(n[0])})),d.get_with_params(c.POLYGON_CUSTOM+"area="+s.toString(),(function(o){e.total=o.Total;var t=L.icon({iconUrl:"./assets/img/type/default.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]}),a=[];e.mark=[];for(var n=0;n<o.places.length-1;n++){$rootScope.availableIcons.includes(ap.pType.split(",")[0])&&(t="./assets/img/type/"+o.places[n].pType.split(",")[0].toLowerCase()+".png"),"WATER ATM"==ap.subType?(t.iconUrl="./assets/img/type/water-atm.png",t.iconSize=[30,38]):$rootScope.availableIcons.includes(ap.pType.split(",")[0])&&(t="./assets/img/type/"+ap.pType.split(",")[0].toLowerCase()+".png");var r=L.marker([o.places[n].latitude,o.places[n].longitude],{icon:t,title:o.places[n].Address,subtype:o.places[n].subType,draggable:!0,Address:o.places[n].Address,area:o.places[n].area,subtype:o.places[n].subType,ptype:o.places[n].pType,uCode:o.places[n].uCode});a.push(r),g.addLayer(r)}console.log(g)}),(function(){swal("Error")}))}))}))})),e.loadMore=function(o,t){o&&t&&(e.limit+=10)},e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng},e.openSlide=function(){e.toggle=!e.toggle}}angular.module("barikoi").controller("CanvasMarker",e).directive("popup",(function(e){return{restrict:"A",templateUrl:"views/marker-popup-com.html",scope:{}}})),e.$inject=["$rootScope","$scope","$modal","$http","$stateParams","$window","$location","$timeout","$compile","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r){var s=function(){t.get(n.GET_CATEGORY).success((function(e){o.categories=e,console.log(e)})).error((function(e){console.log(e)})),e.navone=!0};s(),o.set_category=function(){var e={pType:o.new_category};console.log(e),r.setcategory(n.ADD_CATEGORY,e,(function(e){swal("Done","New Type Added"),s()}),(function(e){console.log(e),swal("Type Already Defined")}))},o.set_sub_category=function(){var e={pType:o.address.category.type.toString(),subType:o.address.subcategory};let t="";r.setcategory(n.ADD_SUB_CATEGORY,e,(function(e){console.log("success: ",e),t=e,swal("Done","New Subcategory Added")}),(function(e){console.log("error: ",e),"Added"==t&&swal("Success","New Subcategory Added")}))}}angular.module("barikoi").controller("CategoyAddController",e),e.$inject=["$rootScope","$scope","$http","$location","urls","Auth"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){o.toggle=!0,u.getMap().then((function(e){s((function(){e.invalidateSize()}),500)}));angular.extend(o,{center:{lat:23.728783,lng:90.393791,zoom:12},events:{map:{enable:["moveend","popupopen"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},layers:{baselayers:{mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}}}}),t.get(l.CONTRIBUTER_GPX+a.id).success((function(e){var t;o.markers=(t=e,console.log(t),t.map((function(e){return{id:e.id,code:e.uCode,lat:parseFloat(e.lat),lng:parseFloat(e.lon),focus:!0,message:e.created_at,icon:{iconUrl:"./assets/img/reddot.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]}}}))),d.stop({referenceId:"first"})})).error((function(){d.stop({referenceId:"first"})})),o.openSlide=function(){o.toggle=!o.toggle}}angular.module("barikoi").controller("ContributorGPX",e),e.$inject=["$rootScope","$scope","$http","$stateParams","$window","$location","$timeout","urls","Auth","DataTunnel","bsLoadingOverlayService","leafletData"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c){o.currentPage=0,o.pageSize=10,o.query="",o.getData=function(){return s("filter")(o.userlist,o.query)},c.getlocations(l.CONTRIBUTER_LIST+"all",(function(e){o.userlist=e;var t=[];for(var a in o.userlist)t.push(o.userlist[a].email);console.log(t)}),(function(){e.error="Failed to fetch details"})),o.numberOfPages=function(){return Math.ceil(o.getData().length/o.pageSize)},o.$watch("query",(function(e,t){t!=e&&(o.currentPage=0)}),!0),o.sort=function(e){o.sortKey=e,o.reverse=!o.reverse},o.range=function(e){var t=o.numberOfPages()-1;console.log(t);for(var a=[],n=e;n<e+5&&n<t;n++)a.push(n);return a},o.setPage=function(e){o.currentPage=e},o.user_detail=function(e){i.set_data(e),n.path("/places/contributor/"+e.id)},o.gpx=function(e){n.path("/gpx/contributor/"+e.id)},o.delete_user=function(e){swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},(function(){t.delete(l.USER_INFO+e).success((function(e){r.go("main.userlog",{},{reload:!0}),swal("Deleted!","User deleted.","success")})).error((function(e){swal("Error Occured")}))}))},o.loadMore=function(e,t){e&&t&&(o.limit=10)}}angular.module("barikoi").controller("ContributorList",e).filter("startFrom",(function(){return function(e,o){return o=+o,e.slice(o)}})),e.$inject=["$rootScope","$scope","$http","$window","$location","$state","$filter","urls","DataTunnel","Auth"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u,p){var g,m;o.contributor={},console.log("uId ",a.id),o.openSlide=function(){o.toggle=!o.toggle},p.getMap().then((function(e){s((function(){e.invalidateSize()}),500)})),g=a.id,o.contributor.name=c.get_data().name;console.log(o.contributor.name),d.getlocations(i.CONTRIBUTER_LIST+"all",(function(e){o.contributor_list=e,console.log(e)}),(function(){e.error="Failed to fetch details"}));var y=function(o){return o.map((function(o,t){(isNaN(o.latitude)||isNaN(o.longitude))&&(console.log(o.latitude,o.longitude),o.latitude=23.2433323,o.longitude=90.02433323);var a={shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]};"water atm"==o.subType.toLowerCase()?(a.iconUrl="./assets/img/type/water-atm.png",a.iconSize=[40,46],a.popupAnchor=[6,-32]):e.availableIcons.includes(o.pType.split(",")[0].toLowerCase())?a.iconUrl="./assets/img/type/"+o.pType.split(",")[0].toLowerCase()+".png":a.iconUrl="./assets/img/type/default.png";try{m=o.images[0].imageLink}catch(e){m="image"}return{id:o.id,idx:t,lat:parseFloat(o.latitude),lng:parseFloat(o.longitude),Address:o.Address,title:o.Address,ptype:o.pType,subtype:o.subType,uCode:o.uCode,image:m,flag:!1,focus:!1,message:"<div ng-include src=\"'views/marker-popup.html'\"></div>",draggable:!0,icon:a}}))};angular.extend(o,{center:{lat:23.728783,lng:90.393791,zoom:11},events:{map:{enable:["moveend","popupopen","contextmenu"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"},googleHybrid:{name:"Google Hybrid",layerType:"HYBRID",type:"google"},googleRoadmap:{name:"Google Streets",layerType:"ROADMAP",type:"google"}}}}),o.$on("leafletDirectiveMarker.dragend",(function(e,t){var a={latitude:t.model.lat,longitude:t.model.lng};d.updateSomething(i.DROP_MARKER+t.model.id,a,(function(e){swal("Done","marker position has been updated"),o.order=null}),(function(){swal("Error")}))})),o.$on("leafletDirectiveMarker.click",(function(e,o){c.set_data(o.model)})),o.$on("leafletDirectiveMap.contextmenu",(function(e,t){console.log(t),c.set_data(t.leafletEvent);l.open({templateUrl:"../../views/dtool/retool-modal.html",controller:"Retool",size:"lg",resolve:{loc:function(){return o.place}}})}));t.get(i.CONTRIBUTER_PLACE+a.id).success((function(e){const t=g=a.id;o.markers=y(e.Message),console.log(o.markers),o.count_todays=e["Count Todays"],o.income_todays=e["Todays Income"],o.income_total=e["Total Income"],o.count_total=e["Total Added"],o.contributorDate=`places/contributor/${t}#contributorDate`,o.contributorResults=`places/contributor/${t}#contributorResults`})),o.switch_contributor=function(a){o.date1=o.date2=null,u.start({referenceId:"first"}),g=a.name.id,o.contributor.name=a.name.name.toString(),t.get(i.CONTRIBUTER_PLACE+g).success((function(e){s((function(){console.log(o.bike),u.stop({referenceId:"first"})}),2e3),console.log(e.Message),o.markers=y(e.Message),o.count_todays=e["Count Todays"],o.income_todays=e["Todays Income"],o.income_total=e["Total Income"],o.count_total=e["Total Added"]})).error((function(){e.error="Failed to fetch data",s((function(){u.stop({referenceId:"first"}),swal(e.error)}),2e3)}))},o.send_date=function(){u.start({referenceId:"first"}),t({method:"GET",url:i.CONTRIBUTER_PLACE+g+"?date="+moment(o.date2).format("YYYY-MM-DD"),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success((function(e){s((function(){console.log(o.bike),u.stop({referenceId:"first"})}),2e3),o.markers=y(e.Message),console.log(o.markers),o.count_todays=e["Count Todays"],o.income_todays=e["Todays Income"],o.income_total=e["Total Income"],o.count_total=e["Total Added"]})).error((function(o){s((function(){u.stop({referenceId:"first"}),swal(e.error)}),2e3)}))},o.send_dateTo=function(){u.start({referenceId:"first"}),t({method:"GET",url:i.CONTRIBUTER_PLACE+g+"?dateTo="+moment(o.date1).format("YYYY-MM-DD"),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success((function(e){s((function(){console.log(o.bike),u.stop({referenceId:"first"})}),2e3),o.markers=y(e.Message),console.log(o.markers),o.count_todays=e["Count Todays"],o.income_todays=e["Todays Income"],o.income_total=e["Total Income"],o.count_total=e["Total Added"]})).error((function(o){s((function(){u.stop({referenceId:"first"}),swal(e.error)}),2e3)}))},o.set_date_interval=function(){u.start({referenceId:"first"}),t({method:"GET",url:i.CONTRIBUTER_PLACE+g+"?dateFrom="+moment(o.date2).format("YYYY-MM-DD")+"&dateTill="+moment(o.date1).format("YYYY-MM-DD"),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success((function(e){s((function(){console.log(o.bike),u.stop({referenceId:"first"})}),2e3),o.markers=y(e.Message),console.log(o.markers),o.total=o.markers.length,o.count_total=e["Total Added"]})).error((function(o){s((function(){u.stop({referenceId:"first"}),swal(e.error)}),2e3)}))},e.$on("mk-del",(function(e,t){console.log(o.markers[t.idx]),o.markers[t.idx].icon.iconUrl="./assets/img/marker-dlt.svg"})),e.$on("mk-upd",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-upd.svg",o.markers[t.idx].lat=t.lat,o.markers[t.idx].lng=t.lng})),e.$on("mk-muv",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-muv.svg"})),e.$on("mk-new",(function(e,t){var a=[];a.push(t);var n=a.map((function(e,o){return(isNaN(e.latitude)||isNaN(e.longitude))&&(console.log(e.latitude,e.longitude),e.latitude=23.2433323,e.longitude=90.02433323),{id:e.id,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),Address:e.Address,icon:{iconUrl:"./assets/img/marker-add.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]}}}));console.log(n),o.markers.push(n[0])}))}angular.module("barikoi").controller("ContributorPlaces",e),e.$inject=["$rootScope","$scope","$http","$stateParams","$window","$location","$timeout","$modal","urls","DataTunnel","Auth","bsLoadingOverlayService","leafletData"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){function p(){c.TOTAL_API_ANALYTICS(`${i.API_USAGE_COUNT}=0`,e=>{o.todaysUsage=[e.data.reverse_geocode,e.data.geocode,e.data.autocomplete,e.data.nearby,e.data.distance,e.data.rupantor_batchgeo],o.cityCorpUsageToday=[e.data.ward_zone,e.data.ward,e.data.zone,e.data.dncc]},e=>{console.log(e)}),c.TOTAL_API_ANALYTICS(`${i.API_USAGE_COUNT}=6`,e=>{o.thisWeeksUsage=[e.data.reverse_geocode,e.data.geocode,e.data.autocomplete,e.data.nearby,e.data.distance,e.data.rupantor_batchgeo],o.cityCorpUsageThisWeek=[e.data.ward_zone,e.data.ward,e.data.zone,e.data.dncc]},e=>{console.log(e)}),c.TOTAL_API_ANALYTICS(`${i.API_USAGE_COUNT}=29`,e=>{o.thisMonthsUsage=[e.data.reverse_geocode,e.data.geocode,e.data.autocomplete,e.data.nearby,e.data.distance,e.data.rupantor_batchgeo],o.cityCorpUsageThisMonth=[e.data.ward_zone,e.data.ward,e.data.zone,e.data.dncc]},e=>{console.log(e)}),c.TOTAL_API_ANALYTICS(`${i.API_MAX_USERS_BY_KEY}=0`,e=>{o.max_user_today_label=[],o.max_user_today_score=[],e.data.length>0&&e.data.map((function(e){o.max_user_today_label.push(e.Name),o.max_user_today_score.push(e.Api_Use)}))},e=>{console.log(e)}),c.TOTAL_API_ANALYTICS(`${i.API_MAX_USERS_BY_KEY}=6`,e=>{o.max_user_week_label=[],o.max_user_week_score=[],e.data.length>0&&e.data.map((function(e){o.max_user_week_label.push(e.Name),o.max_user_week_score.push(e.Api_Use)}))},e=>{console.log(e)})}o.active=!1,o.pieChartLabels=["Restaurant","Office","Bank","Hospital","School"],o.pieChartData=[30,55,15,8,22],o.barChartLabels=["Created","Updated","Deleted"],o.barChartData=[30,55,15],o.cityCorpUsageToday=[0,0,0,0],o.cityCorpUsageThisWeek=[0,0,0,0],o.cityCorpUsageThisMonth=[0,0,0,0],o.todaysUsage=[0,0,0,0,0],o.thisWeeksUsage=[0,0,0,0,0],o.thisMonthsUsage=[0,0,0,0,0],p(),t({method:"GET",url:i.ANALYTICS,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success((function(e){d.stop({referenceId:"first"}),o.data=e,o.label1=["Today","Yesterday","",""],o.label2=["Last Week","Before Last","Two Week Before"],o.colors=[{backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(255, 159, 64, 0.2)","rgba(255, 205, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(54, 162, 235, 0.2)","rgba(153, 102, 255, 0.2)","rgba(201, 203, 207, 0.2)"],pointBackgroundColor:"rgba(159,0,0, 1)",pointHoverBackgroundColor:"rgba(159,0,0, 0.8)",borderColor:["rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(201, 203, 207)"],pointBorderColor:"#fff",pointHoverBorderColor:"rgba(159,0,0, 1)"},"rgba(250,0,33,0.5)","#9a9a9a","rgb(233,177,69)"],o.graph1=[[o.data.Todays,o.data.Yesterday]],o.graph2=[[o.data.lastWeek,o.data.weekBeforeLastWeek,o.data.twoweeksago]],o.options={scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})).error((function(e){d.stop({referenceId:"first"})})),t({method:"GET",url:i.TOTAL_USER,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success((function(e){o.totaluser=e})).error((function(e){console.log(e)})),c.getlocations(i.POLYGON,(function(e){o.areas=e.area;var t,a=[];o.areas.map((function(e){var o=JSON.parse(e["ST_AsGeoJSON(area)"]);a.push(o.coordinates[0])})),t=a,o.areas.push({id:-1,name:"all","ST_AsGeoJSON(area)":JSON.stringify({type:"Polygon",coordinates:t})})}),(function(){})),c.getlocations(i.GET_SUBTYPES,(function(e){o.subcategories=e,o.subcategories.push({subtype:"all"})}),(function(){})),a(p,3e5);var g=function(){c.DAILY_ANALYTICS(i.DAILY_ANALYTICS,e=>{o.dailyAnalytics=e.data},e=>console.log("error: ",e))};o.startTimer=function(){o.Timer=a(g,3e5)},o.$on("$destroy",(function(){angular.isDefined(o.Timer)&&a.cancel(o.Timer)})),o.startTimer();var m=function(o){return o.map((function(o,t){var a;try{a=o.update_count.toString()}catch(e){a=""}var n={shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]};return"water atm"==o.subType.toLowerCase()?(n.iconUrl="./assets/img/type/water-atm.png",n.iconSize=[40,46],n.popupAnchor=[6,-32]):e.availableIcons.includes(o.pType.split(",")[0].toLowerCase())?n.iconUrl="./assets/img/type/"+o.pType.split(",")[0].toLowerCase()+".png":n.iconUrl="./assets/img/type/default.png",{id:o.id,idx:t,lat:parseFloat(o.latitude),lng:parseFloat(o.longitude),message:"<div ng-include src=\"'views/marker-popup.html'\"></div>",ptype:o.pType,area:o.area,Address:o.Address,title:o.Address,update_count:a,subtype:o.subType,uCode:o.uCode,userID:o.user_id,updated_at:o.updated_at,icon:n}}))};angular.extend(o,{center:{lat:23.757087,lng:90.39037,autoDiscover:!1,zoom:13},defaults:{doubleClickZoom:!1,scrollWheelZoom:!0,map:{contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Add Place Here",callback:function(e,t){u.set_data(e);s.open({templateUrl:"../../views/dtool/retool-modal.html",controller:"Retool",size:"lg",resolve:{loc:function(){return o.place}}})}}]}},events:{map:{enable:["moveend","popupopen","click","dblclick","contextmenu"],logic:"emit"},marker:{enable:["click","mouseover","mouseout"],logic:"emit"}},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},osm:{name:"OpenStreetMap",type:"xyz",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}}}}),l.getMap().then((function(e){r((function(){e.invalidateSize()}),700)})),o.onSelect=function(e){console.log(e),o.center.lat=parseFloat(e.latitude),o.center.lng=parseFloat(e.longitude),o.active=!1,l.getMap().then((function(e){r((function(){e.invalidateSize()}),1e3)}));var t=[];t.push(e),o.markers=m(t)},o.users=function(e){return e.length<0?[]:(o.loading=!0,c.adminSearch(e).then((function(e){return o.markers=m(e.places),o.center.lat=parseFloat(e.places[0].latitude),o.center.lng=parseFloat(e.places[0].longitude),o.center.zoom=11,o.loading=!1,e.places}),(function(e){o.loading=!1})))},o.active=!0,o.mapVisibilityTitle="Hide Map",o.viewMapTitleChange=function(){o.active?(o.active=!1,o.mapVisibilityTitle="Hide Map"):(o.active=!0,o.mapVisibilityTitle="Show Map")},e.$on("mk-del",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-dlt.svg"})),e.$on("mk-upd",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-upd.svg"})),e.$on("mk-muv",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-muv.svg"})),e.$on("mk-new",(function(e,t){var a=[];a.push(t);var n=a.map((function(e,o){return(isNaN(e.latitude)||isNaN(e.longitude))&&(e.latitude=23.2433323,e.longitude=90.02433323),{id:e.id,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),Address:e.Address,icon:{iconUrl:"./assets/img/marker-add.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]}}}));o.markers.push(n[0])})),o.$on("leafletDirectiveMarker.click",(function(e,o){u.set_data(o.model)})),o.$on("leafletDirectiveMap.dblclick",(function(e,a){let n={params:{longitude:a.leafletEvent.latlng.lng,latitude:a.leafletEvent.latlng.lat}};t.get(i.REVERSE_GEO_NO_AUTH,n).success((function(e){let t=e[0];o.selecting=void 0!==t?t.Address:"No data found!",o.markers=m(e)}))})),o.api=["Reverse Geo","Geocode","Autocomplete","Nearby","Distance","Rupantor Batchgeo"],o.bkoiGovtApi=["Ward Zone","Ward","Zone","City Corp"],o.onClick=function(e,o){},o.datasetOverride=[{yAxisID:"y-axis-1"},{yAxisID:"y-axis-2"}],o.pieChartOptions={showTooltips:!0,legend:{display:!0,position:"left",align:"center"}},o.barChartOptions={scales:{yAxes:[{ticks:{beginAtZero:!0}}]}},o.doughnutChartOptions={showTooltips:!0,legend:{display:!0,position:"left",align:"center"},scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}}angular.module("barikoi").controller("DashController",e),e.$inject=["$rootScope","$scope","$http","$interval","$location","$timeout","$modal","leafletData","urls","Auth","bsLoadingOverlayService","DataTunnel"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d){d.start({referenceId:"first"}),o.currentPage=0,o.pageSize=10,o.query="",o.getData=function(){return s("filter")(o.locations,o.query)},c.getlocations(i.MAP_CODE,(function(e){l((function(){console.log(o.bike),d.stop({referenceId:"first"}),o.locations=e}),2e3)}),(function(){e.error="Failed to fetch data",l((function(){d.stop({referenceId:"first"}),swal(e.error)}),2e3)})),o.numberOfPages=function(){return Math.ceil(o.getData().length/o.pageSize)},o.$watch("query",(function(e,t){t!=e&&(o.currentPage=0)}),!0),o.sort=function(e){o.sortKey=e,o.reverse=!o.reverse},o.range=function(e){var t=o.numberOfPages()-1;console.log(t);for(var a=[],n=e;n<e+5&&n<t;n++)a.push(n);return a},o.setPage=function(e){o.currentPage=e},o.delete_location=function(e,t){swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},(function(){c.delete_plc(i.DELETE_PLACE,e,(function(e){swal("Deleted!","Address has been deleted.","success"),o.locations.splice(t,1)}),(function(e){swal("Error Occured")}))}))},o.openWindow=function(e){a.open("https://dev.barikoi.com/#/code/"+e,"BariKoi?","width=800,height=700")},o.update_place=function(e){n.path("/updateplace/"+e)},o.loadMore=function(e,t){e&&t&&(o.pageSize=10)}}angular.module("barikoi").controller("LocationTableController",e).filter("startFrom",(function(){return function(e,o){return o=+o,e.slice(o)}})),e.$inject=["$rootScope","$scope","$http","$window","$location","$state","$filter","$timeout","urls","Auth","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i){o.userType={availableOptions:[{id:1,url:n.AUTH_URI,name:"Admin"},{id:2,url:n.AUTH_LOGI,name:"User"},{id:3,url:n.AUTH_BUS,name:"Business"},{id:4,url:n.AUTH_BUS,name:"Logistics"},{id:5,url:n.AUTH_BUS,name:"Delivery Man"}],selectedOption:{id:1,url:n.AUTH_URI,name:"Admin"}},o.$storage=r.$default({code:[]}),o.signin=function(){var e={email:o.email,password:o.password,userType:1};l.signin(e,(function(e){if(0==e.type)alert(e.data);else{r.token=e.data.token;(function(){var e=r.token,o={};if(void 0!==e){var t=e.split(".")[1];o=JSON.parse(function(e){var o=e.replace("-","+").replace("_","/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw"Illegal base64url string!"}return window.atob(o)}(t))}})();t.get(n.USER_PROF).success((function(e){r.userType=e.data.userType,1==r.userType?s.go("main.dashboard"):2==r.userType&&s.go("mapper.taskList")}))}}),(function(){swal("Sorry","Error Occured")}))},o.signup=function(){var t={name:o.name,email:o.email,phone:o.phone,password:o.password,userType:o.userType.selectedOption.id};l.signup(t,(function(e){200===e.status?(swal("Success","Signup Completed!"),o.name,o.email,o.password,o.phone="",s.go("signin")):swal("Error",e.messages)}),(function(){e.error="Failed to signup"}))},o.logout=function(){l.logout((function(){swal("Log out","You are signing off"),s.go("signin")}),(function(){swal("Failed to logout!")}))},o.token=r.token}angular.module("barikoi").controller("MainController",e),e.$inject=["$rootScope","$scope","$http","$location","urls","$localStorage","$state","Auth","$timeout"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){u.start({referenceId:"first"}),o.editable=[];o.loading=!1,o.selected={};t.get(c.DEMO_PAGI+a.page).then((function(e){i((function(){console.log(o.bike),u.stop({referenceId:"first"})}),2e3),o.locations=e.data.data,o.current_page=e.data.current_page,o.next_page_url=e.data.next_page_url,o.prev_page_url=e.data.prev_page_url,o.total=e.data.total,o.per_page=e.data.per_page,o.last_page=e.data.last_page}),(function(o){e.error="Failed to fetch data",i((function(){u.stop({referenceId:"first"}),swal(e.error)}),2e3)})),o.pageChanged=function(){o.init()},o.changePageSize=function(){o.pageIndex=1,o.getEmployeeList()},o.delete_location=function(e,t){swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},(function(){d.delete_plc(c.DELETE_PLACE,e,(function(e){swal("Deleted!","Address has been deleted.","success"),o.locations.splice(t,1)}),(function(e){swal("Error Occured")}))}))},o.update=function(e,t){var a={latitude:e.latitude,longitude:e.longitude,Address:e.Address,city:e.city,area:e.area,postCode:e.postCode,pType:e.pType,subType:e.subType,flag:1,route_description:e.route_description};d.addaddress(c.UPDATE_PLACE+e.id,a,(function(e){swal("Done","Place Updated"),o.editable[t]=!1}),(function(){swal("Error")}))},o.openWindow=function(e){n.open("https://dev.barikoi.com/#/code/"+e,"BariKoi?","width=800,height=700")},o.update_place=function(e){r.path("/updateplace/"+e)},o.onSelect=function(e){o.selected=e,console.log(e),o.markers.m1.lat=parseFloat(o.selected.latitude),o.markers.m1.lng=parseFloat(o.selected.longitude),o.center.lat=parseFloat(o.selected.latitude),o.center.lng=parseFloat(o.selected.longitude)},o.users=function(e){return e.length<1?[]:(o.loading=!0,d.getUsers(e).then((function(e){o.loading=!1,o.locations=e.places}),(function(e){o.loading=!1})))}}angular.module("barikoi").controller("PaginationTable",e),e.$inject=["$rootScope","$scope","$http","$stateParams","$window","$location","$state","$filter","$timeout","urls","Auth","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l){console.log(a.path()+"haleluiah"),o.tabpath=a.path(),o.city_corps=[{cc_name:"DNCC"},{cc_name:"DSCC"}],o.set_area=function(e){r.getlocations(s.SUBAREA_BY_AREA+e.id+"?",(function(e){o.subareas=e}),(function(e){}))},r.getlocations(s.CONTRIBUTER_LIST+"all",(function(e){o.userlist=e}),(function(){})),t.get(s.GET_CATEGORY).success((function(e){o.ptypes=e,console.log(e)})).error((function(e){console.log(e)})),o.ok=function(){n.close()},o.create_zone_polygon=function(e,o){var t={zone_area:l.get_data().toString(),city_corp:e.cc_name,zone_number:o};console.log(t),r.setcategory(s.POLYGON_ZONE+"?",t,(function(e){console.log(e),swal("Nice!","Zone Polygon Inserted ","success"),n.close()}),(function(){swal("Error")}))},o.create_area_polygon=function(e,o){var t={area_area:l.get_data().toString(),ward_id:o.id,area_name:e};console.log(t),r.setcategory(s.POLYGON_AREA+"?",t,(function(e){console.log(e),swal("Nice!","Area Polygon Inserted ","success"),n.close()}),(function(){swal("Error")}))},o.create_thana_polygon=function(e){var o={geom:l.get_data().toString(),thana:e};console.log(o),r.setcategory(s.POLYGON_THANA+"?",o,(function(e){console.log(e),swal("Nice!","Thana Polygon Inserted ","success"),n.close()}),(function(){swal("Error")}))},o.create_suparea_polygon=function(e,o){var t={supersubarea_area:l.get_data().toString(),subarea_id:e.id,super_subarea_name:o};console.log(t),r.setcategory(s.POLYGON_SUPAREA+"?",t,(function(e){console.log(e),swal("Nice!","Super SubArea Polygon Inserted ","success"),n.close()}),(function(){swal("Error")}))},o.create_subarea_polygon=function(e,o){var t={subarea_area:l.get_data().toString(),area_id:e.id,subarea_name:o};console.log(t),r.setcategory(s.POLYGON_SUBAREA+"?",t,(function(e){console.log(e),swal("Nice!","SubArea Polygon Inserted ","success"),n.close()}),(function(){swal("Error")}))},o.create_ward_polygon=function(e,o){var t={ward_area:l.get_data().toString(),ward_number:o,zone_id:e.id};console.log(t),r.setcategory(s.POLYGON_WARD+"?",t,(function(e){console.log(e),swal("Nice!","Ward Polygon Inserted ","success"),n.close()}),(function(){swal("Error")}))},o.data_fix=function(o,t,a){console.log("area flag"),console.log(a);var i={polygon:l.get_data().toString()};try{i.x=o.toString()}catch(e){console.log(e),i.x=""}try{i.y=t.toString()}catch(e){i.y=""}console.log(i),a?swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update!",closeOnConfirm:!1},(function(){r.get_with_params(s.POLYGON_DATA_FIX+"polygon="+i.polygon+"&x="+i.x+"&y="+i.y+"&area="+a,(function(e){console.log(e),n.close(),swal("Nice!","Updated ","success")}),(function(e){swal("Error","error occured ","error")}))})):swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update!",closeOnConfirm:!1},(function(){r.get_with_params(s.POLYGON_DATA_FIX+"polygon="+i.polygon+"&x="+i.x+"&y="+i.y,(function(o){console.log(o),e.$broadcast("action-status"),console.log("Still propagating .."),n.close(),swal("Nice!","Updated ","success")}),(function(e){swal("Error","error occured ","error")}))}))},o.data_dlt=function(o,t){var a={polygon:l.get_data().toString()};try{a.pType=o.type.toString()}catch(e){console.info("Ptype Not selected")}try{a.user_id=t.id.toString()}catch(e){console.info("user Not selected")}console.log(a),swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Delete!",closeOnConfirm:!0},(function(){r.delete_anything_json(s.POLYGON_DATA_DLT,a,(function(o){console.log(o),e.$broadcast("action-status"),n.close(),swal("Nice!","Data Deleted ","success")}),(function(e){swal("Error","error occured ","error")}))}))},o.create_road_polyline=function(e,t,a,i,c){var d={road_geometry:l.get_data().toString(),road_name_number:a,area_id:e.id,road_condition:o.road_type.reduce((function(e,o){return e+o.name+", "}),"").replace(/,\s*$/,""),number_of_lanes:i,avg_speed:c};try{d.subarea_id=t.id}catch(e){console.log(d)}r.setcategory(s.POLYLINE_ROAD+"?",d,(function(e){console.log(e),swal("Nice!","Road Polyline Inserted ","success"),n.close()}),(function(){swal("Error")}))}}angular.module("barikoi").controller("PolygonModal",e),e.$inject=["$rootScope","$scope","$http","$location","$modalInstance","Auth","urls","DataTunnel"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u,p,g){c.getMap().then((function(e){i((function(){e.invalidateSize()}),2e3)}));u.getlocations(d.POLYGON,(function(e){o.areas=e.area;var t,a=[];o.areas.map((function(e){var o=JSON.parse(e["ST_AsGeoJSON(area)"]);a.push(o.coordinates[0])})),t=a,console.log(t),o.areas.push({id:-1,name:"all","ST_AsGeoJSON(area)":JSON.stringify({type:"Polygon",coordinates:t})})}),(function(){})),u.getlocations(d.GET_SUBTYPES,(function(e){o.subcategories=e,o.subcategories.push({subtype:"all"})}),(function(){}));var m=function(e){return e.map((function(e,o){return(isNaN(e.latitude)||isNaN(e.longitude))&&(console.log(e.latitude,e.longitude),e.latitude=23.2433323,e.longitude=90.02433323),{id:e.id,idx:o,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),Address:e.house_no,flag:!1,uCode:e.uCode,icon:{type:"div",iconSize:null,html:'<div class="map-label redborder"><div class="map-label-content">'+e.house_no+'</div><div class="map-label-arrow"></div></div>'}}}))};angular.extend(o,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},events:{map:{enable:["moveend","popupopen","dblclick"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",attribution:"barikoi",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google",layerOptions:{attribution:"barikoi",maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}},new:{name:"new",type:"group",visible:!0}}}}),c.getMap().then((function(e){c.getLayers().then((function(t){var a=t.overlays.draw;e.on("draw:created",(function(e){var t=e.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))}));var r=n.reduce((e,o)=>e.concat(o),[]);console.log(r.toString()),u.get_with_params(d.POLYGON_HOLDING+"area="+r.toString(),(function(e){o.total=e.Total,o.markers=m(e.places)}),(function(){swal("Error")}))}))}))})),o.set_area=function(e){console.log(e);var t=JSON.parse(e["ST_AsGeoJSON(area)"]);console.log(t),o.id=JSON.parse(e.id),angular.extend(o,{center:{lat:t.coordinates[0][0][1],lng:t.coordinates[0][0][0],zoom:13},events:{map:{enable:["moveend","popupopen","dblclick"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:t.coordinates}}]},style:{weight:2,opacity:1,color:"red",dashArray:"3",fillOpacity:0}}}),o.markers={}},o.set_subType=function(e,t){g.start({referenceId:"first"}),null==e&&(e=""),u.get_with_params(d.PLACE_BY_AREA+"area="+e+"&subType="+t,(function(e){g.stop({referenceId:"first"}),o.total=e.Total,o.markers=m(e.places)}),(function(){g.stop({referenceId:"first"})}))},o.openSlide=function(){o.toggle=!o.toggle},o.changeCenter=function(e){o.center.lat=e.lat,o.center.lng=e.lng,p.set_data(e),e.focus=!0}}angular.module("barikoi").controller("PolygonSearchHolding",e),e.$inject=["$rootScope","$scope","$modal","$http","$stateParams","$window","$anchorScroll","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u,p,g,m){c.getMap().then((function(e){i((function(){e.invalidateSize()}),700)})),o.polygonSearchLeftFull=!0,o.polygonSearchLeftEight=!1,o.polygonSearchRight=!1,o.polygonSearchCollapse=function(){o.polygonSearchLeftFull?(o.polygonSearchLeftFull=!1,o.polygonSearchLeftEight=!0,o.polygonSearchRight=!0):(o.polygonSearchLeftEight=!1,o.polygonSearchRight=!1,o.polygonSearchLeftFull=!0)};u.getlocations(d.POLYGON,(function(e){o.areas=e.area;var t,a=[];o.areas.map((function(e){var o=JSON.parse(e["ST_AsGeoJSON(area)"]);a.push(o.coordinates[0])})),t=a,console.log(t),o.areas.push({id:-1,name:"all","ST_AsGeoJSON(area)":JSON.stringify({type:"Polygon",coordinates:t})})}),(function(){})),u.getlocations(d.GET_SUBTYPES,(function(e){o.subcategories=e,o.subcategories.push({subtype:"all"})}),(function(){}));var y=function(o){return o.map((function(o,t){var a,n={shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]};"water atm"==o.subType.toLowerCase()?(n.iconUrl="./assets/img/type/water-atm.png",n.iconSize=[40,46],n.popupAnchor=[6,-32]):e.availableIcons.includes(o.pType.split(",")[0].toLowerCase())?n.iconUrl="./assets/img/type/"+o.pType.split(",")[0].toLowerCase()+".png":n.iconUrl="./assets/img/type/default.png";try{a=o.update_count.toString()}catch(e){a=""}return{id:o.id,idx:t,lat:parseFloat(o.latitude),lng:parseFloat(o.longitude),Address:o.Address,area:o.area,subtype:o.subType,title:o.Address,ptype:o.pType,update_count:a,flag:!1,draggable:!0,uCode:o.uCode,userID:o.user_id,updated_at:o.updated_at,message:"<div ng-include src=\"'views/marker-popup.html'\"></div>",icon:n}}))};angular.extend(o,{center:{lat:23.728783,lng:90.393791,zoom:12},defaults:{doubleClickZoom:!1,scrollWheelZoom:!0,map:{contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Add Place Here",callback:function(e,a){console.log(e),p.set_data(e);t.open({templateUrl:"../../views/dtool/retool-modal.html",controller:"Retool",size:"lg",resolve:{loc:function(){return o.place}},backdrop:"static"})}},{text:"Whats Here?",callback:function(e,t){console.log(e),p.set_data(e);let n={params:{longitude:e.latlng.lng,latitude:e.latlng.lat}};a.get(d.REVERSE_GEO_NO_AUTH,n).success((function(e){console.log(e[0]);let t=e[0];o.selecting=void 0!==t?t.Address:"No data found!",o.markers=y(e)}))}}]}},controls:{draw:{}},events:{map:{enable:["moveend","popupopen","dblclick","contextmenu"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://geoserver.barikoi.com:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",attribution:"barikoi",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google",layerOptions:{attribution:"barikoi",maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}},new:{name:"new",type:"group",visible:!0}}}}),c.getMap().then((function(e){c.getLayers().then((function(t){var a=t.overlays.draw;e.on("draw:created",(function(e){var t=e.layer;console.log(t),a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))}));var r=n.reduce((e,o)=>e.concat(o),[]);console.log(r.toString()),u.get_with_params(d.POLYGON_CUSTOM+"area="+r.toString(),(function(e){o.total=e.Total,o.markers=y(e.places)}),(function(){swal("Error")}))}))}))})),o.set_area=function(e){console.log(e);var t=JSON.parse(e["ST_AsGeoJSON(area)"]);console.log(t),o.id=JSON.parse(e.id),angular.extend(o,{center:{lat:t.coordinates[0][0][1],lng:t.coordinates[0][0][0],zoom:13},geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:t.coordinates}}]},style:g.geo_style_rand()}}),o.markers={}},o.set_subType=function(e,t){m.start({referenceId:"first"}),null==e&&(e=""),u.get_with_params(d.PLACE_BY_AREA+"area="+e+"&subType="+t,(function(e){m.stop({referenceId:"first"}),o.total=e.Total,o.markers=y(e.places)}),(function(){m.stop({referenceId:"first"})}))},o.$on("leafletDirectiveMarker.click",(function(e,o){p.set_data(o.model),c.getMap().then((function(e){i((function(){e.invalidateSize()}),100)}))})),e.$on("mk-del",(function(e,t){console.log(o.markers[t.idx]),o.markers[t.idx].icon.iconUrl="./assets/img/marker-dlt.svg"})),e.$on("mk-upd",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-upd.svg",o.markers[t.idx].lat=t.lat,o.markers[t.idx].lng=t.lng})),e.$on("mk-muv",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-muv.svg"})),e.$on("mk-new",(function(e,t){var a=[];a.push(t);var n=a.map((function(e,o){return(isNaN(e.latitude)||isNaN(e.longitude))&&(console.log(e.latitude,e.longitude),e.latitude=23.2433323,e.longitude=90.02433323),{id:e.id,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),Address:e.Address,icon:{iconUrl:"./assets/img/marker-add.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]}}}));console.log(n),o.markers.push(n[0])})),o.openSlide=function(){o.toggle=!o.toggle},o.$on("leafletDirectiveMarker.dragend",(function(e,t){t.model.lat,t.model.lng;swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update marker position!",closeOnConfirm:!0},(function(e){e?u.updateSomething2(d.DROP_MARKER+t.model.id+"?longitude="+t.model.lng+"&latitude="+t.model.lat,(function(e){o.markers[t.model.idx].lat=t.model.lat,o.markers[t.model.idx].lng=t.model.lng,console.log("event handeled success")}),(function(){t.model.lat=o.markers[t.model.idx].lat,t.model.lng=o.markers[t.model.idx].lng})):o.$apply((function(){console.log(o.markers[t.model.idx]),o.markers[t.model.idx].flag=!o.markers[t.model.idx].flag}))}))})),o.changeCenter=function(e){o.center.lat=e.lat,o.center.lng=e.lng,p.set_data(e),e.focus=!0},o.edit_address=function(e,o,t){m.start({referenceId:e});var a={Address:o};console.log(o),console.log(t),u.updateSomething(d.UPDATE_ADDRESS+t,a,(function(e){m.stop({referenceId:"first"}),swal("Success",e)}),(function(e){m.stop({referenceId:"first"}),swal(e)}))};o.users=function(e){return console.log(e),e.length<0?[]:(o.loading=!0,u.getUsers(e).then((function(e){return console.log(e.places),o.markers=y(e.places),o.center.lat=parseFloat(e.places[0].latitude),o.center.lng=parseFloat(e.places[0].longitude),o.center.zoom=13,o.loading=!1,e.places}),(function(e){o.loading=!1})))},o.onSelect=function(e){o.center.lat=parseFloat(e.latitude),o.center.lng=parseFloat(e.longitude),c.getMap().then((function(e){i((function(){e.invalidateSize()}),1e3)}));var t=[];t.push(e),o.markers=y(t)}}angular.module("barikoi").controller("PolygonSearchOld",e),e.$inject=["$rootScope","$scope","$modal","$http","$stateParams","$window","$anchorScroll","$location","$timeout","leafletData","urls","Auth","DataTunnel","MapGeo","bsLoadingOverlayService"]}(),function(){"use strict";var e=angular.module("barikoi");function o(e,o,t,a,n,r,s,l,i,c,d,u,p){i.getMap().then((function(e){l((function(){e.invalidateSize()}),500)}));d.getlocations(c.POLYGON,(function(o){e.areas=o.area;var t,a=[];e.areas.map((function(e){var o=JSON.parse(e["ST_AsGeoJSON(area)"]);a.push(o.coordinates[0])})),t=a,e.areas.push({id:-1,name:"all","ST_AsGeoJSON(area)":JSON.stringify({type:"Polygon",coordinates:t})})}),(function(){})),d.getlocations(c.GET_SUBTYPES,(function(o){e.subcategories=o,e.subcategories.push({subtype:"all"})}),(function(){}));var g=function(e){return e.map((function(e){(isNaN(e.latitude)||isNaN(e.longitude))&&(console.log(e.latitude,e.longitude),e.latitude=23.2433323,e.longitude=90.02433323);var o={shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]};return"water atm"==e.subType.toLowerCase()?(o.iconUrl="./assets/img/type/water-atm.png",o.iconSize=[40,46],o.popupAnchor=[6,-32]):$rootScope.availableIcons.includes(e.pType.split(",")[0].toLowerCase())?o.iconUrl="./assets/img/type/"+e.pType.split(",")[0].toLowerCase()+".png":o.iconUrl="./assets/img/type/default.png","<div><p>Address: "+e.Address+"<br></p><p>Subtype: "+e.subType+"<br></p><p>Code: "+e.uCode+"</p></div>",{layer:e.subType,id:e.id,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),focus:!1,Address:e.Address,area:e.area,subtype:e.subType,ptype:e.pType,uCode:e.uCode,userID:e.user_id,updated_at:e.updated_at,message:"<div ng-include src=\"'views/marker-popup.html'\"></div>",draggable:!0,icon:o}}))};angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},events:{map:{enable:["moveend","popupopen","dblclick"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",attribution:"barikoi",maxZoom:23},layerParams:{showOnSelector:!0}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google",layerOptions:{attribution:"barikoi",maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}},toggleLayer:function(o){e.layers.overlays[o.name].visible=!e.layers.overlays[o.name].visible;Object.getOwnPropertyNames(e.layers.overlays)},toggleSubtypes:function(o){var t=e.resPlaces.filter(e=>"RESIDENTIAL"===o.toUpperCase()&&e.pType.toUpperCase()===o.toUpperCase()?e.subType:"NON-RESIDENTIAL"===o.toUpperCase()&&"RESIDENTIAL"!==e.pType.toUpperCase()?e.subType:void 0);(t=(t=t.map(e=>e.subType.toUpperCase())).filter((e,o,t)=>t.indexOf(e)===o)).forEach(t=>{!0===e.subtypeFilters[o]?(e.subtypeFilters[t]=!0,e.layers.overlays[t].visible=!0):!1===e.subtypeFilters[o]&&(e.subtypeFilters[t]=!1,e.layers.overlays[t].visible=!1)})},toggleList:function(){angular.element(document.querySelector(".dropdown-content")).toggleClass("show-dropdown-content")}}),e.subtypeFilters=new Object,i.getMap().then((function(o){i.getLayers().then((function(t){var a=t.overlays.draw;o.on("draw:created",(function(o){var t=o.layer;a.addLayer(t);var n=[];t.toGeoJSON().geometry.coordinates[0].map((function(e){n.push(e.join(" "))}));var r=n.reduce((e,o)=>e.concat(o),[]);d.get_with_params(c.POLYGON_CUSTOM+"area="+r.toString(),(function(o){e.total=o.Total,e.resPlaces=o.places;var t=[];o.places.map(e=>t.push({[e.pType.toUpperCase()]:e.subType.toUpperCase()}));var a=o.places.map(e=>e.subType.toUpperCase());a=a.filter((e,o,t)=>t.indexOf(e)===o),e.totalSubtypes=a.length,e.ptypeArray=[],e.array=[];var n=a.reduce((o,t,a)=>(t=t.toUpperCase(),e.subtypes=t,-1===e.array.indexOf(t)&&(e.array.push({name:t,selected:!0}),e.subtypeFilters[t]=!0),o[t]={name:t.toLowerCase(),type:"group",visible:!0},o),{});e.subtypeFilters.RESIDENTIAL=!0,e.subtypeFilters["NON-RESIDENTIAL"]=!0,e.selectedSubtype=e.array[0],angular.extend(e,{center:{lat:o.places[0].latitude,lng:o.places[0].longitude,zoom:13},markers:[],layers:{overlays:{...n,draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),e.markers=g(o.places)}),(function(){swal("Error")}))}))}))})),e.set_area=function(o){console.log(o);var t=JSON.parse(o["ST_AsGeoJSON(area)"]);console.log(t),e.id=JSON.parse(o.id),angular.extend(e,{center:{lat:t.coordinates[0][0][1],lng:t.coordinates[0][0][0],zoom:13},controls:{draw:{}},events:{map:{enable:["moveend","popupopen","dblclick"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}},geojson:{data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:t.coordinates}}]},style:{weight:2,opacity:1,color:"red",dashArray:"3",fillOpacity:0}}}),e.markers={}},e.set_subType=function(o,t){p.start({referenceId:"first"}),null==o&&(o=""),d.get_with_params(c.PLACE_BY_AREA+"area="+o+"&subType="+t,(function(o){p.stop({referenceId:"first"}),e.total=o.Total,e.markers=g(o.places)}),(function(){p.stop({referenceId:"first"})}))},e.$on("leafletDirectiveMarker.click",(function(e,o){u.set_data(o.model)})),e.openSlide=function(){e.toggle=!e.toggle},e.$watch("mapView",(function(o){console.log(e.mapView),!0===o&&i.getMap().then((function(o){l((function(){o.invalidateSize(),i.getMap().then((function(o){e.mapBounds.length<1&&e.mapBounds.push([e.location.coords.longitude,e.location.coords.latitude]);var t=L.latLngBounds(e.mapBounds);e.maxBounds.southWest=t.getSouthWest(),e.maxBounds.northEast=t.getNorthEast(),o.fitBounds(t)}))}),300)}))})),e.$on("leafletDirectiveMarker.dragend",(function(e,o){o.model.lat,o.model.lng;swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update marker position!",closeOnConfirm:!1},(function(){d.updateSomething2(c.DROP_MARKER+o.model.id+"?longitude="+o.model.lng+"&latitude="+o.model.lat,(function(e){swal("Done","marker position has been updated")}),(function(){swal("Error")}))}))})),e.$on("leafletDirectiveMap.dblclick",(function(t,a){console.log(a),a.leafletEvent,u.set_data(a.leafletEvent);o.open({templateUrl:"../../views/dtool/add-place.html",controller:"DtollPlaceAdd",size:"lg",scope:e,resolve:{loc:function(){return e.place}}})})),e.changeCenter=function(o){e.center.lat=o.lat,e.center.lng=o.lng,u.set_data(o),o.focus=!0},e.edit_address=function(e,o,t){p.start({referenceId:e});var a={Address:o};console.log(o),console.log(t),d.updateSomething(c.UPDATE_ADDRESS+t,a,(function(e){p.stop({referenceId:"first"}),swal("Success",e)}),(function(e){p.stop({referenceId:"first"}),swal(e)}))};e.users=function(o){return console.log(o),o.length<0?[]:(e.loading=!0,d.getUsers(o).then((function(o){return console.log(o.places),e.loading=!1,o.places}),(function(o){e.loading=!1})))},e.onSelect=function(o){e.center.lat=parseFloat(o.latitude),e.center.lng=parseFloat(o.longitude),i.getMap().then((function(e){l((function(){e.invalidateSize()}),1e3)}));var t=[];t.push(o),e.markers=t.map((function(e){return{id:e.id,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),message:e.Address,pType:e.pType,Address:e.Address,subtype:e.subType,uCode:e.uCode,userID:e.user_id,updated_at:e.updated_at,icon:{iconUrl:"./assets/img/type/"+e.pType.split(",")[0].toLowerCase()+".png"}}}))}}e.controller("PolygonSearch",o),e.filter("searchFilter",(function(){return function(e,o){if(void 0!==e&&void 0!==o){for(var t=[],a=0;a<e.length;a++)for(var n in o)if(o[n]){if("RESIDENTIAL"===n&&e[a].ptype.toUpperCase()===n||e[a].subtype.toUpperCase()===n){t.push(e[a]);break}if("NON-RESIDENTIAL"===n&&"RESIDENTIAL"!==e[a].ptype.toUpperCase()){t.push(e[a]);break}}return t}}})),o.$inject=["$scope","$modal","$http","$stateParams","$window","$anchorScroll","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){function p(e){e.lengthComputable&&(document.getElementById("pro").setAttribute("value",e.loaded),document.getElementById("pro").setAttribute("max",e.total))}function g(e){alert("Files uploaded successfully.")}i.getMap().then((function(e){l((function(){e.invalidateSize()}),500)})),e.polygonStudioLeftFull=!0,e.polygonStudioLeftEight=!1,e.polygonStudioRight=!1,e.polygonStudioCollapse=function(){e.polygonStudioLeftFull?(e.polygonStudioLeftFull=!1,e.polygonStudioLeftEight=!0,e.polygonStudioRight=!0):(e.polygonStudioLeftEight=!1,e.polygonStudioRight=!1,e.polygonStudioLeftFull=!0)},e.getFileDetails=function(o){e.files=[],e.$apply((function(){for(var t=0;t<o.files.length;t++)e.files.push(o.files[t])}))},e.uploadFiles=function(){u.start({referenceId:"first"});var o=new FormData,t=new XMLHttpRequest;for(var a in t.addEventListener("progress",p,!1),e.files)o.append("file",e.files[a]),t.open("POST",c.GPX_UP,!1),t.setRequestHeader("Authorization","bearer "+s.token),t.send(o),a==e.files.length-1&&(t.addEventListener("load",g,!1),u.stop({referenceId:"first"}),g())};d.getlocations(c.POLYGON,(function(o){e.areas=o.area}),(function(){})),d.getlocations(c.GET_SUBTYPES,(function(o){e.subcategories=o,e.subcategories.push({subtype:"all"})}),(function(){})),t.get(c.GPX_LIST).success(e=>{u.start({referenceId:"first"}),i.getMap().then((function(o){e.forEach((e,t)=>{var a="https://admin.barikoi.xyz/v1/get/"+e;new L.GPX(a,{async:!0,jwt:s.token}).on("loaded",(function(e){u.stop({referenceId:"first"})})).addTo(o)})}))}).error(e=>{u.stop({referenceId:"first"})});angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),i.getMap().then((function(e){i.getLayers().then((function(o){var t=o.overlays.draw;e.on("draw:created",(function(e){var o=e.layer;t.addLayer(o);var a=[];o.toGeoJSON().geometry.coordinates[0].map((function(e){a.push(e.join(" "))}));var n=a.reduce((e,o)=>e.concat(o),[]);swal({title:"Polygon Name?",type:"input",showCancelButton:!0,closeOnConfirm:!1,inputPlaceholder:"Ex: Mirpur-2, Banani etc"},(function(e){if(!1===e)return!1;if(""===e)return swal.showInputError("Only tagging is real!"),!1;var o={area:n.toString(),name:e};d.post_anything(c.POLYGON_CREATE,o,(function(e){console.log(e),swal("Nice!","New Polygon Inserted ","success")}),(function(){}))}))}))}))})),e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng},e.$on("$destroy",(function(){u.stop({referenceId:"first"})}))}angular.module("barikoi").controller("PolygonStudio",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$location","$localStorage","$timeout","leafletData","urls","Auth","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u,p,g){i.getMap().then((function(e){s((function(){e.invalidateSize()}),500)})),o.subcategories=[{key:1,name:"Mirpur"}];var m=new L.FeatureGroup;o.polygonAreaLeftFull=!0,o.polygonAreaLeftEight=!1,o.polygonAreaRight=!1,o.polygonAreaCollapse=function(){console.log("im, here"),o.polygonAreaLeftFull?(o.polygonAreaLeftFull=!1,o.polygonAreaLeftEight=!0,o.polygonAreaRight=!0):(o.polygonAreaLeftEight=!1,o.polygonAreaRight=!1,o.polygonAreaLeftFull=!0)};d.getlocations(c.POLYGON,(function(e){o.areas=e.area;var t,a=[];o.areas.map((function(e){var o=JSON.parse(e["ST_AsGeoJSON(area)"]);a.push(o.coordinates[0])})),t=a,o.areas.push({id:-1,name:"all","ST_AsGeoJSON(area)":JSON.stringify({type:"Polygon",coordinates:t})})}),(function(){})),o.subcategories=[{key:1,name:"Mirpur"}],d.getlocations(c.GET_SUBTYPES,(function(e){console.log("subtype response: ",e.data),o.subcategories=[],o.subcategories.push({key:-1,name:"Clear"}),e.map(e=>{o.subcategories.push({key:e.id,name:e.subtype})})}),(function(){}));angular.extend(o,{center:{lat:23.728783,lng:90.393791,zoom:12},events:{map:{enable:["moveend","popupopen"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}}},overlays:{search:{name:"search",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),i.getMap().then((function(e){s((function(){e.invalidateSize()}),500),e.addLayer(m),i.getLayers().then((function(e){console.log(e.overlays.search),angular.extend(o.controls,{search:{layer:e.overlays.search}})})),L.drawLocal.draw.toolbar.buttons.polygon="Draw a sexy polygon!";var t=new L.Control.Draw({position:"topleft",draw:{polygon:{drawError:{color:"#b00b00",timeout:1e3},shapeOptions:{color:"#bada55"}},circle:{shapeOptions:{color:"#662d91"}},marker:!1},edit:{featureGroup:m,remove:!1}});e.addControl(t),e.on("draw:created",(function(e){e.layerType;var o=e.layer;console.log(o);o=e.layer;m.addLayer(o);var t=[];o.toGeoJSON().geometry.coordinates[0].map((function(e){t.push(e.join(" "))}));var a=t.reduce((e,o)=>e.concat(o),[]);swal({title:"Polygon Name?",type:"input",showCancelButton:!0,closeOnConfirm:!1,inputPlaceholder:"Ex: Mirpur-2, Banani etc"},(function(e){if(!1===e)return!1;if(""===e)return swal.showInputError("Only tagging is real!"),!1;var o={area:a.toString(),name:e};d.post_anything(c.POLYGON_CREATE,o,(function(e){console.log(e),swal("Nice!","New Polygon Inserted ","success")}),(function(){}))})),m.addLayer(o)})),e.on("draw:edited",(function(e){var t=e.layers,a=[];console.log(t.toGeoJSON()),t.toGeoJSON().features[0].geometry.coordinates[0].map((function(e){a.push(e.join(" "))})),o.coordinates=a.reduce((e,o)=>e.concat(o),[]),swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update Area Poligon!",closeOnConfirm:!1},(function(){var e={area:o.coordinates.toString()};d.updateSomething(c.POLYGON_UPDATE+o.id,e,(function(e){swal("Done","Area Polygon updated")}),(function(){swal("Error")}))}))}))})),o.set_area=function(e){o.areaName=e.name,o.areaPassed=e;var t=JSON.parse(e["ST_AsGeoJSON(area)"]);JSON.parse(e["ST_AsGeoJSON(area)"]);o.id=JSON.parse(e.id);for(var a=t.coordinates[0].length;a--;){var n=t.coordinates[0][a][0];t.coordinates[0][a][0]=t.coordinates[0][a][1],t.coordinates[0][a][1]=n}var r=L.polygon(t.coordinates);r.setStyle(p.geo_style_rand()),m.clearLayers(),m.addLayer(r),angular.extend(o,{center:{lat:t.coordinates[0][0][0],lng:t.coordinates[0][0][1],zoom:14}}),o.markers={}},o.set_subType=function(t){if(void 0!==t[0]&&t[0].key<0)return void t.reverse().map((function(e){e.selected=!1,o.total=0,o.markers=""}));console.log(t);var a=t.map(e=>e.name);console.log(a);var n=a.toString();console.log(n),g.start({referenceId:"first"}),null==t&&(t="");let r=[],s=JSON.parse(o.areaPassed["ST_AsGeoJSON(area)"]).coordinates;console.log("sadaf ",s),s[0].map((function(e){r.push(e.join(" "))}));let l=r.reduce((e,o)=>e.concat(o),[]);console.log("dasadfs ",l),d.get_with_params(c.MULTI_PLACE_BY_SUBTYPE+n+"&area="+l,(function(t){if(console.log(t),g.stop({referenceId:"first"}),t.data){o.total=t.data.length,o.markers=t.data.map((function(o,t){(isNaN(o.latitude)||isNaN(o.longitude))&&(console.log(o.latitude,o.longitude),o.latitude=23.2433323,o.longitude=90.02433323);var a={shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]};return"water atm"==o.subType.toLowerCase()?(a.iconUrl="./assets/img/type/water-atm.png",a.iconSize=[40,46],a.popupAnchor=[6,-32]):e.availableIcons.includes(o.pType.split(",")[0].toLowerCase())?a.iconUrl="./assets/img/type/"+o.pType.split(",")[0].toLowerCase()+".png":a.iconUrl="./assets/img/type/default.png","<div><p>Address: "+o.Address+"<br></p><p>Subtype: "+o.subType+"<br></p><p>Code: "+o.uCode+"</p></div>",{idx:t,id:o.id,lat:parseFloat(o.latitude),lng:parseFloat(o.longitude),focus:!1,Address:o.Address,area:o.area,ptype:o.pType,subtype:o.subType,uCode:o.uCode,userID:o.user_id,updated_at:o.updated_at,message:"<div ng-include src=\"'views/marker-popup.html'\"></div>",draggable:!0,icon:a}})),o.labels=t.Filters.slice(0,5),o.dt=t.data,console.log("labels",o.labels),o.data=[];let r=0;o.labels.filter(e=>{o.dt.filter(o=>{o.subType.toLowerCase()===e.toLowerCase()&&r++}),console.log("dddlength",o.data.length),o.data.length<=4&&o.data.push(r),r=0}),console.log((a=t.data,n=o.labels,t.data.filter((function(e){return a.subType===n})).length)),console.log("data ",o.data)}var a,n}),(function(){g.stop({referenceId:"first"})})),0===t.length?(console.log("Length 0"),o.total=0,o.markers=""):t.map(e=>{!1===e.selected&&(o.total=0,o.markers="")})},e.$on("mk-del",(function(e,t){console.log(o.markers[t.idx]),o.markers[t.idx].icon.iconUrl="./assets/img/marker-dlt.svg"})),e.$on("mk-upd",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-upd.svg",o.markers[t.idx].lat=t.lat,o.markers[t.idx].lng=t.lng})),e.$on("mk-muv",(function(e,t){o.markers[t.idx].icon.iconUrl="./assets/img/marker-muv.svg"})),e.$on("mk-new",(function(e,t){var a=[];a.push(t);var n=a.map((function(e,o){return(isNaN(e.latitude)||isNaN(e.longitude))&&(console.log(e.latitude,e.longitude),e.latitude=23.2433323,e.longitude=90.02433323),{id:e.id,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),Address:e.Address,icon:{iconUrl:"./assets/img/marker-add.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]}}}));console.log(n),o.markers.push(n[0])})),o.$on("leafletDirectiveMarker.click",(function(e,o){u.set_data(o.model);var t="elm"+o.model.id;r.hash()!==t?r.hash("elm"+o.model.id):l()})),o.$on("leafletDirectiveMarker.mouseover",(function(o,t){e.mhover[t.model.id]=!0,e.mout[t.model.id]=!1;var a="elm"+t.model.id;r.hash()!==a?r.hash("elm"+t.model.id):l()})),o.$on("leafletDirectiveMarker.mouseout",(function(o,t){e.mhover[t.model.id]=!1,e.mout[t.model.id]=!0;var a="elm"+t.model.id;r.hash()!==a?r.hash("elm"+t.model.id):l()})),o.$on("leafletDirectiveMarker.dragend",(function(e,o){o.model.lat,o.model.lng;swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, update marker position!",closeOnConfirm:!1},(function(){d.updateSomething2(c.DROP_MARKER+o.model.id+"?longitude="+o.model.lng+"&latitude="+o.model.lat,(function(e){swal("Done","marker position has been updated")}),(function(){swal("Error")}))}))})),o.openSlide=function(){o.toggle=!o.toggle},o.changeCenter=function(e){o.center.lat=e.lat,o.center.lng=e.lng,u.set_data(e),e.focus=!0},i.getLayers().then((function(e){console.log(e.overlays.search),angular.extend(o.controls,{search:{layer:e.overlays.search}})}))}angular.module("barikoi").controller("Polygon",e).controller("MarkerPopup",["$rootScope","$scope","$modal","urls","Auth","DataTunnel","leafletData","$timeout",function(e,o,t,a,n,r,s,l){o.place=r.get_data(),console.log(o.place),o.changeFlag=function(){e.$broadcast("flag-cng",o.place)},o.delete_location=function(){swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},(function(){n.delete_plc(a.DELETE_PLACE,o.place.uCode,(function(t){e.$broadcast("mk-del",o.place)}),(function(e){swal("Server Error")}))}))},o.update_place_modal=function(){console.log("upl");t.open({templateUrl:"../../views/update-place.html",controller:"UpdatePlaceModal",size:"lg",scope:o,resolve:{loc:function(){return o.place}},backdrop:"static"})},o.retool_place_modal=function(){console.log("rtl");t.open({templateUrl:"../../views/dtool/retool-modal.html",controller:"Retool",size:"lg",scope:o,resolve:{loc:function(){return o.place}},backdrop:"static"})},o.move_to_vault=function(){swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Move to Vault!",closeOnConfirm:!0},(function(){n.get_with_params(a.MOVE_DATA_VAULT+o.place.uCode+"/0",(function(t){e.$broadcast("mk-muv",o.place)}),(function(e){swal("server error")}))}))}}]),e.$inject=["$rootScope","$scope","$http","$stateParams","$window","$location","$anchorScroll","$timeout","leafletData","urls","Auth","DataTunnel","MapGeo","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d,u){e.coordinates,l.getMap().then((function(e){s((function(){e.invalidateSize()}),1e3)}));c.getlocations(i.POLYGON,(function(o){e.areas=o.area}),(function(){})),c.getlocations(i.GET_SUBTYPES,(function(o){e.subcategories=o,e.subcategories.push({subtype:"all"})}),(function(){}));angular.extend(e,{center:{lat:23.728783,lng:90.393791,zoom:12},controls:{draw:{}},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}}}}}),l.getMap().then((function(t){l.getLayers().then((function(a){var n=a.overlays.draw;t.on("draw:created",(function(t){var a=t.layer;n.addLayer(a);var r=[];a.toGeoJSON().geometry.coordinates[0].map((function(e){r.push(e.join(" "))})),e.coordinates=r.reduce((e,o)=>e.concat(o),[]),d.set_data(e.coordinates);o.open({templateUrl:"../../views/polygon-area-mod.html",controller:"PolygonModal",size:"lg",scope:e,backdrop:"static"})}))}))})),e.changeCenter=function(e){$rootScope.center.lat=e.lat,$rootScope.center.lng=e.lng}}angular.module("barikoi").controller("PolygonStdArea",e),e.$inject=["$scope","$modal","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d){s.getMap().then((function(e){r((function(){e.invalidateSize()}),500)})),d.start({referenceId:"first"}),e.markers=[];o.get("https://admin.barikoi.xyz/v1/get/reverse/geo/log/business").then((function(o){d.stop({referenceId:"first"}),console.log("Success: ",o),e.markers=o.data.map((function(e,o){let t=e.split(",");if(0!==t[1])return{lat:parseFloat(t[2]),lng:parseFloat(t[1]),layer:"reverseGeoLog",message:t[3]}}))}),(function(e){console.log("Error: ",e)})),angular.extend(e,{center:{lat:parseFloat(23.728783),lng:parseFloat(90.393791),zoom:11},controls:{draw:{}},layers:{baselayers:{barikoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},bkoi:{name:"Barikoi",type:"wms",url:"http://13.229.51.147:8080/geoserver/barikoi/wms?",visible:!0,layerOptions:{layers:"barikoi:bd_custom",format:"image/png",attribution:"bkoi",crs:L.CRS.EPSG3857,maxZoom:23}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"},mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",maxZoom:23},layerParams:{showOnSelector:!0}}},overlays:{draw:{name:"draw",type:"group",visible:!0,layerParams:{showOnSelector:!1}},reverseGeoLog:{name:"Reverse Geo Log Business",type:"markercluster",visible:!0}}}})}angular.module("barikoi").controller("ReverseGeoBusiness",e),e.$inject=["$scope","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d){o.loading=!1,o.toggle=!0,o.selected={};var u=[];l.getMap().then((function(e){s((function(){e.invalidateSize()}),1e3)}));angular.extend(o,{center:{lat:23.728783,lng:90.393791,zoom:12},events:{map:{enable:["moveend","popupopen"],logic:"emit"},marker:{enable:["click","dblclick"],logic:"emit"}},layers:{baselayers:{googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"},mapbox_light:{name:"Mapbox Light",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.light"}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}}}});var p=[];o.place_add=function(t){p.push(o.selected),o.markers=p.map((function(o){(isNaN(o.latitude)||isNaN(o.longitude))&&(console.log(o.latitude,o.longitude),o.latitude=23.2433323,o.longitude=90.02433323);var t={shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]};return"water atm"==o.subType.toLowerCase()?(t.iconUrl="./assets/img/type/water-atm.png",t.iconSize=[40,46],t.popupAnchor=[6,-32]):e.availableIcons.includes(o.pType.split(",")[0].toLowerCase())?t.iconUrl="./assets/img/type/"+o.pType.split(",")[0].toLowerCase()+".png":t.iconUrl="./assets/img/type/default.png",{id:o.id,lat:parseFloat(o.latitude),lng:parseFloat(o.longitude),focus:!1,message:void 0,subType:o.subType,Address:o.Address,uCode:o.uCode,draggable:!1,icon:t}})),u=o.markers},o.unroute=function(){o.routed=!1,o.markers=u},o.onSelect=function(e){o.selected=e},o.users=function(t){return t.length<1?[]:(o.loading=!0,c.getUsers(t).then((function(e){return o.loading=!1,e.places}),(function(t){o.loading=!1,s((function(){d.stop({referenceId:"first"}),swal(e.error),o.markers=[]}),2e3)})))},o.openSlide=function(){o.toggle=!o.toggle},o.optimize_rout=function(){var a=[];p.map((function(e){a.push({id:e.id.toString(),name:e.Address,address:{location_id:e.id.toString(),name:e.Address.toString(),lon:parseFloat(e.longitude),lat:parseFloat(e.latitude)}})}));var n={vehicles:[{vehicle_id:"my_vehicle",start_address:{location_id:p[0].id.toString(),name:p[0].Address.toString(),lon:parseFloat(p[0].longitude),lat:parseFloat(p[0].latitude)}}],services:a,configuration:{routing:{calc_points:!0}}};t({method:"POST",data:n,url:"https://graphhopper.com/api/1/vrp/optimize?key=460523c3-e36f-4abd-9024-de283d6b3ffa",headers:{"Content-Type":"application/json"}}).success((function(a){console.log("Routing hoise"),t.get("https://graphhopper.com/api/1/vrp/solution/"+a.job_id+"?key=460523c3-e36f-4abd-9024-de283d6b3ffa").success((function(t){o.route_data=t.solution.routes[0].points,console.log(t.solution.routes[0].activities),o.opt_route=t.solution.routes[0].activities,o.route_data.shift(),o.route_data.pop(),o.opt_route.shift(),o.opt_route.pop();var a=[];o.route_data.map((function(e){a.push({type:"Feature",geometry:{type:"LineString",coordinates:e.coordinates}})})),o.markers=o.opt_route.map((function(o,t){var a={shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,35],iconAnchor:[12,41],popupAnchor:[1,-34]};return"water atm"==o.subType.toLowerCase()?(a.iconUrl="./assets/img/type/water-atm.png",a.iconSize=[40,46],a.popupAnchor=[6,-32]):e.availableIcons.includes(o.pType.split(",")[0].toLowerCase())?a.iconUrl="./assets/img/type/"+o.pType.split(",")[0].toLowerCase()+".png":a.iconUrl="./assets/img/type/default.png",{id:o.address.location_id,lat:o.address.lat,lng:o.address.lon,focus:!1,message:o.address.name,icon:a}})),angular.extend(o,{center:{lat:o.route_data[0].coordinates[1],lng:o.route_data[0].coordinates[0],zoom:13},layers:{baselayers:{bkoi:{name:"barikoi",url:"http://map.barikoi.xyz:8080/styles/osm-bright/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Barikoi",maxZoom:23}},googleTerrain:{name:"Google Terrain",layerType:"TERRAIN",type:"google"},mapbox_light:{name:"Mapbox Light",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.light"},layerParams:{showOnSelector:!0}}}},geojson:{data:{type:"FeatureCollection",features:a}}})})).error((function(){}))})).error((function(){console.log("rouiting error")})),o.routed=!0}}angular.module("barikoi").controller("Routing",e),e.$inject=["$rootScope","$scope","$http","$stateParams","$window","$location","$timeout","leafletData","urls","Auth","bsLoadingOverlayService"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i){o.filteredTodos=[],o.currentPage=1,o.numPerPage=5,o.maxSize=5,console.log("id ",a.id),o.data2=[200,200,400];t({method:"GET",url:l.USER_INFO+a.id+"/places",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success((function(e){o.userplaces=e.data,o.$watch("currentPage + numPerPage",(function(){var e=(o.currentPage-1)*o.numPerPage,t=e+o.numPerPage;o.filtereduserplc=o.userplaces.slice(e,t)})),o.numPages=function(){return Math.ceil(o.userplaces.length/o.numPerPage)}})).error((function(e){console.log("err")})),e.navone=!0,t({method:"GET",url:l.USER_INFO+a.id}).success((function(e){var t;o.userinfo=e.data[0],o.userJoinDate=moment(e.data[0].created_at).format("lll"),e.data[0].key?(o.keyGenerated=!0,t=e.data[0].key,o.userUsageToday=[0,0,0,0,0,0,0,0,0],o.userUsageThisWeeks=[0,0,0,0,0,0,0,0,0],o.userUsageThisMonth=[0,0,0,0,0,0,0,0,0],i.TOTAL_API_ANALYTICS_BY_USER(l.API_USAGE_COUNT_BY_KEY,t,0,e=>{o.userUsageToday=function(e){try{let o=e.reduce((e,o)=>(Object.keys(o).forEach(t=>e[t]+=o[t]),e)),t=[];return t.push(o.autocomplete),t.push(o.geocode),t.push(o.reverse_geocode),t.push(o.nearby),t.push(o.distance),t.push(o.rupantor_batchgeo),t.push(o.ward_zone),t.push(o.ward),t.push(o.zone),t.push(o.dncc),t}catch(e){return[0,0,0,0,0]}}(e.data)},e=>{}),i.TOTAL_API_ANALYTICS_BY_USER(l.API_USAGE_COUNT_BY_KEY,t,6,e=>{o.userUsageThisWeeks=function(e){try{let o=e.reduce((e,o)=>(Object.keys(o).forEach(t=>e[t]+=o[t]),e)),t=[];return t.push(o.autocomplete),t.push(o.geocode),t.push(o.reverse_geocode),t.push(o.nearby),t.push(o.distance),t.push(o.rupantor_batchgeo),t.push(o.ward_zone),t.push(o.ward),t.push(o.zone),t.push(o.dncc),t}catch(e){return[0,0,0,0,0]}}(e.data)},e=>{console.log(e)}),i.TOTAL_API_ANALYTICS_BY_USER(l.API_USAGE_COUNT_BY_KEY,t,29,e=>{o.userUsageThisMonth=function(e){try{console.table(e);let o=e.reduce((e,o)=>(Object.keys(o).forEach(t=>e[t]+=o[t]),e)),t=[];return t.push(o.autocomplete),t.push(o.geocode),t.push(o.reverse_geocode),t.push(o.nearby),t.push(o.distance),t.push(o.rupantor_batchgeo),t.push(o.ward_zone),t.push(o.ward),t.push(o.zone),t.push(o.dncc),console.log("ddfdd ",o),t}catch(e){return[0,0,0,0,0]}}(e.data)},e=>{console.log(e)})):o.keyGenerated=!1})).error((function(){})),o.api=["Autocomplete","Geocode","Reverse Geo","Nearby","Distance","Rupantor Batchgeo","Ward Zone","Ward","Zone","City Corp"],o.pieChartOptions={showTooltips:!0,legend:{display:!0,position:"left"},scales:{yAxes:[{ticks:{beginAtZero:!0}}]}},o.doughnutOptions={showTooltips:!0,legend:{display:!0,position:"left"}},o.barChartOptions={scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}}angular.module("barikoi").controller("UserDetailController",e),e.$inject=["$rootScope","$scope","$http","$stateParams","$window","$location","$state","urls","Auth"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i){o.currentPage=0,o.pageSize=10,o.query="",o.getData=function(){return s("filter")(o.userlist,o.query)},i.getlocations(l.TOTAL_USER,(function(e){o.userlist=e.data.list_users}),(function(){e.error="Failed to fetch details"})),o.numberOfPages=function(){return Math.ceil(o.getData().length/o.pageSize)},o.$watch("query",(function(e,t){t!=e&&(o.currentPage=0)}),!0),o.sort=function(e){o.sortKey=e,o.reverse=!o.reverse},o.range=function(e){var t=o.numberOfPages()-1;console.log(t);for(var a=[],n=e;n<e+5&&n<t;n++)a.push(n);return a},o.setPage=function(e){o.currentPage=e},o.user_detail=function(e){console.log("here here"),n.path("/userdetail/"+e)},o.delete_user=function(e){swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},(function(){t.delete(l.USER_INFO+e).success((function(e){r.go("main.userlog",{},{reload:!0}),swal("Deleted!","User deleted.","success")})).error((function(e){swal("Error Occured")}))}))}}angular.module("barikoi").controller("UserLogController",e).filter("startFrom",(function(){return function(e,o){return o=+o,e.slice(o)}})),e.$inject=["$rootScope","$scope","$http","$window","$location","$state","$filter","urls","Auth"]}(),function(){"use strict";function e(e,o,t,a,n,r,s,l,i,c,d){o.loading=!1,o.toggle=!0,leafletData.getMap().then((function(e){s((function(){e.invalidateSize()}),1e3)}));angular.extend(o,{center:{lat:23.728783,lng:90.393791,zoom:12},markers:{},events:{map:{enable:["dblclick","moveend","popupopen"],logic:"emit"},marker:{enable:["click","dblclick","dragend"],logic:"emit"}},layers:{baselayers:{mapbox_light:{name:"Mapbox Streets",url:"http://api.tiles.mapbox.com/v4/{mapid}/{z}/{x}/{y}.png?access_token={apikey}",type:"xyz",layerOptions:{apikey:"pk.eyJ1Ijoicmhvc3NhaW4iLCJhIjoiY2o4Ymt0NndlMHVoMDMzcnd1ZGs4dnJjMSJ9.5Y-mrWQCMXqWTe__0J5w4w",mapid:"mapbox.streets",attribution:"barikoi",maxZoom:23}},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{maxZoom:23}}}}}),o.openSlide=function(){o.toggle=!o.toggle},o.$on("leafletDirectiveMarker.click",(function(e,o){c.set_data(o.model)})),o.showOverlay=function(e){d.start({referenceId:e});var t=[],a=function(e,o){o=o||",";for(var t=new RegExp("(\\"+o+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+o+"\\r\\n]*))","gi"),a=[[]],n=null;n=t.exec(e);){var r,s=n[1];s.length&&s!==o&&a.push([]),r=n[2]?n[2].replace(new RegExp('""',"g"),'"'):n[3],a[a.length-1].push(r)}return a}(o.fileContent,",");for(var n in a)i.getUsers(a[n][0]).then((function(e){o.loading=!1,Array.isArray(e.places)&&t.push(e.places)}),(function(e){console.log("err")})),t.flat(),t.pop();o.markers=t.flat().map((function(e){console.log(e);var o="./assets/img/type/"+e.pType.split(",")[0].toLowerCase()+".png";return{id:e.id,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),Address:e.Address,subtype:e.subType,uCode:e.uCode,focus:!1,message:"<div ng-include src=\"'views/marker-popup.html'\"></div>",draggable:!0,icon:{iconUrl:o,iconSize:[28,28]}}})),d.stop({referenceId:"first"})}}angular.module("barikoi").controller("VerifyLocation",e),e.$inject=["$rootScope","$scope","$http","$stateParams","$window","$location","$timeout","urls","Auth","DataTunnel","bsLoadingOverlayService"]}(),function(){"use strict";angular.module("barikoi").factory("Auth",["$http","$q","$localStorage","urls",function(e,o,t,a){var n=function(){var e=t.token,o={};if(void 0!==e){var a=e.split(".")[1];o=JSON.parse(function(e){var o=e.replace("-","+").replace("_","/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw"Illegal base64url string!"}return window.atob(o)}(a))}return o}();return{signup:function(o,t,n){e.post(a.AUTH_REG,o).success(t).error(n)},signin:function(o,t,n){e.post(a.AUTH_URI,o).success(t).error(n)},getlocations:function(o,t,a){e.get(o).success(t).error(a)},setcategory:function(o,t,a,n){e({method:"POST",url:o,transformResponse:[function(e){return e}],data:t,headers:{"Content-Type":"application/json"}}).success(a).error(n)},setSubCategory:function(o,t,a,n){e({method:"POST",url:o,transformResponse:[function(e){return e}],data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(a).error(n)},getPtypes:function(o,t,a){e({method:"GET",url:o}).success(t).error(a)},setSubCategory:function(o,t,a,n){e({method:"POST",url:o,data:t,transformResponse:[function(e){return e}],headers:{"Content-Type":"application/json;"}}).success(a).error(n)},delete_plc:function(o,t,a,n){e({method:"GET",url:o+t,data:t,transformResponse:[function(e){return e}],headers:{"Content-Type":"application/json"}}).success(a).error(n)},delete_anything:function(o,t,a,n){e({method:"DELETE",url:o+t,transformResponse:[function(e){return e}],headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(a).error(n)},delete_anything2:function(o,t,a,n){e({method:"DELETE",url:o,data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(a).error(n)},delete_anything_json:function(o,t,a,n){e({method:"DELETE",url:o,data:t,headers:{"Content-Type":"application/json"}}).success(a).error(n)},delete_without_param:function(o,t,a){e({method:"DELETE",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(t).error(a)},get_with_params:function(o,t,a){e({method:"GET",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(t).error(a)},get_with_params2:function(o,t,a,n){e({method:"GET",url:o,data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(a).error(n)},replace:function(o,t,a){e({method:"GET",url:o,transformResponse:[function(e){return e}],headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(t).error(a)},addaddress:function(o,t,a,n){console.log("param data",t),e({method:"POST",url:o,data:t,transformResponse:[function(e){return e}],headers:{"Content-Type":"application/json"}}).success(a).error(n)},post_anything:function(o,t,a,n){e({method:"POST",url:o,data:t,headers:{"Content-Type":"application/json"}}).success(a).error(n)},adminSearch:function(t){var n=o.defer(),r={search:t};return e.post(a.ADMIN_SEARCH,r).success((function(e){n.resolve(e)})).error((function(e,o){n.reject(o)})),n.promise},put_something:function(o,t,a,n){e({method:"PUT",url:o,transformResponse:[function(e){return e}],headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(a).error(n)},updateSomething:function(o,t,a,n){e({method:"PATCH",url:o,data:t,transformResponse:[function(e){return e}],headers:{"Content-Type":"application/json"}}).success(a).error(n)},updateSomething2:function(o,t,a){e({method:"PATCH",url:o,transformResponse:[function(e){return e}],headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(t).error(a)},logout:function(e){var o;o={},angular.extend(n,o),delete t.token,delete t.userType,e()},getUsers:function(t){var n=o.defer(),r={search:t};return e.post(a.TNT,r).success((function(e){n.resolve(e)})).error((function(e,o){n.reject(o)})),n.promise},GetUserInfo:function(o,t){e({method:"GET",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(t)},GetMapperTasks:function(o,t){e({method:"GET",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(t)},GetOneTask:function(o,t){e({method:"GET",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(t)},GetTaskActions:function(o,t){e({method:"GET",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(t)},GetTaskReports:function(o,t){e({method:"GET",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(t)},UpdateTaskOrReport:function(o,t,a){e({method:"POST",url:o,data:t,headers:{"Content-Type":"application/json"}}).then(a)},EndTask:function(o,t,a){e({method:"PATCH",url:o,data:t,headers:{"Content-Type":"application/json"}}).then(a)},ReportAction:function(o,t,a){e({method:"POST",url:o,data:t,headers:{"Content-Type":"application/json"}}).then(a)},DAILY_ANALYTICS:function(o,t){e({method:"Get",url:o,headers:{"Content-Type":"application/json"}}).then(t)},TOTAL_API_ANALYTICS:function(o,t){e({method:"Get",url:o}).then(t)},TOTAL_API_ANALYTICS_BY_USER:function(o,t,a,n){e({method:"Get",url:`${o}?key=${t}&day=${a}`}).then(n)},tokai_call:function(t){var a=o.defer();return e.get(t).success((function(e){a.resolve(e)})).error((function(e,o){a.reject(o)})),a.promise},currentUser:n}}])}(),function(){"use strict";angular.module("barikoi").factory("DataTunnel",["$rootScope","$http","$localStorage","urls",function(e,o,t,a){var n={};const r=e=>{try{return(e=e.toLowerCase()).includes("floor")||e.includes("level")||e.includes("ground floor")}catch(e){return!1}},s=e=>{try{return(e=>{try{return/\d/.test(e)}catch(e){return!1}})(e=e.toLowerCase())&&e.includes("house")||e.includes("plot")}catch(e){return!1}},l=e=>{try{var o=e.pType.toLowerCase().toString(),t=e.subType.toLowerCase().toString();return o.includes("residential")||t.includes("market")||t.includes("commercial building")||t.includes("baazar")||t.includes("shopping mall")||t.includes("shopping center")||t.includes("shopping complex")||t.includes("mall")}catch(e){return!1}},i=e=>{try{return(e=e.toLowerCase()).includes("shop")||e.includes("shop no")}catch(e){return!1}},c=e=>{e=e.toLowerCase();try{return e.includes("shopping mall")||e.includes("shopping center")||e.includes("shopping complex")||e.includes("market")||e.includes("mohol")||e.includes("mahol")||e.includes("kutir")||e.includes("bhaban")||e.includes("bhabhan")||e.includes("vaban")||e.includes("monjil")||e.includes("manjil")||e.includes("nibash")||e.includes("nibash")||e.includes("complex")||e.includes("heights")||e.includes("abash")||e.includes("plaza")}catch(e){return!1}},d=e=>{try{return(e=e.toLowerCase()).includes("road")||e.includes("avenue")||e.includes("highway")||e.includes("street")||e.includes("lane")||e.includes("sarani")||e.includes("saroni")||e.includes("sarak")||e.includes("sharak")||e.includes("goli")||e.includes("gali")||e.includes("sharani")||e.includes("chowrasta")||e.includes("janapath")||e.includes("path")}catch(e){return!1}};var u="super_sub_area",p="sub_area";return{set_data:function(e){n=e},get_data:function(){return n},set_tag:function(e){n.tag=e},get_tag:function(){return n.tag},set_form_data:function(e){n.form_data=e,console.log(e)},get_form_data:function(){return n.form_data},address_split:(e,o,t)=>{console.clear(),console.log("here in the tunnel"),console.table(e);var a=null,n=null,g="",m="",y=!1,f=o.split(",");console.log("splited: ",f),e.section="",f.forEach(o=>{if(s(o)){a=f.indexOf(o);var t=o;t=t.replace("House ",""),g=t}if(!y&&d(o)&&(console.log("is road ",o),n=f.indexOf(o),m=o,e.road=m,(e=>{try{return(e=e.toLowerCase()).includes("avenue")||e.includes("sharani")||e.includes("sarani")||e.includes("sharak")||e.includes("sarak")}catch(e){return!1}})(f[n+1]))){console.log("is avenue ",f[n+1]);let e="";e=f[n+1],m=m+","+e,y=!0}r(o)&&(e.floor=o)}),console.log(a),console.log(a);var h=n-a;if(l(t)&&(a?(console.log("house found"),h=a-1):n&&(console.log("road found"),h=n-1)),2===f.length&&null===a&&null===n)e.house="",e.road="",c(f[0])||l(t)?e.section=f[0]:e.name=f[0],d(f[1])?e.road=f[1]:e[p]=f[1];else if(2===f.length&&null!==a&&null!==n)e.house=g,e.road=m;else if(2===f.length&&null===a&&null!==n)console.log("splitAddress.length === 2 && houseIndex == null && roadIndex !== null"),e.house="",e.road=m,l(t)||c(f[0])?e.section=f[0]:d(f[0])?e.road=f[0]:e.name=f[0],d(f[1])?e.road=f[1]:e[p]=f[1];else if(2===f.length&&null!==a&&null===n)console.log("splitAddress.length === 2 && houseIndex !== null && roadIndex === null"),e.house=g,e.road="",l(t)&&c(f[0])?e.section=f[0]:d(f[0])&&(e.road=f[0]),s(0==e[0])&&!i(e[0])&&(console.log("imm aa bugg"),e.name=f[0]),d(f[1])?e.road=f[1]:e[p]=f[1];else if(3===f.length&&a&&n)console.log("splitAddress.length === 3 && houseIndex && roadIndex"),c(f[0])||l(t)?e.section=f[0]:s(f[0])?e.house=g:e.name=f[0],s(f[1])?e.house=g:d(f[1])&&(e.road=f[1]),d(f[2])?e.road=f[2]:e[p]=f[2];else if(3!==f.length||a||n)if(3===f.length&&!a&&n)console.log("splitAddress.length === 3 && !houseIndex && roadIndex"),s(f[0])?e.house=g:c(f[0])||l(t)?e.section=f[0]:e.name=f[0],console.log(c(f[1])||l(t)),d(f[1])?e.road=f[1]:(c(f[1])||l(t))&&(e.section=f[1]),d(f[2])?e.road=f[2]:e[p]=f[2];else if(3===f.length&&a&&!n)console.log("splitAddress.length === 3 && houseIndex && !roadIndex"),e.road="",s(f[0])?e.house=g:l(t||c(f[0])&&!r(f[0]))?e.section=f[0]:e.name=f[0],d(f[1])?e.road=f[1]:s(f[1])?e.house=g:(!r(f[0])&&l(t)||c(f[1]))&&(e.section=f[1]),d(f[2])?e.road=f[2]:e[p]=f[2];else{function b(o){var t=o+1;f.length-t>1?(e[u]=f[o+1],e[p]=f[o+2]):e[p]=f[o+1]}console.log("MORE THAN 3 ITEM IN ARRAY"),e.section=e[h],0===h?c(f[h])||l(t)&&!d(e[h])&&!s(e[h])?e.section=f[h]:(e.name=f[h],e.section=""):1===h?(e.name=f[0],(c(f[h])||l(t)&&!d(e[h])&&!s(e[h]))&&(e.section=f[h])):2===h&&(e.name=f[0],(c(f[h])||l(t)&&!d(e[h])&&!s(e[h]))&&(e.section=f[h])),null===a&&null===n?(console.log("houseIndex === null && roadIndex === null"),i(f[0])||c(f[0])||r(f[0])||l(t)||(e.name=f[0]),5===f.length?(e[p]=e[4],e[u]=e[3]):e[p]=e[3]):null!==a&&0===a&&null==n?(console.log("houseIndex !== null && houseIndex === 0 && roadIndex == null"),e.house=g,e.name="",e.road="",b(a)):null!==a&&null===n&&1==a?(console.log("houseIndex !== null && roadIndex === null && houseIndex == 1"),e.house=g,e.road="",l(t)||c(f[0])?e.section=f[0]:i(f[0])&&r(f[0])||(e.name=f[0]),b(a)):null!==a&&null===n&&2===a?(console.log("houseIndex !== null && roadIndex === null && houseIndex === 2"),e.house=g,e.name=f[0],e.section=f[1],e.road="",b(a)):null===a&&null!==n&&0===n?(console.log("houseIndex === null && roadIndex !== null && roadIndex === 0"),e.house="",e.name="",e.road=m,b(n)):null===a&&null!==n&&n>=0?(console.log("houseIndex === null && roadIndex !== null && roadIndex >= 0"),e.house="",l(t)||c(f[0])?e.section=f[0]:r(f[0])||(e.name=f[0]),e.road=m,n>=2&&(e.name=f[0],e.section=f[n-1]),n>=1&&(e.name=f[0],(l(t)||c(f[0]))&&(e.section=f[n-1])),b(n)):null!==a&&null!==n&&(e.house=g,e.road=m,console.log("houseIndex !== null && roadIndex !== null"),3===a&&(e.name=f[0],c(f[2])||l(t)&&!r(f[2])?e.section=f[2]:(e.section="",e.name=f[0])),2===a?(e.name=f[0],c(f[1])||l(t)&&!r(f[1])?(console.log("here"),e.section=f[1]):(e.section="",e.name=f[0]),r(f[1])&&(c(f[0])||l(t))&&(e.section=f[0],e.name="")):1===a?(console.log("house is at 2nd index"),!r(f[1])&&l(t)||c(f[0])?e.section=f[0]:l(t)&&c(f[0])?e.name="":e.name=f[0]):0===a&&(e.name="",e.section=""),b(n))}else console.log("splitAddress.length === 3 && !houseIndex && !roadIndex"),s(f[0])?e.house=g:e.name=f[0],s(f[1])?e.house=g:d(f[1])?e.road=f[1]:c(f[1])||l(t)?e.section=f[1]:e[name]=f[1],d(f[2])?e.road=f[2]:e[p]=f[2]},get_address_string:function(){return n.address},subscribe:function(o,t){var a=e.$on("notifying-service-event",t);o.$on("$destroy",a)},publish:function(){e.$emit("notifying-service-event")}}}])}(),function(){"use strict";angular.module("barikoi").factory("MapGeo",(function(){var e=Math.round,o=Math.random,t=255;function a(){return"rgb("+e(o()*t)+","+e(o()*t)+","+e(o()*t)+")"}function n(e){switch(e.properties.task_status){case 1:return"rgba(150, 0, 0"+o().toFixed(1)+")";case 2:return"rgba(0,0, 150"+o().toFixed(1)+")";case 3:return"rgba(0,150, 0"+o().toFixed(1)+")";default:return"rgba(150,150, 0"+o().toFixed(1)+")"}}return{geo_style_rand:function(){return{fillColor:a(),opacity:2,color:a(),dashArray:"3",fillOpacity:.1}},geo_style_custom_task:function(e){return{fillColor:n(e),opacity:2,color:n(e),dashArray:"3",fillOpacity:.4}}}}))}();